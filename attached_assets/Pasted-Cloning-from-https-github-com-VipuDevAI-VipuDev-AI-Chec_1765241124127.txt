Cloning from https://github.com/VipuDevAI/VipuDev_AI
==> Checking out commit 4368558e3cdf8ce11d7e90415db6f7330d6b1158 in branch main
==> Using Node.js version 22.16.0 (default)
==> Docs on specifying a Node.js version: https://render.com/docs/node-version
==> Running build command 'npm install && npm run build'...
added 422 packages, and audited 423 packages in 1m
43 packages are looking for funding
  run `npm fund` for details
4 moderate severity vulnerabilities
To address all issues (including breaking changes), run:
  npm audit fix --force
Run `npm audit` for details.
> rest-express@1.0.0 build
> tsx script/build.ts
building client...
vite v7.2.7 building client environment for production...
transforming...
âœ“ 2069 modules transformed.
rendering chunks...
computing gzip size...
../dist/public/index.html                   1.54 kB â”‚ gzip:   0.61 kB
../dist/public/assets/index-BLoqnzXy.css  116.86 kB â”‚ gzip:  18.63 kB
../dist/public/assets/index-DCy_n5hG.js   637.18 kB â”‚ gzip: 180.04 kB
(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
âœ“ built in 3.86s
building server...
  dist/index.cjs  1.3mb âš ï¸
âš¡ Done in 234ms
==> Uploading build...
==> Uploaded in 5.9s. Compression took 4.7s
==> Build successful ðŸŽ‰
==> Deploying...
==> Running 'node dist/index.cjs'
/opt/render/project/src/dist/index.cjs:94
==> Exited with status 1
==> Common ways to troubleshoot your deploy: https://render.com/docs/troubleshooting-deploys
==> Running 'node dist/index.cjs'
/opt/render/project/src/dist/index.cjs:94
`);c.write(s.format.apply(s,E))}}w(x,"warn"),Object.defineProperty(e.exports,"isWin",{get:w(function(){return o},"get"),set:w(function(O){o=O},"set")}),e.exports.warnTo=function(O){var E=c;return c=O,E},e.exports.getFileName=function(O){var E=O||be.env,A=E.PGPASSFILE||(o?r.join(E.APPDATA||"./","postgresql","pgpass.conf"):r.join(E.HOME||"./",".pgpass"));return A},e.exports.usePgPass=function(O,E){return Object.prototype.hasOwnProperty.call(be.env,"PGPASSWORD")?!1:o?!0:(E=E||"<unkn>",g(O.mode)?O.mode&(l|u)?(x('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',E),!1):!0:(x('WARNING: password file "%s" is not a plain file',E),!1))};var _=e.exports.match=function(O,E){return m.slice(0,-1).reduce(function(A,k,C){return C==1&&Number(O[k]||a)===Number(E[k])?A&&!0:A&&(E[k]==="*"||E[k]===O[k])},!0)};e.exports.getPassword=function(O,E,A){var k,C=E.pipe(i());function j(H){var B=S(H);B&&T(B)&&_(O,B)&&(k=B[v],C.end())}w(j,"onLine");var L=w(function(){E.destroy(),A(k)},"onEnd"),V=w(function(H){E.destroy(),x("WARNING: error on reading file: %s",H),A(void 0)},"onErr");E.on("error",V),C.on("data",j).on("end",L).on("error",V)};var S=e.exports.parseLine=function(O){if(O.length<11||O.match(/^\s+#/))return null;for(var E="",A="",k=0,C=0,j=0,L={},V=!1,H=w(function(z,X,K){var oe=O.substring(X,K);Object.hasOwnProperty.call(be.env,"PGPASS_NO_DEESCAPE")||(oe=oe.replace(/\\([:\\])/g,"$1")),L[m[z]]=oe},"addToObj"),B=0;B<O.length-1;B+=1){if(E=O.charAt(B+1),A=O.charAt(B),V=k==f-1,V){H(k,C);break}B>=0&&E==":"&&A!=="\\"&&(H(k,C,B+1),C=B+2,k+=1)}return L=Object.keys(L).length===f?L:null,L},T=e.exports.isValidEntry=function(O){for(var E={0:function(L){return L.length>0},1:function(L){return L==="*"?!0:(L=Number(L),isFinite(L)&&L>0&&L<9007199254740992&&Math.floor(L)===L)},2:function(L){return L.length>0},3:function(L){return L.length>0},4:function(L){return L.length>0}},A=0;A<m.length;A+=1){var k=E[A],C=O[m[A]]||"",j=k(C);if(!j)return!1}return!0}}),aU=xe((t,e)=>{"use strict";ae();var r=(X4(),St(hy)),n=(Y4(),St(my)),i=sU();e.exports=function(s,a){var o=i.getFileName();n.stat(o,function(c,l){if(c||!i.usePgPass(l,o))return a(void 0);var u=n.createReadStream(o);i.getPassword(s,u,a)})},e.exports.warnTo=i.warnTo}),vy=xe((t,e)=>{"use strict";ae();var r=Cf();function n(i){this._types=i||r,this.text={},this.binary={}}w(n,"TypeOverrides"),n.prototype.getOverrides=function(i){switch(i){case"text":return this.text;case"binary":return this.binary;default:return{}}},n.prototype.setTypeParser=function(i,s,a){typeof s=="function"&&(a=s,s="text"),this.getOverrides(s)[i]=a},n.prototype.getTypeParser=function(i,s){return s=s||"text",this.getOverrides(s)[i]||this._types.getTypeParser(i,s)},e.exports=n}),nA={};Pr(nA,{default:()=>iA});var iA,oU=Jt(()=>{"use strict";ae(),iA={}}),sA={};Pr(sA,{parse:()=>yy});function yy(t,e=!1){let{protocol:r}=new URL(t),n="http:"+t.substring(r.length),{username:i,password:s,host:a,hostname:o,port:c,pathname:l,search:u,searchParams:p,hash:d}=new URL(n);s=decodeURIComponent(s),i=decodeURIComponent(i),l=decodeURIComponent(l);let g=i+":"+s,m=e?Object.fromEntries(p.entries()):u;return{href:t,protocol:r,auth:g,username:i,password:s,host:a,hostname:o,port:c,pathname:l,search:u,query:m,hash:d}}var aA=Jt(()=>{"use strict";ae(),w(yy,"parse")}),cU=xe((t,e)=>{"use strict";ae();var r=(aA(),St(sA)),n=(Y4(),St(my));function i(s){if(s.charAt(0)==="/"){var o=s.split(" ");return{host:o[0],database:o[1]}}var a=r.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(s)?encodeURI(s).replace(/\%25(\d\d)/g,"%$1"):s,!0),o=a.query;for(var c in o)Array.isArray(o[c])&&(o[c]=o[c][o[c].length-1]);var l=(a.auth||":").split(":");if(o.user=l[0],o.password=l.splice(1).join(":"),o.port=a.port,a.protocol=="socket:")return o.host=decodeURI(a.pathname),o.database=a.query.db,o.client_encoding=a.query.encoding,o;o.host||(o.host=a.hostname);var u=a.pathname;if(!o.host&&u&&/^%2f/i.test(u)){var p=u.split("/");o.host=decodeURIComponent(p[0]),u=p.splice(1).join("/")}switch(u&&u.charAt(0)==="/"&&(u=u.slice(1)||null),o.database=u&&decodeURI(u),(o.ssl==="true"||o.ssl==="1")&&(o.ssl=!0),o.ssl==="0"&&(o.ssl=!1),(o.sslcert||o.sslkey||o.sslrootcert||o.sslmode)&&(o.ssl={}),o.sslcert&&(o.ssl.cert=n.readFileSync(o.sslcert).toString()),o.sslkey&&(o.ssl.key=n.readFileSync(o.sslkey).toString()),o.sslrootcert&&(o.ssl.ca=n.readFileSync(o.sslrootcert).toString()),o.sslmode){case"disable":{o.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{o.ssl.rejectUnauthorized=!1;break}}return o}w(i,"parse"),e.exports=i,i.parse=i}),by=xe((t,e)=>{"use strict";ae();var r=(oU(),St(nA)),n=Af(),i=cU().parse,s=w(function(p,d,g){return g===void 0?g=be.env["PG"+p.toUpperCase()]:g===!1||(g=be.env[g]),d[p]||g||n[p]},"val"),a=w(function(){switch(be.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return n.ssl},"readSSLConfigFromEnvironment"),o=w(function(p){return"'"+(""+p).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),c=w(function(p,d,g){var m=d[g];m!=null&&p.push(g+"="+o(m))},"add"),l=class{constructor(d){d=typeof d=="string"?i(d):d||{},d.connectionString&&(d=Object.assign({},d,i(d.connectionString))),this.user=s("user",d),this.database=s("database",d),this.database===void 0&&(this.database=this.user),this.port=parseInt(s("port",d),10),this.host=s("host",d),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:s("password",d)}),this.binary=s("binary",d),this.options=s("options",d),this.ssl=typeof d.ssl>"u"?a():d.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=s("client_encoding",d),this.replication=s("replication",d),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=s("application_name",d,"PGAPPNAME"),this.fallback_application_name=s("fallback_application_name",d,!1),this.statement_timeout=s("statement_timeout",d,!1),this.lock_timeout=s("lock_timeout",d,!1),this.idle_in_transaction_session_timeout=s("idle_in_transaction_session_timeout",d,!1),this.query_timeout=s("query_timeout",d,!1),d.connectionTimeoutMillis===void 0?this.connect_timeout=be.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(d.connectionTimeoutMillis/1e3),d.keepAlive===!1?this.keepalives=0:d.keepAlive===!0&&(this.keepalives=1),typeof d.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(d.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(d){var g=[];c(g,this,"user"),c(g,this,"password"),c(g,this,"port"),c(g,this,"application_name"),c(g,this,"fallback_application_name"),c(g,this,"connect_timeout"),c(g,this,"options");var m=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(c(g,m,"sslmode"),c(g,m,"sslca"),c(g,m,"sslkey"),c(g,m,"sslcert"),c(g,m,"sslrootcert"),this.database&&g.push("dbname="+o(this.database)),this.replication&&g.push("replication="+o(this.replication)),this.host&&g.push("host="+o(this.host)),this.isDomainSocket)return d(null,g.join(" "));this.client_encoding&&g.push("client_encoding="+o(this.client_encoding)),r.lookup(this.host,function(f,v){return f?d(f,null):(g.push("hostaddr="+o(v)),d(null,g.join(" ")))})}};w(l,"ConnectionParameters");var u=l;e.exports=u}),lU=xe((t,e)=>{"use strict";ae();var r=Cf(),n=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,i=class{constructor(o,c){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=c,this.RowCtor=null,this.rowAsArray=o==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(o){var c;o.text?c=n.exec(o.text):c=n.exec(o.command),c&&(this.command=c[1],c[3]?(this.oid=parseInt(c[2],10),this.rowCount=parseInt(c[3],10)):c[2]&&(this.rowCount=parseInt(c[2],10)))}_parseRowAsArray(o){for(var c=new Array(o.length),l=0,u=o.length;l<u;l++){var p=o[l];p!==null?c[l]=this._parsers[l](p):c[l]=null}return c}parseRow(o){for(var c={},l=0,u=o.length;l<u;l++){var p=o[l],d=this.fields[l].name;p!==null?c[d]=this._parsers[l](p):c[d]=null}return c}addRow(o){this.rows.push(o)}addFields(o){this.fields=o,this.fields.length&&(this._parsers=new Array(o.length));for(var c=0;c<o.length;c++){var l=o[c];this._types?this._parsers[c]=this._types.getTypeParser(l.dataTypeID,l.format||"text"):this._parsers[c]=r.getTypeParser(l.dataTypeID,l.format||"text")}}};w(i,"Result");var s=i;e.exports=s}),uU=xe((t,e)=>{"use strict";ae();var{EventEmitter:r}=is(),n=lU(),i=kf(),s=class extends r{constructor(c,l,u){super(),c=i.normalizeQueryConfig(c,l,u),this.text=c.text,this.values=c.values,this.rows=c.rows,this.types=c.types,this.name=c.name,this.binary=c.binary,this.portal=c.portal||"",this.callback=c.callback,this._rowMode=c.rowMode,be.domain&&c.callback&&(this.callback=be.domain.bind(c.callback)),this._result=new n(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new n(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(c){this._checkForMultirow(),this._result.addFields(c.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(c){let l;if(!this._canceledDueToError){try{l=this._result.parseRow(c.fields)}catch(u){this._canceledDueToError=u;return}this.emit("row",l,this._result),this._accumulateRows&&this._result.addRow(l)}}handleCommandComplete(c,l){this._checkForMultirow(),this._result.addCommandComplete(c),this.rows&&l.sync()}handleEmptyQuery(c){this.rows&&c.sync()}handleError(c,l){if(this._canceledDueToError&&(c=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(c);this.emit("error",c)}handleReadyForQuery(c){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,c);if(this.callback)try{this.callback(null,this._results)}catch(l){be.nextTick(()=>{throw l})}this.emit("end",this._results)}submit(c){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let l=c.parsedStatements[this.name];return this.text&&l&&this.text!==l?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(c):c.query(this.text),null)}hasBeenParsed(c){return this.name&&c.parsedStatements[this.name]}handlePortalSuspended(c){this._getRows(c,this.rows)}_getRows(c,l){c.execute({portal:this.portal,rows:l}),l?c.flush():c.sync()}prepare(c){this.isPreparedStatement=!0,this.hasBeenParsed(c)||c.parse({text:this.text,name:this.name,types:this.types});try{c.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:i.prepareValue})}catch(l){this.handleError(l,c);return}c.describe({type:"P",name:this.portal||""}),this._getRows(c,this.rows)}handleCopyInResponse(c){c.sendCopyFail("No source stream defined")}handleCopyData(c,l){}};w(s,"Query");var a=s;e.exports=a}),oA={};Pr(oA,{Socket:()=>Wa,isIP:()=>cA});function cA(t){return 0}var q4,ly,Tl,Wa,xy=Jt(()=>{"use strict";ae(),q4=Ha(is(),1),w(cA,"isIP"),ly=/^[^.]+\./,Tl=class le extends q4.EventEmitter{constructor(){super(...arguments),me(this,"opts",{}),me(this,"connecting",!1),me(this,"pending",!0),me(this,"writable",!0),me(this,"encrypted",!1),me(this,"authorized",!1),me(this,"destroyed",!1),me(this,"ws",null),me(this,"writeBuffer"),me(this,"tlsState",0),me(this,"tlsRead"),me(this,"tlsWrite")}static get poolQueryViaFetch(){return le.opts.poolQueryViaFetch??le.defaults.poolQueryViaFetch}static set poolQueryViaFetch(e){le.opts.poolQueryViaFetch=e}static get fetchEndpoint(){return le.opts.fetchEndpoint??le.defaults.fetchEndpoint}static set fetchEndpoint(e){le.opts.fetchEndpoint=e}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(e){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return le.opts.fetchFunction??le.defaults.fetchFunction}static set fetchFunction(e){le.opts.fetchFunction=e}static get webSocketConstructor(){return le.opts.webSocketConstructor??le.defaults.webSocketConstructor}static set webSocketConstructor(e){le.opts.webSocketConstructor=e}get webSocketConstructor(){return this.opts.webSocketConstructor??le.webSocketConstructor}set webSocketConstructor(e){this.opts.webSocketConstructor=e}static get wsProxy(){return le.opts.wsProxy??le.defaults.wsProxy}static set wsProxy(e){le.opts.wsProxy=e}get wsProxy(){return this.opts.wsProxy??le.wsProxy}set wsProxy(e){this.opts.wsProxy=e}static get coalesceWrites(){return le.opts.coalesceWrites??le.defaults.coalesceWrites}static set coalesceWrites(e){le.opts.coalesceWrites=e}get coalesceWrites(){return this.opts.coalesceWrites??le.coalesceWrites}set coalesceWrites(e){this.opts.coalesceWrites=e}static get useSecureWebSocket(){return le.opts.useSecureWebSocket??le.defaults.useSecureWebSocket}static set useSecureWebSocket(e){le.opts.useSecureWebSocket=e}get useSecureWebSocket(){return this.opts.useSecureWebSocket??le.useSecureWebSocket}set useSecureWebSocket(e){this.opts.useSecureWebSocket=e}static get forceDisablePgSSL(){return le.opts.forceDisablePgSSL??le.defaults.forceDisablePgSSL}static set forceDisablePgSSL(e){le.opts.forceDisablePgSSL=e}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??le.forceDisablePgSSL}set forceDisablePgSSL(e){this.opts.forceDisablePgSSL=e}static get disableSNI(){return le.opts.disableSNI??le.defaults.disableSNI}static set disableSNI(e){le.opts.disableSNI=e}get disableSNI(){return this.opts.disableSNI??le.disableSNI}set disableSNI(e){this.opts.disableSNI=e}static get pipelineConnect(){return le.opts.pipelineConnect??le.defaults.pipelineConnect}static set pipelineConnect(e){le.opts.pipelineConnect=e}get pipelineConnect(){return this.opts.pipelineConnect??le.pipelineConnect}set pipelineConnect(e){this.opts.pipelineConnect=e}static get subtls(){return le.opts.subtls??le.defaults.subtls}static set subtls(e){le.opts.subtls=e}get subtls(){return this.opts.subtls??le.subtls}set subtls(e){this.opts.subtls=e}static get pipelineTLS(){return le.opts.pipelineTLS??le.defaults.pipelineTLS}static set pipelineTLS(e){le.opts.pipelineTLS=e}get pipelineTLS(){return this.opts.pipelineTLS??le.pipelineTLS}set pipelineTLS(e){this.opts.pipelineTLS=e}static get rootCerts(){return le.opts.rootCerts??le.defaults.rootCerts}static set rootCerts(e){le.opts.rootCerts=e}get rootCerts(){return this.opts.rootCerts??le.rootCerts}set rootCerts(e){this.opts.rootCerts=e}wsProxyAddrForHost(e,r){let n=this.wsProxy;if(n===void 0)throw new Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return typeof n=="function"?n(e,r):`${n}?address=${e}:${r}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(e,r,n){this.connecting=!0,n&&this.once("connect",n);let i=w(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),s=w((o,c=!1)=>{o.binaryType="arraybuffer",o.addEventListener("error",l=>{this.emit("error",l),this.emit("close")}),o.addEventListener("message",l=>{if(this.tlsState===0){let u=he.from(l.data);this.emit("data",u)}}),o.addEventListener("close",()=>{this.emit("close")}),c?i():o.addEventListener("open",i)},"configureWebSocket"),a;try{a=this.wsProxyAddrForHost(r,typeof e=="string"?parseInt(e,10):e)}catch(o){this.emit("error",o),this.emit("close");return}try{let o=(this.useSecureWebSocket?"wss:":"ws:")+"//"+a;if(this.webSocketConstructor!==void 0)this.ws=new this.webSocketConstructor(o),s(this.ws);else try{this.ws=new WebSocket(o),s(this.ws)}catch{this.ws=new __unstable_WebSocket(o),s(this.ws)}}catch(o){let c=(this.useSecureWebSocket?"https:":"http:")+"//"+a;fetch(c,{headers:{Upgrade:"websocket"}}).then(l=>{if(this.ws=l.webSocket,this.ws==null)throw o;this.ws.accept(),s(this.ws,!0)}).catch(l=>{this.emit("error",new Error(`All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: ${l.message}`)),this.emit("close")})}}async startTls(e){if(this.subtls===void 0)throw new Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let r=this.subtls.TrustedCert.fromPEM(this.rootCerts),n=new this.subtls.WebSocketReadQueue(this.ws),i=n.read.bind(n),s=this.rawWrite.bind(this),[a,o]=await this.subtls.startTls(e,r,i,s,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=a,this.tlsWrite=o,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(e===void 0)break;{let r=he.from(e);this.emit("data",r)}}}rawWrite(e){if(!this.coalesceWrites){this.ws.send(e);return}if(this.writeBuffer===void 0)this.writeBuffer=e,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let r=new Uint8Array(this.writeBuffer.length+e.length);r.set(this.writeBuffer),r.set(e,this.writeBuffer.length),this.writeBuffer=r}}write(e,r="utf8",n=i=>{}){return e.length===0?(n(),!0):(typeof e=="string"&&(e=he.from(e,r)),this.tlsState===0?(this.rawWrite(e),n()):this.tlsState===1?this.once("secureConnection",()=>{this.write(e,r,n)}):(this.tlsWrite(e),n()),!0)}end(e=he.alloc(0),r="utf8",n=()=>{}){return this.write(e,r,()=>{this.ws.close(),n()}),this}destroy(){return this.destroyed=!0,this.end()}},w(Tl,"Socket"),me(Tl,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:w((t,e,r)=>{let n;return r?.jwtAuth?n=t.replace(ly,"apiauth."):n=t.replace(ly,"api."),"https://"+n+"/sql"},"fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:w(t=>t+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1}),me(Tl,"opts",{}),Wa=Tl}),lA=xe(t=>{"use strict";ae(),Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeMessage=t.DataRowMessage=t.CommandCompleteMessage=t.ReadyForQueryMessage=t.NotificationResponseMessage=t.BackendKeyDataMessage=t.AuthenticationMD5Password=t.ParameterStatusMessage=t.ParameterDescriptionMessage=t.RowDescriptionMessage=t.Field=t.CopyResponse=t.CopyDataMessage=t.DatabaseError=t.copyDone=t.emptyQuery=t.replicationStart=t.portalSuspended=t.noData=t.closeComplete=t.bindComplete=t.parseComplete=void 0,t.parseComplete={name:"parseComplete",length:5},t.bindComplete={name:"bindComplete",length:5},t.closeComplete={name:"closeComplete",length:5},t.noData={name:"noData",length:5},t.portalSuspended={name:"portalSuspended",length:5},t.replicationStart={name:"replicationStart",length:4},t.emptyQuery={name:"emptyQuery",length:4},t.copyDone={name:"copyDone",length:4};var e=class extends Error{constructor(B,z,X){super(B),this.length=z,this.name=X}};w(e,"DatabaseError");var r=e;t.DatabaseError=r;var n=class{constructor(B,z){this.length=B,this.chunk=z,this.name="copyData"}};w(n,"CopyDataMessage");var i=n;t.CopyDataMessage=i;var s=class{constructor(B,z,X,K){this.length=B,this.name=z,this.binary=X,this.columnTypes=new Array(K)}};w(s,"CopyResponse");var a=s;t.CopyResponse=a;var o=class{constructor(B,z,X,K,oe,we,pe){this.name=B,this.tableID=z,this.columnID=X,this.dataTypeID=K,this.dataTypeSize=oe,this.dataTypeModifier=we,this.format=pe}};w(o,"Field");var c=o;t.Field=c;var l=class{constructor(B,z){this.length=B,this.fieldCount=z,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};w(l,"RowDescriptionMessage");var u=l;t.RowDescriptionMessage=u;var p=class{constructor(B,z){this.length=B,this.parameterCount=z,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};w(p,"ParameterDescriptionMessage");var d=p;t.ParameterDescriptionMessage=d;var g=class{constructor(B,z,X){this.length=B,this.parameterName=z,this.parameterValue=X,this.name="parameterStatus"}};w(g,"ParameterStatusMessage");var m=g;t.ParameterStatusMessage=m;var f=class{constructor(B,z){this.length=B,this.salt=z,this.name="authenticationMD5Password"}};w(f,"AuthenticationMD5Password");var v=f;t.AuthenticationMD5Password=v;var x=class{constructor(B,z,X){this.length=B,this.processID=z,this.secretKey=X,this.name="backendKeyData"}};w(x,"BackendKeyDataMessage");var _=x;t.BackendKeyDataMessage=_;var S=class{constructor(B,z,X,K){this.length=B,this.processId=z,this.channel=X,this.payload=K,this.name="notification"}};w(S,"NotificationResponseMessage");var T=S;t.NotificationResponseMessage=T;var O=class{constructor(B,z){this.length=B,this.status=z,this.name="readyForQuery"}};w(O,"ReadyForQueryMessage");var E=O;t.ReadyForQueryMessage=E;var A=class{constructor(B,z){this.length=B,this.text=z,this.name="commandComplete"}};w(A,"CommandCompleteMessage");var k=A;t.CommandCompleteMessage=k;var C=class{constructor(B,z){this.length=B,this.fields=z,this.name="dataRow",this.fieldCount=z.length}};w(C,"DataRowMessage");var j=C;t.DataRowMessage=j;var L=class{constructor(B,z){this.length=B,this.message=z,this.name="notice"}};w(L,"NoticeMessage");var V=L;t.NoticeMessage=V}),pU=xe(t=>{"use strict";ae(),Object.defineProperty(t,"__esModule",{value:!0}),t.Writer=void 0;var e=class{constructor(i=256){this.size=i,this.offset=5,this.headerPosition=0,this.buffer=he.allocUnsafe(i)}ensure(i){var s=this.buffer.length-this.offset;if(s<i){var a=this.buffer,o=a.length+(a.length>>1)+i;this.buffer=he.allocUnsafe(o),a.copy(this.buffer)}}addInt32(i){return this.ensure(4),this.buffer[this.offset++]=i>>>24&255,this.buffer[this.offset++]=i>>>16&255,this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addInt16(i){return this.ensure(2),this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addCString(i){if(!i)this.ensure(1);else{var s=he.byteLength(i);this.ensure(s+1),this.buffer.write(i,this.offset,"utf-8"),this.offset+=s}return this.buffer[this.offset++]=0,this}addString(i=""){var s=he.byteLength(i);return this.ensure(s),this.buffer.write(i,this.offset),this.offset+=s,this}add(i){return this.ensure(i.length),i.copy(this.buffer,this.offset),this.offset+=i.length,this}join(i){if(i){this.buffer[this.headerPosition]=i;let s=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(s,this.headerPosition+1)}return this.buffer.slice(i?0:5,this.offset)}flush(i){var s=this.join(i);return this.offset=5,this.headerPosition=0,this.buffer=he.allocUnsafe(this.size),s}};w(e,"Writer");var r=e;t.Writer=r}),fU=xe(t=>{"use strict";ae(),Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;var e=pU(),r=new e.Writer,n=w(B=>{r.addInt16(3).addInt16(0);for(let K of Object.keys(B))r.addCString(K).addCString(B[K]);r.addCString("client_encoding").addCString("UTF8");var z=r.addCString("").flush(),X=z.length+4;return new e.Writer().addInt32(X).add(z).flush()},"startup"),i=w(()=>{let B=he.allocUnsafe(8);return B.writeInt32BE(8,0),B.writeInt32BE(80877103,4),B},"requestSsl"),s=w(B=>r.addCString(B).flush(112),"password"),a=w(function(B,z){return r.addCString(B).addInt32(he.byteLength(z)).addString(z),r.flush(112)},"sendSASLInitialResponseMessage"),o=w(function(B){return r.addString(B).flush(112)},"sendSCRAMClientFinalMessage"),c=w(B=>r.addCString(B).flush(81),"query"),l=[],u=w(B=>{let z=B.name||"";z.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",z,z.length),console.error("This can cause conflicts and silent errors executing queries"));let X=B.types||l;for(var K=X.length,oe=r.addCString(z).addCString(B.text).addInt16(K),we=0;we<K;we++)oe.addInt32(X[we]);return r.flush(80)},"parse"),p=new e.Writer,d=w(function(B,z){for(let X=0;X<B.length;X++){let K=z?z(B[X],X):B[X];K==null?(r.addInt16(0),p.addInt32(-1)):K instanceof he?(r.addInt16(1),p.addInt32(K.length),p.add(K)):(r.addInt16(0),p.addInt32(he.byteLength(K)),p.addString(K))}},"writeValues"),g=w((B={})=>{let z=B.portal||"",X=B.statement||"",K=B.binary||!1,oe=B.values||l,we=oe.length;return r.addCString(z).addCString(X),r.addInt16(we),d(oe,B.valueMapper),r.addInt16(we),r.add(p.flush()),r.addInt16(K?1:0),r.flush(66)},"bind"),m=he.from([69,0,0,0,9,0,0,0,0,0]),f=w(B=>{if(!B||!B.portal&&!B.rows)return m;let z=B.portal||"",X=B.rows||0,K=he.byteLength(z),oe=4+K+1+4,we=he.allocUnsafe(1+oe);return we[0]=69,we.writeInt32BE(oe,1),we.write(z,5,"utf-8"),we[K+5]=0,we.writeUInt32BE(X,we.length-4),we},"execute"),v=w((B,z)=>{let X=he.allocUnsafe(16);return X.writeInt32BE(16,0),X.writeInt16BE(1234,4),X.writeInt16BE(5678,6),X.writeInt32BE(B,8),X.writeInt32BE(z,12),X},"cancel"),x=w((B,z)=>{let X=4+he.byteLength(z)+1,K=he.allocUnsafe(1+X);return K[0]=B,K.writeInt32BE(X,1),K.write(z,5,"utf-8"),K[X]=0,K},"cstringMessage"),_=r.addCString("P").flush(68),S=r.addCString("S").flush(68),T=w(B=>B.name?x(68,`${B.type}${B.name||""}`):B.type==="P"?_:S,"describe"),O=w(B=>{let z=`${B.type}${B.name||""}`;return x(67,z)},"close"),E=w(B=>r.add(B).flush(100),"copyData"),A=w(B=>x(102,B),"copyFail"),k=w(B=>he.from([B,0,0,0,4]),"codeOnlyBuffer"),C=k(72),j=k(83),L=k(88),V=k(99),H={startup:n,password:s,requestSsl:i,sendSASLInitialResponseMessage:a,sendSCRAMClientFinalMessage:o,query:c,parse:u,bind:g,execute:f,describe:T,close:O,flush:w(()=>C,"flush"),sync:w(()=>j,"sync"),end:w(()=>L,"end"),copyData:E,copyDone:w(()=>V,"copyDone"),copyFail:A,cancel:v};t.serialize=H}),dU=xe(t=>{"use strict";ae(),Object.defineProperty(t,"__esModule",{value:!0}),t.BufferReader=void 0;var e=he.allocUnsafe(0),r=class{constructor(s=0){this.offset=s,this.buffer=e,this.encoding="utf-8"}setBuffer(s,a){this.offset=s,this.buffer=a}int16(){let s=this.buffer.readInt16BE(this.offset);return this.offset+=2,s}byte(){let s=this.buffer[this.offset];return this.offset++,s}int32(){let s=this.buffer.readInt32BE(this.offset);return this.offset+=4,s}string(s){let a=this.buffer.toString(this.encoding,this.offset,this.offset+s);return this.offset+=s,a}cstring(){let s=this.offset,a=s;for(;this.buffer[a++]!==0;);return this.offset=a,this.buffer.toString(this.encoding,s,a-1)}bytes(s){let a=this.buffer.slice(this.offset,this.offset+s);return this.offset+=s,a}};w(r,"BufferReader");var n=r;t.BufferReader=n}),hU=xe(t=>{"use strict";ae(),Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var e=lA(),r=dU(),n=1,i=4,s=n+i,a=he.allocUnsafe(0),o=class{constructor(u){if(this.buffer=a,this.bufferLength=0,this.bufferOffset=0,this.reader=new r.BufferReader,u?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=u?.mode||"text"}parse(u,p){this.mergeBuffer(u);let d=this.bufferOffset+this.bufferLength,g=this.bufferOffset;for(;g+s<=d;){let m=this.buffer[g],f=this.buffer.readUInt32BE(g+n),v=n+f;if(v+g<=d){let x=this.handlePacket(g+s,m,f,this.buffer);p(x),g+=v}else break}g===d?(this.buffer=a,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=d-g,this.bufferOffset=g)}mergeBuffer(u){if(this.bufferLength>0){let p=this.bufferLength+u.byteLength;if(p+this.bufferOffset>this.buffer.byteLength){let d;if(p<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)d=this.buffer;else{let g=this.buffer.byteLength*2;for(;p>=g;)g*=2;d=he.allocUnsafe(g)}this.buffer.copy(d,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=d,this.bufferOffset=0}u.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=p}else this.buffer=u,this.bufferOffset=0,this.bufferLength=u.byteLength}handlePacket(u,p,d,g){switch(p){case 50:return e.bindComplete;case 49:return e.parseComplete;case 51:return e.closeComplete;case 110:return e.noData;case 115:return e.portalSuspended;case 99:return e.copyDone;case 87:return e.replicationStart;case 73:return e.emptyQuery;case 68:return this.parseDataRowMessage(u,d,g);case 67:return this.parseCommandCompleteMessage(u,d,g);case 90:return this.parseReadyForQueryMessage(u,d,g);case 65:return this.parseNotificationMessage(u,d,g);case 82:return this.parseAuthenticationResponse(u,d,g);case 83:return this.parseParameterStatusMessage(u,d,g);case 75:return this.parseBackendKeyData(u,d,g);case 69:return this.parseErrorMessage(u,d,g,"error");case 78:return this.parseErrorMessage(u,d,g,"notice");case 84:return this.parseRowDescriptionMessage(u,d,g);case 116:return this.parseParameterDescriptionMessage(u,d,g);case 71:return this.parseCopyInMessage(u,d,g);case 72:return this.parseCopyOutMessage(u,d,g);case 100:return this.parseCopyData(u,d,g);default:return new e.DatabaseError("received invalid response: "+p.toString(16),d,"error")}}parseReadyForQueryMessage(u,p,d){this.reader.setBuffer(u,d);let g=this.reader.string(1);return new e.ReadyForQueryMessage(p,g)}parseCommandCompleteMessage(u,p,d){this.reader.setBuffer(u,d);let g=this.reader.cstring();return new e.CommandCompleteMessage(p,g)}parseCopyData(u,p,d){let g=d.slice(u,u+(p-4));return new e.CopyDataMessage(p,g)}parseCopyInMessage(u,p,d){return this.parseCopyMessage(u,p,d,"copyInResponse")}parseCopyOutMessage(u,p,d){return this.parseCopyMessage(u,p,d,"copyOutResponse")}parseCopyMessage(u,p,d,g){this.reader.setBuffer(u,d);let m=this.reader.byte()!==0,f=this.reader.int16(),v=new e.CopyResponse(p,g,m,f);for(let x=0;x<f;x++)v.columnTypes[x]=this.reader.int16();return v}parseNotificationMessage(u,p,d){this.reader.setBuffer(u,d);let g=this.reader.int32(),m=this.reader.cstring(),f=this.reader.cstring();return new e.NotificationResponseMessage(p,g,m,f)}parseRowDescriptionMessage(u,p,d){this.reader.setBuffer(u,d);let g=this.reader.int16(),m=new e.RowDescriptionMessage(p,g);for(let f=0;f<g;f++)m.fields[f]=this.parseField();return m}parseField(){let u=this.reader.cstring(),p=this.reader.int32(),d=this.reader.int16(),g=this.reader.int32(),m=this.reader.int16(),f=this.reader.int32(),v=this.reader.int16()===0?"text":"binary";return new e.Field(u,p,d,g,m,f,v)}parseParameterDescriptionMessage(u,p,d){this.reader.setBuffer(u,d);let g=this.reader.int16(),m=new e.ParameterDescriptionMessage(p,g);for(let f=0;f<g;f++)m.dataTypeIDs[f]=this.reader.int32();return m}parseDataRowMessage(u,p,d){this.reader.setBuffer(u,d);let g=this.reader.int16(),m=new Array(g);for(let f=0;f<g;f++){let v=this.reader.int32();m[f]=v===-1?null:this.reader.string(v)}return new e.DataRowMessage(p,m)}parseParameterStatusMessage(u,p,d){this.reader.setBuffer(u,d);let g=this.reader.cstring(),m=this.reader.cstring();return new e.ParameterStatusMessage(p,g,m)}parseBackendKeyData(u,p,d){this.reader.setBuffer(u,d);let g=this.reader.int32(),m=this.reader.int32();return new e.BackendKeyDataMessage(p,g,m)}parseAuthenticationResponse(u,p,d){this.reader.setBuffer(u,d);let g=this.reader.int32(),m={name:"authenticationOk",length:p};switch(g){case 0:break;case 3:m.length===8&&(m.name="authenticationCleartextPassword");break;case 5:if(m.length===12){m.name="authenticationMD5Password";let v=this.reader.bytes(4);return new e.AuthenticationMD5Password(p,v)}break;case 10:m.name="authenticationSASL",m.mechanisms=[];let f;do f=this.reader.cstring(),f&&m.mechanisms.push(f);while(f);break;case 11:m.name="authenticationSASLContinue",m.data=this.reader.string(p-8);break;case 12:m.name="authenticationSASLFinal",m.data=this.reader.string(p-8);break;default:throw new Error("Unknown authenticationOk message type "+g)}return m}parseErrorMessage(u,p,d,g){this.reader.setBuffer(u,d);let m={},f=this.reader.string(1);for(;f!=="\0";)m[f]=this.reader.cstring(),f=this.reader.string(1);let v=m.M,x=g==="notice"?new e.NoticeMessage(p,v):new e.DatabaseError(v,p,g);return x.severity=m.S,x.code=m.C,x.detail=m.D,x.hint=m.H,x.position=m.P,x.internalPosition=m.p,x.internalQuery=m.q,x.where=m.W,x.schema=m.s,x.table=m.t,x.column=m.c,x.dataType=m.d,x.constraint=m.n,x.file=m.F,x.line=m.L,x.routine=m.R,x}};w(o,"Parser");var c=o;t.Parser=c}),uA=xe(t=>{"use strict";ae(),Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseError=t.serialize=t.parse=void 0;var e=lA();Object.defineProperty(t,"DatabaseError",{enumerable:!0,get:w(function(){return e.DatabaseError},"get")});var r=fU();Object.defineProperty(t,"serialize",{enumerable:!0,get:w(function(){return r.serialize},"get")});var n=hU();function i(s,a){let o=new n.Parser;return s.on("data",c=>o.parse(c,a)),new Promise(c=>s.on("end",()=>c()))}w(i,"parse"),t.parse=i}),pA={};Pr(pA,{connect:()=>fA});function fA({socket:t,servername:e}){return t.startTls(e),t}var mU=Jt(()=>{"use strict";ae(),w(fA,"connect")}),dA=xe((t,e)=>{"use strict";ae();var r=(xy(),St(oA)),n=is().EventEmitter,{parse:i,serialize:s}=uA(),a=s.flush(),o=s.sync(),c=s.end(),l=class extends n{constructor(d){super(),d=d||{},this.stream=d.stream||new r.Socket,this._keepAlive=d.keepAlive,this._keepAliveInitialDelayMillis=d.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=d.ssl||!1,this._ending=!1,this._emitMessage=!1;var g=this;this.on("newListener",function(m){m==="message"&&(g._emitMessage=!0)})}connect(d,g){var m=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(d,g),this.stream.once("connect",function(){m._keepAlive&&m.stream.setKeepAlive(!0,m._keepAliveInitialDelayMillis),m.emit("connect")});let f=w(function(v){m._ending&&(v.code==="ECONNRESET"||v.code==="EPIPE")||m.emit("error",v)},"reportStreamError");if(this.stream.on("error",f),this.stream.on("close",function(){m.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(v){var x=v.toString("utf8");switch(x){case"S":break;case"N":return m.stream.end(),m.emit("error",new Error("The server does not support SSL connections"));default:return m.stream.end(),m.emit("error",new Error("There was an error establishing an SSL connection"))}var _=(mU(),St(pA));let S={socket:m.stream};m.ssl!==!0&&(Object.assign(S,m.ssl),"key"in m.ssl&&(S.key=m.ssl.key)),r.isIP(g)===0&&(S.servername=g);try{m.stream=_.connect(S)}catch(T){return m.emit("error",T)}m.attachListeners(m.stream),m.stream.on("error",f),m.emit("sslconnect")})}attachListeners(d){d.on("end",()=>{this.emit("end")}),i(d,g=>{var m=g.name==="error"?"errorMessage":g.name;this._emitMessage&&this.emit("message",g),this.emit(m,g)})}requestSsl(){this.stream.write(s.requestSsl())}startup(d){this.stream.write(s.startup(d))}cancel(d,g){this._send(s.cancel(d,g))}password(d){this._send(s.password(d))}sendSASLInitialResponseMessage(d,g){this._send(s.sendSASLInitialResponseMessage(d,g))}sendSCRAMClientFinalMessage(d){this._send(s.sendSCRAMClientFinalMessage(d))}_send(d){return this.stream.writable?this.stream.write(d):!1}query(d){this._send(s.query(d))}parse(d){this._send(s.parse(d))}bind(d){this._send(s.bind(d))}execute(d){this._send(s.execute(d))}flush(){this.stream.writable&&this.stream.write(a)}sync(){this._ending=!0,this._send(a),this._send(o)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(c,()=>{this.stream.end()})}close(d){this._send(s.close(d))}describe(d){this._send(s.describe(d))}sendCopyFromChunk(d){this._send(s.copyData(d))}endCopyFrom(){this._send(s.copyDone())}sendCopyFail(d){this._send(s.copyFail(d))}};w(l,"Connection");var u=l;e.exports=u}),gU=xe((t,e)=>{"use strict";ae();var r=is().EventEmitter,n=(Ef(),St(Il)),i=kf(),s=rU(),a=aU(),o=vy(),c=by(),l=uU(),u=Af(),p=dA(),d=class extends r{constructor(f){super(),this.connectionParameters=new c(f),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var v=f||{};this._Promise=v.Promise||Sf.Promise,this._types=new o(v.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=v.connection||new p({stream:v.stream,ssl:this.connectionParameters.ssl,keepAlive:v.keepAlive||!1,keepAliveInitialDelayMillis:v.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=v.binary||u.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=v.connectionTimeoutMillis||0}_errorAllQueries(f){let v=w(x=>{be.nextTick(()=>{x.handleError(f,this.connection)})},"enqueueError");this.activeQuery&&(v(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(v),this.queryQueue.length=0}_connect(f){var v=this,x=this.connection;if(this._connectionCallback=f,this._connecting||this._connected){let _=new Error("Client has already been connected. You cannot reuse a client.");be.nextTick(()=>{f(_)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{x._ending=!0,x.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?x.connect(this.host+"/.s.PGSQL."+this.port):x.connect(this.port,this.host),x.on("connect",function(){v.ssl?x.requestSsl():x.startup(v.getStartupConf())}),x.on("sslconnect",function(){x.startup(v.getStartupConf())}),this._attachListeners(x),x.once("end",()=>{let _=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(_),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(_):this._handleErrorEvent(_):this._connectionError||this._handleErrorEvent(_)),be.nextTick(()=>{this.emit("end")})})}connect(f){if(f){this._connect(f);return}return new this._Promise((v,x)=>{this._connect(_=>{_?x(_):v()})})}_attachListeners(f){f.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),f.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),f.on("authenticationSASL",this._handleAuthSASL.bind(this)),f.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),f.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),f.on("backendKeyData",this._handleBackendKeyData.bind(this)),f.on("error",this._handleErrorEvent.bind(this)),f.on("errorMessage",this._handleErrorMessage.bind(this)),f.on("readyForQuery",this._handleReadyForQuery.bind(this)),f.on("notice",this._handleNotice.bind(this)),f.on("rowDescription",this._handleRowDescription.bind(this)),f.on("dataRow",this._handleDataRow.bind(this)),f.on("portalSuspended",this._handlePortalSuspended.bind(this)),f.on("emptyQuery",this._handleEmptyQuery.bind(this)),f.on("commandComplete",this._handleCommandComplete.bind(this)),f.on("parseComplete",this._handleParseComplete.bind(this)),f.on("copyInResponse",this._handleCopyInResponse.bind(this)),f.on("copyData",this._handleCopyData.bind(this)),f.on("notification",this._handleNotification.bind(this))}_checkPgPass(f){let v=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(x=>{if(x!==void 0){if(typeof x!="string"){v.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=x}else this.connectionParameters.password=this.password=null;f()}).catch(x=>{v.emit("error",x)}):this.password!==null?f():a(this.connectionParameters,x=>{x!==void 0&&(this.connectionParameters.password=this.password=x),f()})}_handleAuthCleartextPassword(f){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(f){this._checkPgPass(()=>{let v=i.postgresMd5PasswordHash(this.user,this.password,f.salt);this.connection.password(v)})}_handleAuthSASL(f){this._checkPgPass(()=>{this.saslSession=s.startSession(f.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(f){s.continueSession(this.saslSession,this.password,f.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(f){s.finalizeSession(this.saslSession,f.data),this.saslSession=null}_handleBackendKeyData(f){this.processID=f.processID,this.secretKey=f.secretKey}_handleReadyForQuery(f){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:v}=this;this.activeQuery=null,this.readyForQuery=!0,v&&v.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(f){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(f);this.emit("error",f)}}_handleErrorEvent(f){if(this._connecting)return this._handleErrorWhileConnecting(f);this._queryable=!1,this._errorAllQueries(f),this.emit("error",f)}_handleErrorMessage(f){if(this._connecting)return this._handleErrorWhileConnecting(f);let v=this.activeQuery;if(!v){this._handleErrorEvent(f);return}this.activeQuery=null,v.handleError(f,this.connection)}_handleRowDescription(f){this.activeQuery.handleRowDescription(f)}_handleDataRow(f){this.activeQuery.handleDataRow(f)}_handlePortalSuspended(f){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(f){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(f){this.activeQuery.handleCommandComplete(f,this.connection)}_handleParseComplete(f){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(f){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(f){this.activeQuery.handleCopyData(f,this.connection)}_handleNotification(f){this.emit("notification",f)}_handleNotice(f){this.emit("notice",f)}getStartupConf(){var f=this.connectionParameters,v={user:f.user,database:f.database},x=f.application_name||f.fallback_application_name;return x&&(v.application_name=x),f.replication&&(v.replication=""+f.replication),f.statement_timeout&&(v.statement_timeout=String(parseInt(f.statement_timeout,10))),f.lock_timeout&&(v.lock_timeout=String(parseInt(f.lock_timeout,10))),f.idle_in_transaction_session_timeout&&(v.idle_in_transaction_session_timeout=String(parseInt(f.idle_in_transaction_session_timeout,10))),f.options&&(v.options=f.options),v}cancel(f,v){if(f.activeQuery===v){var x=this.connection;this.host&&this.host.indexOf("/")===0?x.connect(this.host+"/.s.PGSQL."+this.port):x.connect(this.port,this.host),x.on("connect",function(){x.cancel(f.processID,f.secretKey)})}else f.queryQueue.indexOf(v)!==-1&&f.queryQueue.splice(f.queryQueue.indexOf(v),1)}setTypeParser(f,v,x){return this._types.setTypeParser(f,v,x)}getTypeParser(f,v){return this._types.getTypeParser(f,v)}escapeIdentifier(f){return'"'+f.replace(/"/g,'""')+'"'}escapeLiteral(f){for(var v=!1,x="'",_=0;_<f.length;_++){var S=f[_];S==="'"?x+=S+S:S==="\\"?(x+=S+S,v=!0):x+=S}return x+="'",v===!0&&(x=" E"+x),x}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let f=this.activeQuery.submit(this.connection);f&&be.nextTick(()=>{this.activeQuery.handleError(f,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(f,v,x){var _,S,T,O,E;if(f==null)throw new TypeError("Client was passed a null or undefined query");return typeof f.submit=="function"?(T=f.query_timeout||this.connectionParameters.query_timeout,S=_=f,typeof v=="function"&&(_.callback=_.callback||v)):(T=this.connectionParameters.query_timeout,_=new l(f,v,x),_.callback||(S=new this._Promise((A,k)=>{_.callback=(C,j)=>C?k(C):A(j)}))),T&&(E=_.callback,O=setTimeout(()=>{var A=new Error("Query read timeout");be.nextTick(()=>{_.handleError(A,this.connection)}),E(A),_.callback=()=>{};var k=this.queryQueue.indexOf(_);k>-1&&this.queryQueue.splice(k,1),this._pulseQueryQueue()},T),_.callback=(A,k)=>{clearTimeout(O),E(A,k)}),this.binary&&!_.binary&&(_.binary=!0),_._result&&!_._result._types&&(_._result._types=this._types),this._queryable?this._ending?(be.nextTick(()=>{_.handleError(new Error("Client was closed and is not queryable"),this.connection)}),S):(this.queryQueue.push(_),this._pulseQueryQueue(),S):(be.nextTick(()=>{_.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),S)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(f){if(this._ending=!0,!this.connection._connecting)if(f)f();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),f)this.connection.once("end",f);else return new this._Promise(v=>{this.connection.once("end",v)})}};w(d,"Client");var g=d;g.Query=l,e.exports=g}),vU=xe((t,e)=>{"use strict";ae();var r=is().EventEmitter,n=w(function(){},"NOOP"),i=w((m,f)=>{let v=m.findIndex(f);return v===-1?void 0:m.splice(v,1)[0]},"removeWhere"),s=class{constructor(f,v,x){this.client=f,this.idleListener=v,this.timeoutId=x}};w(s,"IdleItem");var a=s,o=class{constructor(f){this.callback=f}};w(o,"PendingItem");var c=o;function l(){throw new Error("Release called on client which has already been released to the pool.")}w(l,"throwOnDoubleRelease");function u(m,f){if(f)return{callback:f,result:void 0};let v,x,_=w(function(T,O){T?v(T):x(O)},"cb"),S=new m(function(T,O){x=T,v=O}).catch(T=>{throw Error.captureStackTrace(T),T});return{callback:_,result:S}}w(u,"promisify");function p(m,f){return w(function v(x){x.client=f,f.removeListener("error",v),f.on("error",()=>{m.log("additional client error after disconnection due to error",x)}),m._remove(f),m.emit("error",x,f)},"idleListener")}w(p,"makeIdleListener");var d=class extends r{constructor(f,v){super(),this.options=Object.assign({},f),f!=null&&"password"in f&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:f.password}),f!=null&&f.ssl&&f.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||v||wy().Client,this.Promise=this.options.Promise||Sf.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(v=>{this._remove(v.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let f=this._pendingQueue.shift();if(this._idle.length){let v=this._idle.pop();clearTimeout(v.timeoutId);let x=v.client;x.ref&&x.ref();let _=v.idleListener;return this._acquireClient(x,f,_,!1)}if(!this._isFull())return this.newClient(f);throw new Error("unexpected condition")}_remove(f){let v=i(this._idle,x=>x.client===f);v!==void 0&&clearTimeout(v.timeoutId),this._clients=this._clients.filter(x=>x!==f),f.end(),this.emit("remove",f)}connect(f){if(this.ending){let _=new Error("Cannot use a pool after calling end on the pool");return f?f(_):this.Promise.reject(_)}let v=u(this.Promise,f),x=v.result;if(this._isFull()||this._idle.length){if(this._idle.length&&be.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new c(v.callback)),x;let _=w((O,E,A)=>{clearTimeout(T),v.callback(O,E,A)},"queueCallback"),S=new c(_),T=setTimeout(()=>{i(this._pendingQueue,O=>O.callback===_),S.timedOut=!0,v.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(S),x}return this.newClient(new c(v.callback)),x}newClient(f){let v=new this.Client(this.options);this._clients.push(v);let x=p(this,v);this.log("checking client timeout");let _,S=!1;this.options.connectionTimeoutMillis&&(_=setTimeout(()=>{this.log("ending client due to timeout"),S=!0,v.connection?v.connection.stream.destroy():v.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),v.connect(T=>{if(_&&clearTimeout(_),v.on("error",x),T)this.log("client failed to connect",T),this._clients=this._clients.filter(O=>O!==v),S&&(T.message="Connection terminated due to connection timeout"),this._pulseQueue(),f.timedOut||f.callback(T,void 0,n);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let O=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(v),this._idle.findIndex(E=>E.client===v)!==-1&&this._acquireClient(v,new c((E,A,k)=>k()),x,!1)},this.options.maxLifetimeSeconds*1e3);O.unref(),v.once("end",()=>clearTimeout(O))}return this._acquireClient(v,f,x,!0)}})}_acquireClient(f,v,x,_){_&&this.emit("connect",f),this.emit("acquire",f),f.release=this._releaseOnce(f,x),f.removeListener("error",x),v.timedOut?_&&this.options.verify?this.options.verify(f,f.release):f.release():_&&this.options.verify?this.options.verify(f,S=>{if(S)return f.release(S),v.callback(S,void 0,n);v.callback(void 0,f,f.release)}):v.callback(void 0,f,f.release)}_releaseOnce(f,v){let x=!1;return _=>{x&&l(),x=!0,this._release(f,v,_)}}_release(f,v,x){if(f.on("error",v),f._poolUseCount=(f._poolUseCount||0)+1,this.emit("release",x,f),x||this.ending||!f._queryable||f._ending||f._poolUseCount>=this.options.maxUses){f._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(f),this._pulseQueue();return}if(this._expired.has(f)){this.log("remove expired client"),this._expired.delete(f),this._remove(f),this._pulseQueue();return}let _;this.options.idleTimeoutMillis&&(_=setTimeout(()=>{this.log("remove idle client"),this._remove(f)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&_.unref()),this.options.allowExitOnIdle&&f.unref(),this._idle.push(new a(f,v,_)),this._pulseQueue()}query(f,v,x){if(typeof f=="function"){let S=u(this.Promise,f);return fy(function(){return S.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),S.result}typeof v=="function"&&(x=v,v=void 0);let _=u(this.Promise,x);return x=_.callback,this.connect((S,T)=>{if(S)return x(S);let O=!1,E=w(A=>{O||(O=!0,T.release(A),x(A))},"onError");T.once("error",E),this.log("dispatching query");try{T.query(f,v,(A,k)=>{if(this.log("query dispatched"),T.removeListener("error",E),!O)return O=!0,T.release(A),A?x(A):x(void 0,k)})}catch(A){return T.release(A),x(A)}}),_.result}end(f){if(this.log("ending"),this.ending){let x=new Error("Called end on pool more than once");return f?f(x):this.Promise.reject(x)}this.ending=!0;let v=u(this.Promise,f);return this._endCallback=v.callback,this._pulseQueue(),v.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((f,v)=>f+(this._expired.has(v)?1:0),0)}get totalCount(){return this._clients.length}};w(d,"Pool");var g=d;e.exports=g}),hA={};Pr(hA,{default:()=>mA});var mA,yU=Jt(()=>{"use strict";ae(),mA={}}),bU=xe((t,e)=>{e.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),xU=xe((t,e)=>{"use strict";ae();var r=is().EventEmitter,n=(Ef(),St(Il)),i=kf(),s=e.exports=function(o,c,l){r.call(this),o=i.normalizeQueryConfig(o,c,l),this.text=o.text,this.values=o.values,this.name=o.name,this.callback=o.callback,this.state="new",this._arrayMode=o.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(u){u==="row"&&(this._emitRowEvents=!0)}.bind(this))};n.inherits(s,r);var a={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};s.prototype.handleError=function(o){var c=this.native.pq.resultErrorFields();if(c)for(var l in c){var u=a[l]||l;o[u]=c[l]}this.callback?this.callback(o):this.emit("error",o),this.state="error"},s.prototype.then=function(o,c){return this._getPromise().then(o,c)},s.prototype.catch=function(o){return this._getPromise().catch(o)},s.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(o,c){this._once("end",o),this._once("error",c)}.bind(this)),this._promise)},s.prototype.submit=function(o){this.state="running";var c=this;this.native=o.native,o.native.arrayMode=this._arrayMode;var l=w(function(d,g,m){if(o.native.arrayMode=!1,fy(function(){c.emit("_done")}),d)return c.handleError(d);c._emitRowEvents&&(m.length>1?g.forEach((f,v)=>{f.forEach(x=>{c.emit("row",x,m[v])})}):g.forEach(function(f){c.emit("row",f,m)})),c.state="end",c.emit("end",m),c.callback&&c.callback(null,m)},"after");if(be.domain&&(l=be.domain.bind(l)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var u=(this.values||[]).map(i.prepareValue);if(o.namedQueries[this.name]){if(this.text&&o.namedQueries[this.name]!==this.text){let d=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return l(d)}return o.native.execute(this.name,u,l)}return o.native.prepare(this.name,this.text,u.length,function(d){return d?l(d):(o.namedQueries[c.name]=c.text,c.native.execute(c.name,u,l))})}else if(this.values){if(!Array.isArray(this.values)){let d=new Error("Query values must be an array");return l(d)}var p=this.values.map(i.prepareValue);o.native.query(this.text,p,l)}else o.native.query(this.text,l)}}),wU=xe((t,e)=>{"use strict";ae();var r=(yU(),St(hA)),n=vy(),i=bU(),s=is().EventEmitter,a=(Ef(),St(Il)),o=by(),c=xU(),l=e.exports=function(u){s.call(this),u=u||{},this._Promise=u.Promise||Sf.Promise,this._types=new n(u.types),this.native=new r({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var p=this.connectionParameters=new o(u);this.user=p.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:p.password}),this.database=p.database,this.host=p.host,this.port=p.port,this.namedQueries={}};l.Query=c,a.inherits(l,s),l.prototype._errorAllQueries=function(u){let p=w(d=>{be.nextTick(()=>{d.native=this.native,d.handleError(u)})},"enqueueError");this._hasActiveQuery()&&(p(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(p),this._queryQueue.length=0},l.prototype._connect=function(u){var p=this;if(this._connecting){be.nextTick(()=>u(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(d,g){if(d)return u(d);p.native.connect(g,function(m){if(m)return p.native.end(),u(m);p._connected=!0,p.native.on("error",function(f){p._queryable=!1,p._errorAllQueries(f),p.emit("error",f)}),p.native.on("notification",function(f){p.emit("notification",{channel:f.relname,payload:f.extra})}),p.emit("connect"),p._pulseQueryQueue(!0),u()})})},l.prototype.connect=function(u){if(u){this._connect(u);return}return new this._Promise((p,d)=>{this._connect(g=>{g?d(g):p()})})},l.prototype.query=function(u,p,d){var g,m,f,v,x;if(u==null)throw new TypeError("Client was passed a null or undefined query");if(typeof u.submit=="function")f=u.query_timeout||this.connectionParameters.query_timeout,m=g=u,typeof p=="function"&&(u.callback=p);else if(f=this.connectionParameters.query_timeout,g=new c(u,p,d),!g.callback){let _,S;m=new this._Promise((T,O)=>{_=T,S=O}),g.callback=(T,O)=>T?S(T):_(O)}return f&&(x=g.callback,v=setTimeout(()=>{var _=new Error("Query read timeout");be.nextTick(()=>{g.handleError(_,this.connection)}),x(_),g.callback=()=>{};var S=this._queryQueue.indexOf(g);S>-1&&this._queryQueue.splice(S,1),this._pulseQueryQueue()},f),g.callback=(_,S)=>{clearTimeout(v),x(_,S)}),this._queryable?this._ending?(g.native=this.native,be.nextTick(()=>{g.handleError(new Error("Client was closed and is not queryable"))}),m):(this._queryQueue.push(g),this._pulseQueryQueue(),m):(g.native=this.native,be.nextTick(()=>{g.handleError(new Error("Client has encountered a connection error and is not queryable"))}),m)},l.prototype.end=function(u){var p=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,u));var d;return u||(d=new this._Promise(function(g,m){u=w(f=>f?m(f):g(),"cb")})),this.native.end(function(){p._errorAllQueries(new Error("Connection terminated")),be.nextTick(()=>{p.emit("end"),u&&u()})}),d},l.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},l.prototype._pulseQueryQueue=function(u){if(this._connected&&!this._hasActiveQuery()){var p=this._queryQueue.shift();if(!p){u||this.emit("drain");return}this._activeQuery=p,p.submit(this);var d=this;p.once("_done",function(){d._pulseQueryQueue()})}},l.prototype.cancel=function(u){this._activeQuery===u?this.native.cancel(function(){}):this._queryQueue.indexOf(u)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(u),1)},l.prototype.ref=function(){},l.prototype.unref=function(){},l.prototype.setTypeParser=function(u,p,d){return this._types.setTypeParser(u,p,d)},l.prototype.getTypeParser=function(u,p){return this._types.getTypeParser(u,p)}}),B4=xe((t,e)=>{"use strict";ae(),e.exports=wU()}),wy=xe((t,e)=>{"use strict";ae();var r=gU(),n=Af(),i=dA(),s=vU(),{DatabaseError:a}=uA(),o=w(l=>{var u;return u=class extends s{constructor(p){super(p,l)}},w(u,"BoundPool"),u},"poolFactory"),c=w(function(l){this.defaults=n,this.Client=l,this.Query=this.Client.Query,this.Pool=o(this.Client),this._pools=[],this.Connection=i,this.types=Cf(),this.DatabaseError=a},"PG");typeof be.env.NODE_PG_FORCE_NATIVE<"u"?e.exports=new c(B4()):(e.exports=new c(r),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var l=null;try{l=new c(B4())}catch(u){if(u.code!=="MODULE_NOT_FOUND")throw u}return Object.defineProperty(e.exports,"native",{value:l}),l}}))});ae();var gA=Ha(wy());xy();ae();xy();aA();var _U=Ha(kf()),SU=Ha(vy());function vA(t){return t instanceof he?"\\x"+t.toString("hex"):t}w(vA,"encodeBuffersAsBytea");var yA=class bA extends Error{constructor(e){super(e),me(this,"name","NeonDbError"),me(this,"severity"),me(this,"code"),me(this,"detail"),me(this,"hint"),me(this,"position"),me(this,"internalPosition"),me(this,"internalQuery"),me(this,"where"),me(this,"schema"),me(this,"table"),me(this,"column"),me(this,"dataType"),me(this,"constraint"),me(this,"file"),me(this,"line"),me(this,"routine"),me(this,"sourceError"),"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,bA)}};w(yA,"NeonDbError");var Ua=yA,F4="transaction() expects an array of queries, or a function returning an array of queries",EU=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function xA(t,{arrayMode:e,fullResults:r,fetchOptions:n,isolationLevel:i,readOnly:s,deferrable:a,queryCallback:o,resultCallback:c,authToken:l}={}){if(!t)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let u;try{u=yy(t)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(t))}let{protocol:p,username:d,hostname:g,port:m,pathname:f}=u;if(p!=="postgres:"&&p!=="postgresql:"||!d||!g||!f)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function v(_,...S){let T,O;if(typeof _=="string")T=_,O=S[1],S=S[0]??[];else{T="";for(let A=0;A<_.length;A++)T+=_[A],A<S.length&&(T+="$"+(A+1))}S=S.map(A=>vA((0,_U.prepareValue)(A)));let E={query:T,params:S};return o&&o(E),wA(x,E,O)}w(v,"resolve"),v.transaction=async(_,S)=>{if(typeof _=="function"&&(_=_(v)),!Array.isArray(_))throw new Error(F4);_.forEach(E=>{if(E[Symbol.toStringTag]!=="NeonQueryPromise")throw new Error(F4)});let T=_.map(E=>E.parameterizedQuery),O=_.map(E=>E.opts??{});return x(T,O,S)};async function x(_,S,T){let{fetchEndpoint:O,fetchFunction:E}=Wa,A=Array.isArray(_)?{queries:_}:_,k=n??{},C=e??!1,j=r??!1,L=i,V=s,H=a;T!==void 0&&(T.fetchOptions!==void 0&&(k={...k,...T.fetchOptions}),T.arrayMode!==void 0&&(C=T.arrayMode),T.fullResults!==void 0&&(j=T.fullResults),T.isolationLevel!==void 0&&(L=T.isolationLevel),T.readOnly!==void 0&&(V=T.readOnly),T.deferrable!==void 0&&(H=T.deferrable)),S!==void 0&&!Array.isArray(S)&&S.fetchOptions!==void 0&&(k={...k,...S.fetchOptions});let B=l;!Array.isArray(S)&&S?.authToken!==void 0&&(B=S.authToken);let z=typeof O=="function"?O(g,m,{jwtAuth:B!==void 0}):O,X={"Neon-Connection-String":t,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},K=await _A(B);K&&(X.Authorization=`Bearer ${K}`),Array.isArray(_)&&(L!==void 0&&(X["Neon-Batch-Isolation-Level"]=L),V!==void 0&&(X["Neon-Batch-Read-Only"]=String(V)),H!==void 0&&(X["Neon-Batch-Deferrable"]=String(H)));let oe;try{oe=await(E??fetch)(z,{method:"POST",body:JSON.stringify(A),headers:X,...k})}catch(we){let pe=new Ua(`Error connecting to database: ${we.message}`);throw pe.sourceError=we,pe}if(oe.ok){let we=await oe.json();if(Array.isArray(_)){let pe=we.results;if(!Array.isArray(pe))throw new Ua("Neon internal error: unexpected result format");return pe.map((Ae,Qe)=>{let vi=S[Qe]??{},Jo=vi.arrayMode??C,ec=vi.fullResults??j;return py(Ae,{arrayMode:Jo,fullResults:ec,parameterizedQuery:_[Qe],resultCallback:c,types:vi.types})})}else{let pe=S??{},Ae=pe.arrayMode??C,Qe=pe.fullResults??j;return py(we,{arrayMode:Ae,fullResults:Qe,parameterizedQuery:_,resultCallback:c,types:pe.types})}}else{let{status:we}=oe;if(we===400){let pe=await oe.json(),Ae=new Ua(pe.message);for(let Qe of EU)Ae[Qe]=pe[Qe]??void 0;throw Ae}else{let pe=await oe.text();throw new Ua(`Server error (HTTP status ${we}): ${pe}`)}}}return w(x,"execute"),v}w(xA,"neon");function wA(t,e,r){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:e,opts:r,then:w((n,i)=>t(e,r).then(n,i),"then"),catch:w(n=>t(e,r).catch(n),"catch"),finally:w(n=>t(e,r).finally(n),"finally")}}w(wA,"createNeonQueryPromise");function py(t,{arrayMode:e,fullResults:r,parameterizedQuery:n,resultCallback:i,types:s}){let a=new SU.default(s),o=t.fields.map(u=>u.name),c=t.fields.map(u=>a.getTypeParser(u.dataTypeID)),l=e===!0?t.rows.map(u=>u.map((p,d)=>p===null?null:c[d](p))):t.rows.map(u=>Object.fromEntries(u.map((p,d)=>[o[d],p===null?null:c[d](p)])));return i&&i(n,t,l,{arrayMode:e,fullResults:r}),r?(t.viaNeonFetch=!0,t.rowAsArray=e,t.rows=l,t._parsers=c,t._types=a,t):l}w(py,"processQueryResult");async function _A(t){if(typeof t=="string")return t;if(typeof t=="function")try{return await Promise.resolve(t())}catch(e){let r=new Ua("Error getting auth token.");throw e instanceof Error&&(r=new Ua(`Error getting auth token: ${e.message}`)),r}}w(_A,"getAuthToken");var CU=Ha(by()),Qa=Ha(wy()),SA=class extends gA.Client{constructor(e){super(e),this.config=e}get neonConfig(){return this.connection.stream}connect(e){let{neonConfig:r}=this;r.forceDisablePgSSL&&(this.ssl=this.connection.ssl=!1),this.ssl&&r.useSecureWebSocket&&console.warn("SSL is enabled for both Postgres (e.g. ?sslmode=require in the connection string + forceDisablePgSSL = false) and the WebSocket tunnel (useSecureWebSocket = true). Double encryption will increase latency and CPU usage. It may be appropriate to disable SSL in the Postgres connection parameters or set forceDisablePgSSL = true.");let n=this.config?.host!==void 0||this.config?.connectionString!==void 0||be.env.PGHOST!==void 0,i=be.env.USER??be.env.USERNAME;if(!n&&this.host==="localhost"&&this.user===i&&this.database===i&&this.password===null)throw new Error(`No database host or connection string was set, and key parameters have default values (host: localhost, user: ${i}, db: ${i}, password: null). Is an environment variable missing? Alternatively, if you intended to connect with these parameters, please set the host to 'localhost' explicitly.`);let s=super.connect(e),a=r.pipelineTLS&&this.ssl,o=r.pipelineConnect==="password";if(!a&&!r.pipelineConnect)return s;let c=this.connection;if(a&&c.on("connect",()=>c.stream.emit("data","S")),o){c.removeAllListeners("authenticationCleartextPassword"),c.removeAllListeners("readyForQuery"),c.once("readyForQuery",()=>c.on("readyForQuery",this._handleReadyForQuery.bind(this)));let l=this.ssl?"sslconnect":"connect";c.on(l,()=>{this._handleAuthCleartextPassword(),this._handleReadyForQuery()})}return s}async _handleAuthSASLContinue(e){let r=this.saslSession,n=this.password,i=e.data;if(r.message!=="SASLInitialResponse"||typeof n!="string"||typeof i!="string")throw new Error("SASL: protocol error");let s=Object.fromEntries(i.split(",").map(K=>{if(!/^.=/.test(K))throw new Error("SASL: Invalid attribute pair entry");let oe=K[0],we=K.substring(2);return[oe,we]})),a=s.r,o=s.s,c=s.i;if(!a||!/^[!-+--~]+$/.test(a))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing/unprintable");if(!o||!/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(o))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing/not base64");if(!c||!/^[1-9][0-9]*$/.test(c))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: missing/invalid iteration count");if(!a.startsWith(r.clientNonce))throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");if(a.length===r.clientNonce.length)throw new Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short");let l=parseInt(c,10),u=he.from(o,"base64"),p=new TextEncoder,d=p.encode(n),g=await Ot.subtle.importKey("raw",d,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),m=new Uint8Array(await Ot.subtle.sign("HMAC",g,he.concat([u,he.from([0,0,0,1])]))),f=m;for(var v=0;v<l-1;v++)m=new Uint8Array(await Ot.subtle.sign("HMAC",g,m)),f=he.from(f.map((K,oe)=>f[oe]^m[oe]));let x=f,_=await Ot.subtle.importKey("raw",x,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),S=new Uint8Array(await Ot.subtle.sign("HMAC",_,p.encode("Client Key"))),T=await Ot.subtle.digest("SHA-256",S),O="n=*,r="+r.clientNonce,E="r="+a+",s="+o+",i="+l,A="c=biws,r="+a,k=O+","+E+","+A,C=await Ot.subtle.importKey("raw",T,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);var j=new Uint8Array(await Ot.subtle.sign("HMAC",C,p.encode(k))),L=he.from(S.map((K,oe)=>S[oe]^j[oe])),V=L.toString("base64");let H=await Ot.subtle.importKey("raw",x,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),B=await Ot.subtle.sign("HMAC",H,p.encode("Server Key")),z=await Ot.subtle.importKey("raw",B,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);var X=he.from(await Ot.subtle.sign("HMAC",z,p.encode(k)));r.message="SASLResponse",r.serverSignature=X.toString("base64"),r.response=A+",p="+V,this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}};w(SA,"NeonClient");var AU=SA;function EA(t,e){if(e)return{callback:e,result:void 0};let r,n,i=w(function(a,o){a?r(a):n(o)},"cb"),s=new t(function(a,o){n=a,r=o});return{callback:i,result:s}}w(EA,"promisify");var CA=class extends gA.Pool{constructor(){super(...arguments),me(this,"Client",AU),me(this,"hasFetchUnsupportedListeners",!1)}on(e,r){return e!=="error"&&(this.hasFetchUnsupportedListeners=!0),super.on(e,r)}query(e,r,n){if(!Wa.poolQueryViaFetch||this.hasFetchUnsupportedListeners||typeof e=="function")return super.query(e,r,n);typeof r=="function"&&(n=r,r=void 0);let i=EA(this.Promise,n);n=i.callback;try{let s=new CU.default(this.options),a=encodeURIComponent,o=encodeURI,c=`postgresql://${a(s.user)}:${a(s.password)}@${a(s.host)}/${o(s.database)}`,l=typeof e=="string"?e:e.text,u=r??e.values??[];xA(c,{fullResults:!0,arrayMode:e.rowMode==="array"})(l,u,{types:e.types??this.options?.types}).then(p=>n(void 0,p)).catch(p=>n(p))}catch(s){n(s)}return i.result}};w(CA,"NeonPool");var ss=CA,Kie=Qa.ClientBase,Xie=Qa.Connection,Zie=Qa.DatabaseError,Yie=Qa.Query,Jie=Qa.defaults,Ir=Qa.types;var _y=class extends hf{constructor(e,r,n,i,s,a,o,c){super({sql:r,params:n}),this.client=e,this.params=n,this.logger=i,this.fields=s,this._isResponseInArrayMode=o,this.customResultMapper=c,this.rawQueryConfig={name:a,text:r,types:{getTypeParser:(l,u)=>l===Ir.builtins.TIMESTAMPTZ?p=>p:l===Ir.builtins.TIMESTAMP?p=>p:l===Ir.builtins.DATE?p=>p:l===Ir.builtins.INTERVAL?p=>p:Ir.getTypeParser(l,u)}},this.queryConfig={name:a,text:r,rowMode:"array",types:{getTypeParser:(l,u)=>l===Ir.builtins.TIMESTAMPTZ?p=>p:l===Ir.builtins.TIMESTAMP?p=>p:l===Ir.builtins.DATE?p=>p:l===Ir.builtins.INTERVAL?p=>p:Ir.getTypeParser(l,u)}}}static[I]="NeonPreparedQuery";rawQueryConfig;queryConfig;async execute(e={}){let r=Gp(this.params,e);this.logger.logQuery(this.rawQueryConfig.text,r);let{fields:n,client:i,rawQueryConfig:s,queryConfig:a,joinsNotNullableMap:o,customResultMapper:c}=this;if(!n&&!c)return i.query(s,r);let l=await i.query(a,r);return c?c(l.rows):l.rows.map(u=>BC(n,u,o))}all(e={}){let r=Gp(this.params,e);return this.logger.logQuery(this.rawQueryConfig.text,r),this.client.query(this.rawQueryConfig,r).then(n=>n.rows)}values(e={}){let r=Gp(this.params,e);return this.logger.logQuery(this.rawQueryConfig.text,r),this.client.query(this.queryConfig,r).then(n=>n.rows)}isResponseInArrayMode(){return this._isResponseInArrayMode}},Tf=class t extends mf{constructor(e,r,n,i={}){super(r),this.client=e,this.schema=n,this.options=i,this.logger=i.logger??new Zp}static[I]="NeonSession";logger;prepareQuery(e,r,n,i,s){return new _y(this.client,e.sql,e.params,this.logger,r,n,i,s)}async query(e,r){return this.logger.logQuery(e,r),await this.client.query({rowMode:"array",text:e,values:r})}async queryObjects(e,r){return this.client.query(e,r)}async count(e){let r=await this.execute(e);return Number(r.rows[0].count)}async transaction(e,r={}){let n=this.client instanceof ss?new t(await this.client.connect(),this.dialect,this.schema,this.options):this,i=new Sy(this.dialect,n,this.schema);await i.execute(R`begin ${i.getTransactionConfigSQL(r)}`);try{let s=await e(i);return await i.execute(R`commit`),s}catch(s){throw await i.execute(R`rollback`),s}finally{this.client instanceof ss&&n.client.release()}}},Sy=class t extends gf{static[I]="NeonTransaction";async transaction(e){let r=`sp${this.nestedIndex+1}`,n=new t(this.dialect,this.session,this.schema,this.nestedIndex+1);await n.execute(R.raw(`savepoint ${r}`));try{let i=await e(n);return await n.execute(R.raw(`release savepoint ${r}`)),i}catch(i){throw await n.execute(R.raw(`rollback to savepoint ${r}`)),i}}};var Ey=class{constructor(e,r,n={}){this.client=e,this.dialect=r,this.options=n}static[I]="NeonDriver";createSession(e){return new Tf(this.client,this.dialect,e,{logger:this.options.logger})}},Cy=class extends Oa{static[I]="NeonServerlessDatabase"};function Ol(t,e={}){let r=new $n({casing:e.casing}),n;e.logger===!0?n=new Xp:e.logger!==!1&&(n=e.logger);let i;if(e.schema){let c=x4(e.schema,_4);i={fullSchema:e.schema,schema:c.tables,tableNamesMap:c.tableNamesMap}}let a=new Ey(t,r,{logger:n}).createSession(i),o=new Cy(r,a,i);return o.$client=t,o}function Pf(...t){if(typeof t[0]=="string"){let e=new ss({connectionString:t[0]});return Ol(e,t[1])}if($C(t[0])){let{connection:e,client:r,ws:n,...i}=t[0];if(n&&(Wa.webSocketConstructor=n),r)return Ol(r,i);let s=typeof e=="string"?new ss({connectionString:e}):new ss(e);return Ol(s,i)}return Ol(t[0],t[1])}(t=>{function e(r){return Ol({},r)}t.mock=e})(Pf||(Pf={}));var J7=jt(Dk(),1),ez=jt(Hy(),1),tz=jt(Vy(),1),Xk=jt($f(),1),rz=jt(Kk(),1);var Zk=Xk.default;if(!process.env.DATABASE_URL)throw new Error("DATABASE_URL must be set. Did you forget to provision a database?");var pt=Pf({connection:process.env.DATABASE_URL,ws:Zk,schema:oy});var t0=class{async getUser(e){let[r]=await pt.select().from(Qn).where(rr(Qn.id,e)).limit(1);return r}async getUserByUsername(e){let[r]=await pt.select().from(Qn).where(rr(Qn.username,e)).limit(1);return r}async createUser(e){let[r]=await pt.insert(Qn).values(e).returning();return r}async getProjects(){return pt.select().from(mr).orderBy(ll(mr.updatedAt))}async getProject(e){let[r]=await pt.select().from(mr).where(rr(mr.id,e)).limit(1);return r}async createProject(e){let[r]=await pt.insert(mr).values(e).returning();return r}async updateProject(e,r){let[n]=await pt.update(mr).set({...r,updatedAt:R`NOW()`}).where(rr(mr.id,e)).returning();return n}async deleteProject(e){let r=await pt.delete(mr).where(rr(mr.id,e));return r.rowCount!==null&&r.rowCount>0}async getChatMessages(e=50,r=null){return r?pt.select().from(Yt).where(rr(Yt.projectId,r)).orderBy(Yt.createdAt).limit(e):pt.select().from(Yt).where(cl(Yt.projectId)).orderBy(Yt.createdAt).limit(e)}async createChatMessage(e){let[r]=await pt.insert(Yt).values(e).returning();return r}async clearChatHistory(e=null){e?await pt.delete(Yt).where(rr(Yt.projectId,e)):await pt.delete(Yt).where(cl(Yt.projectId))}async getCodeExecutions(e=20){return pt.select().from($a).orderBy(ll($a.createdAt)).limit(e)}async createCodeExecution(e){let[r]=await pt.insert($a).values(e).returning();return r}async getConfig(){let[e]=await pt.select().from(ns).limit(1);return e}async updateConfig(e){let r=await this.getConfig();if(r){let[n]=await pt.update(ns).set({...e,updatedAt:R`NOW()`}).where(rr(ns.id,r.id)).returning();return n}else{let[n]=await pt.insert(ns).values(e).returning();return n}}},Rt=new t0;var SI=jt(require("crypto"),1);function se(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r}function q(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}var r0=function(){let{crypto:t}=globalThis;if(t?.randomUUID)return r0=t.randomUUID.bind(t),t.randomUUID();let e=new Uint8Array(1),r=t?()=>t.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^r()&15>>+n/4).toString(16))};function Dl(t){return typeof t=="object"&&t!==null&&("name"in t&&t.name==="AbortError"||"message"in t&&String(t.message).includes("FetchRequestCanceledException"))}var $l=t=>{if(t instanceof Error)return t;if(typeof t=="object"&&t!==null){try{if(Object.prototype.toString.call(t)==="[object Error]"){let e=new Error(t.message,t.cause?{cause:t.cause}:{});return t.stack&&(e.stack=t.stack),t.cause&&!e.cause&&(e.cause=t.cause),t.name&&(e.name=t.name),e}}catch{}try{return new Error(JSON.stringify(t))}catch{}}return new Error(t)};var ee=class extends Error{},ft=class t extends ee{constructor(e,r,n,i){super(`${t.makeMessage(e,r,n)}`),this.status=e,this.headers=i,this.requestID=i?.get("x-request-id"),this.error=r;let s=r;this.code=s?.code,this.param=s?.param,this.type=s?.type}static makeMessage(e,r,n){let i=r?.message?typeof r.message=="string"?r.message:JSON.stringify(r.message):r?JSON.stringify(r):n;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,r,n,i){if(!e||!i)return new Kn({message:n,cause:$l(r)});let s=r?.error;return e===400?new eo(e,s,n,i):e===401?new to(e,s,n,i):e===403?new ro(e,s,n,i):e===404?new no(e,s,n,i):e===409?new io(e,s,n,i):e===422?new so(e,s,n,i):e===429?new ao(e,s,n,i):e>=500?new oo(e,s,n,i):new t(e,s,n,i)}},ct=class extends ft{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},Kn=class extends ft{constructor({message:e,cause:r}){super(void 0,void 0,e||"Connection error.",void 0),r&&(this.cause=r)}},Xn=class extends Kn{constructor({message:e}={}){super({message:e??"Request timed out."})}},eo=class extends ft{},to=class extends ft{},ro=class extends ft{},no=class extends ft{},io=class extends ft{},so=class extends ft{},ao=class extends ft{},oo=class extends ft{},co=class extends ee{constructor(){super("Could not parse response content as the length limit was reached")}},lo=class extends ee{constructor(){super("Could not parse response content as the request was rejected by the content filter")}},Xr=class extends Error{constructor(e){super(e)}};var iz=/^[a-z][a-z0-9+.-]*:/i,Yk=t=>iz.test(t),Nt=t=>(Nt=Array.isArray,Nt(t)),n0=Nt;function i0(t){return typeof t!="object"?{}:t??{}}function Jk(t){if(!t)return!0;for(let e in t)return!1;return!0}function eT(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Ul(t){return t!=null&&typeof t=="object"&&!Array.isArray(t)}var tT=(t,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new ee(`${t} must be an integer`);if(e<0)throw new ee(`${t} must be a positive integer`);return e};var rT=t=>{try{return JSON.parse(t)}catch{return}};var Zr=t=>new Promise(e=>setTimeout(e,t));var Zn="6.10.0";var aT=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function sz(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}var az=()=>{let t=sz();if(t==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Zn,"X-Stainless-OS":iT(Deno.build.os),"X-Stainless-Arch":nT(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Zn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(t==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Zn,"X-Stainless-OS":iT(globalThis.process.platform??"unknown"),"X-Stainless-Arch":nT(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let e=oz();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Zn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Zn,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function oz(){if(typeof navigator>"u"||!navigator)return null;let t=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:r}of t){let n=r.exec(navigator.userAgent);if(n){let i=n[1]||0,s=n[2]||0,a=n[3]||0;return{browser:e,version:`${i}.${s}.${a}`}}}return null}var nT=t=>t==="x32"?"x32":t==="x86_64"||t==="x64"?"x64":t==="arm"?"arm":t==="aarch64"||t==="arm64"?"arm64":t?`other:${t}`:"unknown",iT=t=>(t=t.toLowerCase(),t.includes("ios")?"iOS":t==="android"?"Android":t==="darwin"?"MacOS":t==="win32"?"Windows":t==="freebsd"?"FreeBSD":t==="openbsd"?"OpenBSD":t==="linux"?"Linux":t?`Other:${t}`:"Unknown"),sT,oT=()=>sT??(sT=az());function cT(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function s0(...t){let e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...t)}function zf(t){let e=Symbol.asyncIterator in t?t[Symbol.asyncIterator]():t[Symbol.iterator]();return s0({start(){},async pull(r){let{done:n,value:i}=await e.next();n?r.close():r.enqueue(i)},async cancel(){await e.return?.()}})}function a0(t){if(t[Symbol.asyncIterator])return t;let e=t.getReader();return{async next(){try{let r=await e.read();return r?.done&&e.releaseLock(),r}catch(r){throw e.releaseLock(),r}},async return(){let r=e.cancel();return e.releaseLock(),await r,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function lT(t){if(t===null||typeof t!="object")return;if(t[Symbol.asyncIterator]){await t[Symbol.asyncIterator]().return?.();return}let e=t.getReader(),r=e.cancel();e.releaseLock(),await r}var uT=({headers:t,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});var Hf="RFC3986",o0=t=>String(t),Wf={RFC1738:t=>String(t).replace(/%20/g,"+"),RFC3986:o0},c0="RFC1738";var Qf=(t,e)=>(Qf=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),Qf(t,e)),Yr=(()=>{let t=[];for(let e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t})();var l0=1024,pT=(t,e,r,n,i)=>{if(t.length===0)return t;let s=t;if(typeof t=="symbol"?s=Symbol.prototype.toString.call(t):typeof t!="string"&&(s=String(t)),r==="iso-8859-1")return escape(s).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let a="";for(let o=0;o<s.length;o+=l0){let c=s.length>=l0?s.slice(o,o+l0):s,l=[];for(let u=0;u<c.length;++u){let p=c.charCodeAt(u);if(p===45||p===46||p===95||p===126||p>=48&&p<=57||p>=65&&p<=90||p>=97&&p<=122||i===c0&&(p===40||p===41)){l[l.length]=c.charAt(u);continue}if(p<128){l[l.length]=Yr[p];continue}if(p<2048){l[l.length]=Yr[192|p>>6]+Yr[128|p&63];continue}if(p<55296||p>=57344){l[l.length]=Yr[224|p>>12]+Yr[128|p>>6&63]+Yr[128|p&63];continue}u+=1,p=65536+((p&1023)<<10|c.charCodeAt(u)&1023),l[l.length]=Yr[240|p>>18]+Yr[128|p>>12&63]+Yr[128|p>>6&63]+Yr[128|p&63]}a+=l.join("")}return a};function fT(t){return!t||typeof t!="object"?!1:!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))}function u0(t,e){if(Nt(t)){let r=[];for(let n=0;n<t.length;n+=1)r.push(e(t[n]));return r}return e(t)}var hT={brackets(t){return String(t)+"[]"},comma:"comma",indices(t,e){return String(t)+"["+e+"]"},repeat(t){return String(t)}},mT=function(t,e){Array.prototype.push.apply(t,Nt(e)?e:[e])},dT,dt={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:pT,encodeValuesOnly:!1,format:Hf,formatter:o0,indices:!1,serializeDate(t){return(dT??(dT=Function.prototype.call.bind(Date.prototype.toISOString)))(t)},skipNulls:!1,strictNullHandling:!1};function uz(t){return typeof t=="string"||typeof t=="number"||typeof t=="boolean"||typeof t=="symbol"||typeof t=="bigint"}var p0={};function gT(t,e,r,n,i,s,a,o,c,l,u,p,d,g,m,f,v,x){let _=t,S=x,T=0,O=!1;for(;(S=S.get(p0))!==void 0&&!O;){let j=S.get(t);if(T+=1,typeof j<"u"){if(j===T)throw new RangeError("Cyclic object value");O=!0}typeof S.get(p0)>"u"&&(T=0)}if(typeof l=="function"?_=l(e,_):_ instanceof Date?_=d?.(_):r==="comma"&&Nt(_)&&(_=u0(_,function(j){return j instanceof Date?d?.(j):j})),_===null){if(s)return c&&!f?c(e,dt.encoder,v,"key",g):e;_=""}if(uz(_)||fT(_)){if(c){let j=f?e:c(e,dt.encoder,v,"key",g);return[m?.(j)+"="+m?.(c(_,dt.encoder,v,"value",g))]}return[m?.(e)+"="+m?.(String(_))]}let E=[];if(typeof _>"u")return E;let A;if(r==="comma"&&Nt(_))f&&c&&(_=u0(_,c)),A=[{value:_.length>0?_.join(",")||null:void 0}];else if(Nt(l))A=l;else{let j=Object.keys(_);A=u?j.sort(u):j}let k=o?String(e).replace(/\./g,"%2E"):String(e),C=n&&Nt(_)&&_.length===1?k+"[]":k;if(i&&Nt(_)&&_.length===0)return C+"[]";for(let j=0;j<A.length;++j){let L=A[j],V=typeof L=="object"&&typeof L.value<"u"?L.value:_[L];if(a&&V===null)continue;let H=p&&o?L.replace(/\./g,"%2E"):L,B=Nt(_)?typeof r=="function"?r(C,H):C:C+(p?"."+H:"["+H+"]");x.set(t,T);let z=new WeakMap;z.set(p0,x),mT(E,gT(V,B,r,n,i,s,a,o,r==="comma"&&f&&Nt(_)?null:c,l,u,p,d,g,m,f,v,z))}return E}function pz(t=dt){if(typeof t.allowEmptyArrays<"u"&&typeof t.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof t.encodeDotInKeys<"u"&&typeof t.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(t.encoder!==null&&typeof t.encoder<"u"&&typeof t.encoder!="function")throw new TypeError("Encoder has to be a function.");let e=t.charset||dt.charset;if(typeof t.charset<"u"&&t.charset!=="utf-8"&&t.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let r=Hf;if(typeof t.format<"u"){if(!Qf(Wf,t.format))throw new TypeError("Unknown format option provided.");r=t.format}let n=Wf[r],i=dt.filter;(typeof t.filter=="function"||Nt(t.filter))&&(i=t.filter);let s;if(t.arrayFormat&&t.arrayFormat in hT?s=t.arrayFormat:"indices"in t?s=t.indices?"indices":"repeat":s=dt.arrayFormat,"commaRoundTrip"in t&&typeof t.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");let a=typeof t.allowDots>"u"?t.encodeDotInKeys?!0:dt.allowDots:!!t.allowDots;return{addQueryPrefix:typeof t.addQueryPrefix=="boolean"?t.addQueryPrefix:dt.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof t.allowEmptyArrays=="boolean"?!!t.allowEmptyArrays:dt.allowEmptyArrays,arrayFormat:s,charset:e,charsetSentinel:typeof t.charsetSentinel=="boolean"?t.charsetSentinel:dt.charsetSentinel,commaRoundTrip:!!t.commaRoundTrip,delimiter:typeof t.delimiter>"u"?dt.delimiter:t.delimiter,encode:typeof t.encode=="boolean"?t.encode:dt.encode,encodeDotInKeys:typeof t.encodeDotInKeys=="boolean"?t.encodeDotInKeys:dt.encodeDotInKeys,encoder:typeof t.encoder=="function"?t.encoder:dt.encoder,encodeValuesOnly:typeof t.encodeValuesOnly=="boolean"?t.encodeValuesOnly:dt.encodeValuesOnly,filter:i,format:r,formatter:n,serializeDate:typeof t.serializeDate=="function"?t.serializeDate:dt.serializeDate,skipNulls:typeof t.skipNulls=="boolean"?t.skipNulls:dt.skipNulls,sort:typeof t.sort=="function"?t.sort:null,strictNullHandling:typeof t.strictNullHandling=="boolean"?t.strictNullHandling:dt.strictNullHandling}}function f0(t,e={}){let r=t,n=pz(e),i,s;typeof n.filter=="function"?(s=n.filter,r=s("",r)):Nt(n.filter)&&(s=n.filter,i=s);let a=[];if(typeof r!="object"||r===null)return"";let o=hT[n.arrayFormat],c=o==="comma"&&n.commaRoundTrip;i||(i=Object.keys(r)),n.sort&&i.sort(n.sort);let l=new WeakMap;for(let d=0;d<i.length;++d){let g=i[d];n.skipNulls&&r[g]===null||mT(a,gT(r[g],g,o,c,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,l))}let u=a.join(n.delimiter),p=n.addQueryPrefix===!0?"?":"";return n.charsetSentinel&&(n.charset==="iso-8859-1"?p+="utf8=%26%2310003%3B&":p+="utf8=%E2%9C%93&"),u.length>0?p+u:""}function bT(t){let e=0;for(let i of t)e+=i.length;let r=new Uint8Array(e),n=0;for(let i of t)r.set(i,n),n+=i.length;return r}var vT;function uo(t){let e;return(vT??(e=new globalThis.TextEncoder,vT=e.encode.bind(e)))(t)}var yT;function d0(t){let e;return(yT??(e=new globalThis.TextDecoder,yT=e.decode.bind(e)))(t)}var ir,sr,ps=class{constructor(){ir.set(this,void 0),sr.set(this,void 0),se(this,ir,new Uint8Array,"f"),se(this,sr,null,"f")}decode(e){if(e==null)return[];let r=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?uo(e):e;se(this,ir,bT([q(this,ir,"f"),r]),"f");let n=[],i;for(;(i=dz(q(this,ir,"f"),q(this,sr,"f")))!=null;){if(i.carriage&&q(this,sr,"f")==null){se(this,sr,i.index,"f");continue}if(q(this,sr,"f")!=null&&(i.index!==q(this,sr,"f")+1||i.carriage)){n.push(d0(q(this,ir,"f").subarray(0,q(this,sr,"f")-1))),se(this,ir,q(this,ir,"f").subarray(q(this,sr,"f")),"f"),se(this,sr,null,"f");continue}let s=q(this,sr,"f")!==null?i.preceding-1:i.preceding,a=d0(q(this,ir,"f").subarray(0,s));n.push(a),se(this,ir,q(this,ir,"f").subarray(i.index),"f"),se(this,sr,null,"f")}return n}flush(){return q(this,ir,"f").length?this.decode(`
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
Error: DATABASE_URL must be set. Did you forget to provision a database?
    at Object.<anonymous> (/opt/render/project/src/dist/index.cjs:94:73911)
    at Module._compile (node:internal/modules/cjs/loader:1730:14)
    at Object..js (node:internal/modules/cjs/loader:1895:10)
    at Module.load (node:internal/modules/cjs/loader:1465:32)
    at Function._load (node:internal/modules/cjs/loader:1282:12)
    at TracingChannel.traceSync (node:diagnostics_channel:322:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:235:24)
    at Function.executeUserEntryPoint [as runMain] (node:internal/modules/run_main:171:5)
    at node:internal/main/run_main_module:36:49
Node.js v22.16.0
==> Running 'node dist/index.cjs'
/opt/render/project/src/dist/index.cjs:94
`);c.write(s.format.apply(s,E))}}w(x,"warn"),Object.defineProperty(e.exports,"isWin",{get:w(function(){return o},"get"),set:w(function(O){o=O},"set")}),e.exports.warnTo=function(O){var E=c;return c=O,E},e.exports.getFileName=function(O){var E=O||be.env,A=E.PGPASSFILE||(o?r.join(E.APPDATA||"./","postgresql","pgpass.conf"):r.join(E.HOME||"./",".pgpass"));return A},e.exports.usePgPass=function(O,E){return Object.prototype.hasOwnProperty.call(be.env,"PGPASSWORD")?!1:o?!0:(E=E||"<unkn>",g(O.mode)?O.mode&(l|u)?(x('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',E),!1):!0:(x('WARNING: password file "%s" is not a plain file',E),!1))};var _=e.exports.match=function(O,E){return m.slice(0,-1).reduce(function(A,k,C){return C==1&&Number(O[k]||a)===Number(E[k])?A&&!0:A&&(E[k]==="*"||E[k]===O[k])},!0)};e.exports.getPassword=function(O,E,A){var k,C=E.pipe(i());function j(H){var B=S(H);B&&T(B)&&_(O,B)&&(k=B[v],C.end())}w(j,"onLine");var L=w(function(){E.destroy(),A(k)},"onEnd"),V=w(function(H){E.destroy(),x("WARNING: error on reading file: %s",H),A(void 0)},"onErr");E.on("error",V),C.on("data",j).on("end",L).on("error",V)};var S=e.exports.parseLine=function(O){if(O.length<11||O.match(/^\s+#/))return null;for(var E="",A="",k=0,C=0,j=0,L={},V=!1,H=w(function(z,X,K){var oe=O.substring(X,K);Object.hasOwnProperty.call(be.env,"PGPASS_NO_DEESCAPE")||(oe=oe.replace(/\\([:\\])/g,"$1")),L[m[z]]=oe},"addToObj"),B=0;B<O.length-1;B+=1){if(E=O.charAt(B+1),A=O.charAt(B),V=k==f-1,V){H(k,C);break}B>=0&&E==":"&&A!=="\\"&&(H(k,C,B+1),C=B+2,k+=1)}return L=Object.keys(L).length===f?L:null,L},T=e.exports.isValidEntry=function(O){for(var E={0:function(L){return L.length>0},1:function(L){return L==="*"?!0:(L=Number(L),isFinite(L)&&L>0&&L<9007199254740992&&Math.floor(L)===L)},2:function(L){return L.length>0},3:function(L){return L.length>0},4:function(L){return L.length>0}},A=0;A<m.length;A+=1){var k=E[A],C=O[m[A]]||"",j=k(C);if(!j)return!1}return!0}}),aU=xe((t,e)=>{"use strict";ae();var r=(X4(),St(hy)),n=(Y4(),St(my)),i=sU();e.exports=function(s,a){var o=i.getFileName();n.stat(o,function(c,l){if(c||!i.usePgPass(l,o))return a(void 0);var u=n.createReadStream(o);i.getPassword(s,u,a)})},e.exports.warnTo=i.warnTo}),vy=xe((t,e)=>{"use strict";ae();var r=Cf();function n(i){this._types=i||r,this.text={},this.binary={}}w(n,"TypeOverrides"),n.prototype.getOverrides=function(i){switch(i){case"text":return this.text;case"binary":return this.binary;default:return{}}},n.prototype.setTypeParser=function(i,s,a){typeof s=="function"&&(a=s,s="text"),this.getOverrides(s)[i]=a},n.prototype.getTypeParser=function(i,s){return s=s||"text",this.getOverrides(s)[i]||this._types.getTypeParser(i,s)},e.exports=n}),nA={};Pr(nA,{default:()=>iA});var iA,oU=Jt(()=>{"use strict";ae(),iA={}}),sA={};Pr(sA,{parse:()=>yy});function yy(t,e=!1){let{protocol:r}=new URL(t),n="http:"+t.substring(r.length),{username:i,password:s,host:a,hostname:o,port:c,pathname:l,search:u,searchParams:p,hash:d}=new URL(n);s=decodeURIComponent(s),i=decodeURIComponent(i),l=decodeURIComponent(l);let g=i+":"+s,m=e?Object.fromEntries(p.entries()):u;return{href:t,protocol:r,auth:g,username:i,password:s,host:a,hostname:o,port:c,pathname:l,search:u,query:m,hash:d}}var aA=Jt(()=>{"use strict";ae(),w(yy,"parse")}),cU=xe((t,e)=>{"use strict";ae();var r=(aA(),St(sA)),n=(Y4(),St(my));function i(s){if(s.charAt(0)==="/"){var o=s.split(" ");return{host:o[0],database:o[1]}}var a=r.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(s)?encodeURI(s).replace(/\%25(\d\d)/g,"%$1"):s,!0),o=a.query;for(var c in o)Array.isArray(o[c])&&(o[c]=o[c][o[c].length-1]);var l=(a.auth||":").split(":");if(o.user=l[0],o.password=l.splice(1).join(":"),o.port=a.port,a.protocol=="socket:")return o.host=decodeURI(a.pathname),o.database=a.query.db,o.client_encoding=a.query.encoding,o;o.host||(o.host=a.hostname);var u=a.pathname;if(!o.host&&u&&/^%2f/i.test(u)){var p=u.split("/");o.host=decodeURIComponent(p[0]),u=p.splice(1).join("/")}switch(u&&u.charAt(0)==="/"&&(u=u.slice(1)||null),o.database=u&&decodeURI(u),(o.ssl==="true"||o.ssl==="1")&&(o.ssl=!0),o.ssl==="0"&&(o.ssl=!1),(o.sslcert||o.sslkey||o.sslrootcert||o.sslmode)&&(o.ssl={}),o.sslcert&&(o.ssl.cert=n.readFileSync(o.sslcert).toString()),o.sslkey&&(o.ssl.key=n.readFileSync(o.sslkey).toString()),o.sslrootcert&&(o.ssl.ca=n.readFileSync(o.sslrootcert).toString()),o.sslmode){case"disable":{o.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{o.ssl.rejectUnauthorized=!1;break}}return o}w(i,"parse"),e.exports=i,i.parse=i}),by=xe((t,e)=>{"use strict";ae();var r=(oU(),St(nA)),n=Af(),i=cU().parse,s=w(function(p,d,g){return g===void 0?g=be.env["PG"+p.toUpperCase()]:g===!1||(g=be.env[g]),d[p]||g||n[p]},"val"),a=w(function(){switch(be.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return n.ssl},"readSSLConfigFromEnvironment"),o=w(function(p){return"'"+(""+p).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),c=w(function(p,d,g){var m=d[g];m!=null&&p.push(g+"="+o(m))},"add"),l=class{constructor(d){d=typeof d=="string"?i(d):d||{},d.connectionString&&(d=Object.assign({},d,i(d.connectionString))),this.user=s("user",d),this.database=s("database",d),this.database===void 0&&(this.database=this.user),this.port=parseInt(s("port",d),10),this.host=s("host",d),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:s("password",d)}),this.binary=s("binary",d),this.options=s("options",d),this.ssl=typeof d.ssl>"u"?a():d.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=s("client_encoding",d),this.replication=s("replication",d),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=s("application_name",d,"PGAPPNAME"),this.fallback_application_name=s("fallback_application_name",d,!1),this.statement_timeout=s("statement_timeout",d,!1),this.lock_timeout=s("lock_timeout",d,!1),this.idle_in_transaction_session_timeout=s("idle_in_transaction_session_timeout",d,!1),this.query_timeout=s("query_timeout",d,!1),d.connectionTimeoutMillis===void 0?this.connect_timeout=be.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(d.connectionTimeoutMillis/1e3),d.keepAlive===!1?this.keepalives=0:d.keepAlive===!0&&(this.keepalives=1),typeof d.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(d.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(d){var g=[];c(g,this,"user"),c(g,this,"password"),c(g,this,"port"),c(g,this,"application_name"),c(g,this,"fallback_application_name"),c(g,this,"connect_timeout"),c(g,this,"options");var m=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(c(g,m,"sslmode"),c(g,m,"sslca"),c(g,m,"sslkey"),c(g,m,"sslcert"),c(g,m,"sslrootcert"),this.database&&g.push("dbname="+o(this.database)),this.replication&&g.push("replication="+o(this.replication)),this.host&&g.push("host="+o(this.host)),this.isDomainSocket)return d(null,g.join(" "));this.client_encoding&&g.push("client_encoding="+o(this.client_encoding)),r.lookup(this.host,function(f,v){return f?d(f,null):(g.push("hostaddr="+o(v)),d(null,g.join(" ")))})}};w(l,"ConnectionParameters");var u=l;e.exports=u}),lU=xe((t,e)=>{"use strict";ae();var r=Cf(),n=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,i=class{constructor(o,c){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=c,this.RowCtor=null,this.rowAsArray=o==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(o){var c;o.text?c=n.exec(o.text):c=n.exec(o.command),c&&(this.command=c[1],c[3]?(this.oid=parseInt(c[2],10),this.rowCount=parseInt(c[3],10)):c[2]&&(this.rowCount=parseInt(c[2],10)))}_parseRowAsArray(o){for(var c=new Array(o.length),l=0,u=o.length;l<u;l++){var p=o[l];p!==null?c[l]=this._parsers[l](p):c[l]=null}return c}parseRow(o){for(var c={},l=0,u=o.length;l<u;l++){var p=o[l],d=this.fields[l].name;p!==null?c[d]=this._parsers[l](p):c[d]=null}return c}addRow(o){this.rows.push(o)}addFields(o){this.fields=o,this.fields.length&&(this._parsers=new Array(o.length));for(var c=0;c<o.length;c++){var l=o[c];this._types?this._parsers[c]=this._types.getTypeParser(l.dataTypeID,l.format||"text"):this._parsers[c]=r.getTypeParser(l.dataTypeID,l.format||"text")}}};w(i,"Result");var s=i;e.exports=s}),uU=xe((t,e)=>{"use strict";ae();var{EventEmitter:r}=is(),n=lU(),i=kf(),s=class extends r{constructor(c,l,u){super(),c=i.normalizeQueryConfig(c,l,u),this.text=c.text,this.values=c.values,this.rows=c.rows,this.types=c.types,this.name=c.name,this.binary=c.binary,this.portal=c.portal||"",this.callback=c.callback,this._rowMode=c.rowMode,be.domain&&c.callback&&(this.callback=be.domain.bind(c.callback)),this._result=new n(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new n(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(c){this._checkForMultirow(),this._result.addFields(c.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(c){let l;if(!this._canceledDueToError){try{l=this._result.parseRow(c.fields)}catch(u){this._canceledDueToError=u;return}this.emit("row",l,this._result),this._accumulateRows&&this._result.addRow(l)}}handleCommandComplete(c,l){this._checkForMultirow(),this._result.addCommandComplete(c),this.rows&&l.sync()}handleEmptyQuery(c){this.rows&&c.sync()}handleError(c,l){if(this._canceledDueToError&&(c=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(c);this.emit("error",c)}handleReadyForQuery(c){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,c);if(this.callback)try{this.callback(null,this._results)}catch(l){be.nextTick(()=>{throw l})}this.emit("end",this._results)}submit(c){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let l=c.parsedStatements[this.name];return this.text&&l&&this.text!==l?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(c):c.query(this.text),null)}hasBeenParsed(c){return this.name&&c.parsedStatements[this.name]}handlePortalSuspended(c){this._getRows(c,this.rows)}_getRows(c,l){c.execute({portal:this.portal,rows:l}),l?c.flush():c.sync()}prepare(c){this.isPreparedStatement=!0,this.hasBeenParsed(c)||c.parse({text:this.text,name:this.name,types:this.types});try{c.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:i.prepareValue})}catch(l){this.handleError(l,c);return}c.describe({type:"P",name:this.portal||""}),this._getRows(c,this.rows)}handleCopyInResponse(c){c.sendCopyFail("No source stream defined")}handleCopyData(c,l){}};w(s,"Query");var a=s;e.exports=a}),oA={};Pr(oA,{Socket:()=>Wa,isIP:()=>cA});function cA(t){return 0}var q4,ly,Tl,Wa,xy=Jt(()=>{"use strict";ae(),q4=Ha(is(),1),w(cA,"isIP"),ly=/^[^.]+\./,Tl=class le extends q4.EventEmitter{constructor(){super(...arguments),me(this,"opts",{}),me(this,"connecting",!1),me(this,"pending",!0),me(this,"writable",!0),me(this,"encrypted",!1),me(this,"authorized",!1),me(this,"destroyed",!1),me(this,"ws",null),me(this,"writeBuffer"),me(this,"tlsState",0),me(this,"tlsRead"),me(this,"tlsWrite")}static get poolQueryViaFetch(){return le.opts.poolQueryViaFetch??le.defaults.poolQueryViaFetch}static set poolQueryViaFetch(e){le.opts.poolQueryViaFetch=e}static get fetchEndpoint(){return le.opts.fetchEndpoint??le.defaults.fetchEndpoint}static set fetchEndpoint(e){le.opts.fetchEndpoint=e}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(e){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return le.opts.fetchFunction??le.defaults.fetchFunction}static set fetchFunction(e){le.opts.fetchFunction=e}static get webSocketConstructor(){return le.opts.webSocketConstructor??le.defaults.webSocketConstructor}static set webSocketConstructor(e){le.opts.webSocketConstructor=e}get webSocketConstructor(){return this.opts.webSocketConstructor??le.webSocketConstructor}set webSocketConstructor(e){this.opts.webSocketConstructor=e}static get wsProxy(){return le.opts.wsProxy??le.defaults.wsProxy}static set wsProxy(e){le.opts.wsProxy=e}get wsProxy(){return this.opts.wsProxy??le.wsProxy}set wsProxy(e){this.opts.wsProxy=e}static get coalesceWrites(){return le.opts.coalesceWrites??le.defaults.coalesceWrites}static set coalesceWrites(e){le.opts.coalesceWrites=e}get coalesceWrites(){return this.opts.coalesceWrites??le.coalesceWrites}set coalesceWrites(e){this.opts.coalesceWrites=e}static get useSecureWebSocket(){return le.opts.useSecureWebSocket??le.defaults.useSecureWebSocket}static set useSecureWebSocket(e){le.opts.useSecureWebSocket=e}get useSecureWebSocket(){return this.opts.useSecureWebSocket??le.useSecureWebSocket}set useSecureWebSocket(e){this.opts.useSecureWebSocket=e}static get forceDisablePgSSL(){return le.opts.forceDisablePgSSL??le.defaults.forceDisablePgSSL}static set forceDisablePgSSL(e){le.opts.forceDisablePgSSL=e}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??le.forceDisablePgSSL}set forceDisablePgSSL(e){this.opts.forceDisablePgSSL=e}static get disableSNI(){return le.opts.disableSNI??le.defaults.disableSNI}static set disableSNI(e){le.opts.disableSNI=e}get disableSNI(){return this.opts.disableSNI??le.disableSNI}set disableSNI(e){this.opts.disableSNI=e}static get pipelineConnect(){return le.opts.pipelineConnect??le.defaults.pipelineConnect}static set pipelineConnect(e){le.opts.pipelineConnect=e}get pipelineConnect(){return this.opts.pipelineConnect??le.pipelineConnect}set pipelineConnect(e){this.opts.pipelineConnect=e}static get subtls(){return le.opts.subtls??le.defaults.subtls}static set subtls(e){le.opts.subtls=e}get subtls(){return this.opts.subtls??le.subtls}set subtls(e){this.opts.subtls=e}static get pipelineTLS(){return le.opts.pipelineTLS??le.defaults.pipelineTLS}static set pipelineTLS(e){le.opts.pipelineTLS=e}get pipelineTLS(){return this.opts.pipelineTLS??le.pipelineTLS}set pipelineTLS(e){this.opts.pipelineTLS=e}static get rootCerts(){return le.opts.rootCerts??le.defaults.rootCerts}static set rootCerts(e){le.opts.rootCerts=e}get rootCerts(){return this.opts.rootCerts??le.rootCerts}set rootCerts(e){this.opts.rootCerts=e}wsProxyAddrForHost(e,r){let n=this.wsProxy;if(n===void 0)throw new Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return typeof n=="function"?n(e,r):`${n}?address=${e}:${r}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(e,r,n){this.connecting=!0,n&&this.once("connect",n);let i=w(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),s=w((o,c=!1)=>{o.binaryType="arraybuffer",o.addEventListener("error",l=>{this.emit("error",l),this.emit("close")}),o.addEventListener("message",l=>{if(this.tlsState===0){let u=he.from(l.data);this.emit("data",u)}}),o.addEventListener("close",()=>{this.emit("close")}),c?i():o.addEventListener("open",i)},"configureWebSocket"),a;try{a=this.wsProxyAddrForHost(r,typeof e=="string"?parseInt(e,10):e)}catch(o){this.emit("error",o),this.emit("close");return}try{let o=(this.useSecureWebSocket?"wss:":"ws:")+"//"+a;if(this.webSocketConstructor!==void 0)this.ws=new this.webSocketConstructor(o),s(this.ws);else try{this.ws=new WebSocket(o),s(this.ws)}catch{this.ws=new __unstable_WebSocket(o),s(this.ws)}}catch(o){let c=(this.useSecureWebSocket?"https:":"http:")+"//"+a;fetch(c,{headers:{Upgrade:"websocket"}}).then(l=>{if(this.ws=l.webSocket,this.ws==null)throw o;this.ws.accept(),s(this.ws,!0)}).catch(l=>{this.emit("error",new Error(`All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: ${l.message}`)),this.emit("close")})}}async startTls(e){if(this.subtls===void 0)throw new Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let r=this.subtls.TrustedCert.fromPEM(this.rootCerts),n=new this.subtls.WebSocketReadQueue(this.ws),i=n.read.bind(n),s=this.rawWrite.bind(this),[a,o]=await this.subtls.startTls(e,r,i,s,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=a,this.tlsWrite=o,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(e===void 0)break;{let r=he.from(e);this.emit("data",r)}}}rawWrite(e){if(!this.coalesceWrites){this.ws.send(e);return}if(this.writeBuffer===void 0)this.writeBuffer=e,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let r=new Uint8Array(this.writeBuffer.length+e.length);r.set(this.writeBuffer),r.set(e,this.writeBuffer.length),this.writeBuffer=r}}write(e,r="utf8",n=i=>{}){return e.length===0?(n(),!0):(typeof e=="string"&&(e=he.from(e,r)),this.tlsState===0?(this.rawWrite(e),n()):this.tlsState===1?this.once("secureConnection",()=>{this.write(e,r,n)}):(this.tlsWrite(e),n()),!0)}end(e=he.alloc(0),r="utf8",n=()=>{}){return this.write(e,r,()=>{this.ws.close(),n()}),this}destroy(){return this.destroyed=!0,this.end()}},w(Tl,"Socket"),me(Tl,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:w((t,e,r)=>{let n;return r?.jwtAuth?n=t.replace(ly,"apiauth."):n=t.replace(ly,"api."),"https://"+n+"/sql"},"fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:w(t=>t+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1}),me(Tl,"opts",{}),Wa=Tl}),lA=xe(t=>{"use strict";ae(),Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeMessage=t.DataRowMessage=t.CommandCompleteMessage=t.ReadyForQueryMessage=t.NotificationResponseMessage=t.BackendKeyDataMessage=t.AuthenticationMD5Password=t.ParameterStatusMessage=t.ParameterDescriptionMessage=t.RowDescriptionMessage=t.Field=t.CopyResponse=t.CopyDataMessage=t.DatabaseError=t.copyDone=t.emptyQuery=t.replicationStart=t.portalSuspended=t.noData=t.closeComplete=t.bindComplete=t.parseComplete=void 0,t.parseComplete={name:"parseComplete",length:5},t.bindComplete={name:"bindComplete",length:5},t.closeComplete={name:"closeComplete",length:5},t.noData={name:"noData",length:5},t.portalSuspended={name:"portalSuspended",length:5},t.replicationStart={name:"replicationStart",length:4},t.emptyQuery={name:"emptyQuery",length:4},t.copyDone={name:"copyDone",length:4};var e=class extends Error{constructor(B,z,X){super(B),this.length=z,this.name=X}};w(e,"DatabaseError");var r=e;t.DatabaseError=r;var n=class{constructor(B,z){this.length=B,this.chunk=z,this.name="copyData"}};w(n,"CopyDataMessage");var i=n;t.CopyDataMessage=i;var s=class{constructor(B,z,X,K){this.length=B,this.name=z,this.binary=X,this.columnTypes=new Array(K)}};w(s,"CopyResponse");var a=s;t.CopyResponse=a;var o=class{constructor(B,z,X,K,oe,we,pe){this.name=B,this.tableID=z,this.columnID=X,this.dataTypeID=K,this.dataTypeSize=oe,this.dataTypeModifier=we,this.format=pe}};w(o,"Field");var c=o;t.Field=c;var l=class{constructor(B,z){this.length=B,this.fieldCount=z,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};w(l,"RowDescriptionMessage");var u=l;t.RowDescriptionMessage=u;var p=class{constructor(B,z){this.length=B,this.parameterCount=z,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};w(p,"ParameterDescriptionMessage");var d=p;t.ParameterDescriptionMessage=d;var g=class{constructor(B,z,X){this.length=B,this.parameterName=z,this.parameterValue=X,this.name="parameterStatus"}};w(g,"ParameterStatusMessage");var m=g;t.ParameterStatusMessage=m;var f=class{constructor(B,z){this.length=B,this.salt=z,this.name="authenticationMD5Password"}};w(f,"AuthenticationMD5Password");var v=f;t.AuthenticationMD5Password=v;var x=class{constructor(B,z,X){this.length=B,this.processID=z,this.secretKey=X,this.name="backendKeyData"}};w(x,"BackendKeyDataMessage");var _=x;t.BackendKeyDataMessage=_;var S=class{constructor(B,z,X,K){this.length=B,this.processId=z,this.channel=X,this.payload=K,this.name="notification"}};w(S,"NotificationResponseMessage");var T=S;t.NotificationResponseMessage=T;var O=class{constructor(B,z){this.length=B,this.status=z,this.name="readyForQuery"}};w(O,"ReadyForQueryMessage");var E=O;t.ReadyForQueryMessage=E;var A=class{constructor(B,z){this.length=B,this.text=z,this.name="commandComplete"}};w(A,"CommandCompleteMessage");var k=A;t.CommandCompleteMessage=k;var C=class{constructor(B,z){this.length=B,this.fields=z,this.name="dataRow",this.fieldCount=z.length}};w(C,"DataRowMessage");var j=C;t.DataRowMessage=j;var L=class{constructor(B,z){this.length=B,this.message=z,this.name="notice"}};w(L,"NoticeMessage");var V=L;t.NoticeMessage=V}),pU=xe(t=>{"use strict";ae(),Object.defineProperty(t,"__esModule",{value:!0}),t.Writer=void 0;var e=class{constructor(i=256){this.size=i,this.offset=5,this.headerPosition=0,this.buffer=he.allocUnsafe(i)}ensure(i){var s=this.buffer.length-this.offset;if(s<i){var a=this.buffer,o=a.length+(a.length>>1)+i;this.buffer=he.allocUnsafe(o),a.copy(this.buffer)}}addInt32(i){return this.ensure(4),this.buffer[this.offset++]=i>>>24&255,this.buffer[this.offset++]=i>>>16&255,this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addInt16(i){return this.ensure(2),this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addCString(i){if(!i)this.ensure(1);else{var s=he.byteLength(i);this.ensure(s+1),this.buffer.write(i,this.offset,"utf-8"),this.offset+=s}return this.buffer[this.offset++]=0,this}addString(i=""){var s=he.byteLength(i);return this.ensure(s),this.buffer.write(i,this.offset),this.offset+=s,this}add(i){return this.ensure(i.length),i.copy(this.buffer,this.offset),this.offset+=i.length,this}join(i){if(i){this.buffer[this.headerPosition]=i;let s=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(s,this.headerPosition+1)}return this.buffer.slice(i?0:5,this.offset)}flush(i){var s=this.join(i);return this.offset=5,this.headerPosition=0,this.buffer=he.allocUnsafe(this.size),s}};w(e,"Writer");var r=e;t.Writer=r}),fU=xe(t=>{"use strict";ae(),Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;var e=pU(),r=new e.Writer,n=w(B=>{r.addInt16(3).addInt16(0);for(let K of Object.keys(B))r.addCString(K).addCString(B[K]);r.addCString("client_encoding").addCString("UTF8");var z=r.addCString("").flush(),X=z.length+4;return new e.Writer().addInt32(X).add(z).flush()},"startup"),i=w(()=>{let B=he.allocUnsafe(8);return B.writeInt32BE(8,0),B.writeInt32BE(80877103,4),B},"requestSsl"),s=w(B=>r.addCString(B).flush(112),"password"),a=w(function(B,z){return r.addCString(B).addInt32(he.byteLength(z)).addString(z),r.flush(112)},"sendSASLInitialResponseMessage"),o=w(function(B){return r.addString(B).flush(112)},"sendSCRAMClientFinalMessage"),c=w(B=>r.addCString(B).flush(81),"query"),l=[],u=w(B=>{let z=B.name||"";z.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",z,z.length),console.error("This can cause conflicts and silent errors executing queries"));let X=B.types||l;for(var K=X.length,oe=r.addCString(z).addCString(B.text).addInt16(K),we=0;we<K;we++)oe.addInt32(X[we]);return r.flush(80)},"parse"),p=new e.Writer,d=w(function(B,z){for(let X=0;X<B.length;X++){let K=z?z(B[X],X):B[X];K==null?(r.addInt16(0),p.addInt32(-1)):K instanceof he?(r.addInt16(1),p.addInt32(K.length),p.add(K)):(r.addInt16(0),p.addInt32(he.byteLength(K)),p.addString(K))}},"writeValues"),g=w((B={})=>{let z=B.portal||"",X=B.statement||"",K=B.binary||!1,oe=B.values||l,we=oe.length;return r.addCString(z).addCString(X),r.addInt16(we),d(oe,B.valueMapper),r.addInt16(we),r.add(p.flush()),r.addInt16(K?1:0),r.flush(66)},"bind"),m=he.from([69,0,0,0,9,0,0,0,0,0]),f=w(B=>{if(!B||!B.portal&&!B.rows)return m;let z=B.portal||"",X=B.rows||0,K=he.byteLength(z),oe=4+K+1+4,we=he.allocUnsafe(1+oe);return we[0]=69,we.writeInt32BE(oe,1),we.write(z,5,"utf-8"),we[K+5]=0,we.writeUInt32BE(X,we.length-4),we},"execute"),v=w((B,z)=>{let X=he.allocUnsafe(16);return X.writeInt32BE(16,0),X.writeInt16BE(1234,4),X.writeInt16BE(5678,6),X.writeInt32BE(B,8),X.writeInt32BE(z,12),X},"cancel"),x=w((B,z)=>{let X=4+he.byteLength(z)+1,K=he.allocUnsafe(1+X);return K[0]=B,K.writeInt32BE(X,1),K.write(z,5,"utf-8"),K[X]=0,K},"cstringMessage"),_=r.addCString("P").flush(68),S=r.addCString("S").flush(68),T=w(B=>B.name?x(68,`${B.type}${B.name||""}`):B.type==="P"?_:S,"describe"),O=w(B=>{let z=`${B.type}${B.name||""}`;return x(67,z)},"close"),E=w(B=>r.add(B).flush(100),"copyData"),A=w(B=>x(102,B),"copyFail"),k=w(B=>he.from([B,0,0,0,4]),"codeOnlyBuffer"),C=k(72),j=k(83),L=k(88),V=k(99),H={startup:n,password:s,requestSsl:i,sendSASLInitialResponseMessage:a,sendSCRAMClientFinalMessage:o,query:c,parse:u,bind:g,execute:f,describe:T,close:O,flush:w(()=>C,"flush"),sync:w(()=>j,"sync"),end:w(()=>L,"end"),copyData:E,copyDone:w(()=>V,"copyDone"),copyFail:A,cancel:v};t.serialize=H}),dU=xe(t=>{"use strict";ae(),Object.defineProperty(t,"__esModule",{value:!0}),t.BufferReader=void 0;var e=he.allocUnsafe(0),r=class{constructor(s=0){this.offset=s,this.buffer=e,this.encoding="utf-8"}setBuffer(s,a){this.offset=s,this.buffer=a}int16(){let s=this.buffer.readInt16BE(this.offset);return this.offset+=2,s}byte(){let s=this.buffer[this.offset];return this.offset++,s}int32(){let s=this.buffer.readInt32BE(this.offset);return this.offset+=4,s}string(s){let a=this.buffer.toString(this.encoding,this.offset,this.offset+s);return this.offset+=s,a}cstring(){let s=this.offset,a=s;for(;this.buffer[a++]!==0;);return this.offset=a,this.buffer.toString(this.encoding,s,a-1)}bytes(s){let a=this.buffer.slice(this.offset,this.offset+s);return this.offset+=s,a}};w(r,"BufferReader");var n=r;t.BufferReader=n}),hU=xe(t=>{"use strict";ae(),Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var e=lA(),r=dU(),n=1,i=4,s=n+i,a=he.allocUnsafe(0),o=class{constructor(u){if(this.buffer=a,this.bufferLength=0,this.bufferOffset=0,this.reader=new r.BufferReader,u?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=u?.mode||"text"}parse(u,p){this.mergeBuffer(u);let d=this.bufferOffset+this.bufferLength,g=this.bufferOffset;for(;g+s<=d;){let m=this.buffer[g],f=this.buffer.readUInt32BE(g+n),v=n+f;if(v+g<=d){let x=this.handlePacket(g+s,m,f,this.buffer);p(x),g+=v}else break}g===d?(this.buffer=a,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=d-g,this.bufferOffset=g)}mergeBuffer(u){if(this.bufferLength>0){let p=this.bufferLength+u.byteLength;if(p+this.bufferOffset>this.buffer.byteLength){let d;if(p<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)d=this.buffer;else{let g=this.buffer.byteLength*2;for(;p>=g;)g*=2;d=he.allocUnsafe(g)}this.buffer.copy(d,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=d,this.bufferOffset=0}u.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=p}else this.buffer=u,this.bufferOffset=0,this.bufferLength=u.byteLength}handlePacket(u,p,d,g){switch(p){case 50:return e.bindComplete;case 49:return e.parseComplete;case 51:return e.closeComplete;case 110:return e.noData;case 115:return e.portalSuspended;case 99:return e.copyDone;case 87:return e.replicationStart;case 73:return e.emptyQuery;case 68:return this.parseDataRowMessage(u,d,g);case 67:return this.parseCommandCompleteMessage(u,d,g);case 90:return this.parseReadyForQueryMessage(u,d,g);case 65:return this.parseNotificationMessage(u,d,g);case 82:return this.parseAuthenticationResponse(u,d,g);case 83:return this.parseParameterStatusMessage(u,d,g);case 75:return this.parseBackendKeyData(u,d,g);case 69:return this.parseErrorMessage(u,d,g,"error");case 78:return this.parseErrorMessage(u,d,g,"notice");case 84:return this.parseRowDescriptionMessage(u,d,g);case 116:return this.parseParameterDescriptionMessage(u,d,g);case 71:return this.parseCopyInMessage(u,d,g);case 72:return this.parseCopyOutMessage(u,d,g);case 100:return this.parseCopyData(u,d,g);default:return new e.DatabaseError("received invalid response: "+p.toString(16),d,"error")}}parseReadyForQueryMessage(u,p,d){this.reader.setBuffer(u,d);let g=this.reader.string(1);return new e.ReadyForQueryMessage(p,g)}parseCommandCompleteMessage(u,p,d){this.reader.setBuffer(u,d);let g=this.reader.cstring();return new e.CommandCompleteMessage(p,g)}parseCopyData(u,p,d){let g=d.slice(u,u+(p-4));return new e.CopyDataMessage(p,g)}parseCopyInMessage(u,p,d){return this.parseCopyMessage(u,p,d,"copyInResponse")}parseCopyOutMessage(u,p,d){return this.parseCopyMessage(u,p,d,"copyOutResponse")}parseCopyMessage(u,p,d,g){this.reader.setBuffer(u,d);let m=this.reader.byte()!==0,f=this.reader.int16(),v=new e.CopyResponse(p,g,m,f);for(let x=0;x<f;x++)v.columnTypes[x]=this.reader.int16();return v}parseNotificationMessage(u,p,d){this.reader.setBuffer(u,d);let g=this.reader.int32(),m=this.reader.cstring(),f=this.reader.cstring();return new e.NotificationResponseMessage(p,g,m,f)}parseRowDescriptionMessage(u,p,d){this.reader.setBuffer(u,d);let g=this.reader.int16(),m=new e.RowDescriptionMessage(p,g);for(let f=0;f<g;f++)m.fields[f]=this.parseField();return m}parseField(){let u=this.reader.cstring(),p=this.reader.int32(),d=this.reader.int16(),g=this.reader.int32(),m=this.reader.int16(),f=this.reader.int32(),v=this.reader.int16()===0?"text":"binary";return new e.Field(u,p,d,g,m,f,v)}parseParameterDescriptionMessage(u,p,d){this.reader.setBuffer(u,d);let g=this.reader.int16(),m=new e.ParameterDescriptionMessage(p,g);for(let f=0;f<g;f++)m.dataTypeIDs[f]=this.reader.int32();return m}parseDataRowMessage(u,p,d){this.reader.setBuffer(u,d);let g=this.reader.int16(),m=new Array(g);for(let f=0;f<g;f++){let v=this.reader.int32();m[f]=v===-1?null:this.reader.string(v)}return new e.DataRowMessage(p,m)}parseParameterStatusMessage(u,p,d){this.reader.setBuffer(u,d);let g=this.reader.cstring(),m=this.reader.cstring();return new e.ParameterStatusMessage(p,g,m)}parseBackendKeyData(u,p,d){this.reader.setBuffer(u,d);let g=this.reader.int32(),m=this.reader.int32();return new e.BackendKeyDataMessage(p,g,m)}parseAuthenticationResponse(u,p,d){this.reader.setBuffer(u,d);let g=this.reader.int32(),m={name:"authenticationOk",length:p};switch(g){case 0:break;case 3:m.length===8&&(m.name="authenticationCleartextPassword");break;case 5:if(m.length===12){m.name="authenticationMD5Password";let v=this.reader.bytes(4);return new e.AuthenticationMD5Password(p,v)}break;case 10:m.name="authenticationSASL",m.mechanisms=[];let f;do f=this.reader.cstring(),f&&m.mechanisms.push(f);while(f);break;case 11:m.name="authenticationSASLContinue",m.data=this.reader.string(p-8);break;case 12:m.name="authenticationSASLFinal",m.data=this.reader.string(p-8);break;default:throw new Error("Unknown authenticationOk message type "+g)}return m}parseErrorMessage(u,p,d,g){this.reader.setBuffer(u,d);let m={},f=this.reader.string(1);for(;f!=="\0";)m[f]=this.reader.cstring(),f=this.reader.string(1);let v=m.M,x=g==="notice"?new e.NoticeMessage(p,v):new e.DatabaseError(v,p,g);return x.severity=m.S,x.code=m.C,x.detail=m.D,x.hint=m.H,x.position=m.P,x.internalPosition=m.p,x.internalQuery=m.q,x.where=m.W,x.schema=m.s,x.table=m.t,x.column=m.c,x.dataType=m.d,x.constraint=m.n,x.file=m.F,x.line=m.L,x.routine=m.R,x}};w(o,"Parser");var c=o;t.Parser=c}),uA=xe(t=>{"use strict";ae(),Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseError=t.serialize=t.parse=void 0;var e=lA();Object.defineProperty(t,"DatabaseError",{enumerable:!0,get:w(function(){return e.DatabaseError},"get")});var r=fU();Object.defineProperty(t,"serialize",{enumerable:!0,get:w(function(){return r.serialize},"get")});var n=hU();function i(s,a){let o=new n.Parser;return s.on("data",c=>o.parse(c,a)),new Promise(c=>s.on("end",()=>c()))}w(i,"parse"),t.parse=i}),pA={};Pr(pA,{connect:()=>fA});function fA({socket:t,servername:e}){return t.startTls(e),t}var mU=Jt(()=>{"use strict";ae(),w(fA,"connect")}),dA=xe((t,e)=>{"use strict";ae();var r=(xy(),St(oA)),n=is().EventEmitter,{parse:i,serialize:s}=uA(),a=s.flush(),o=s.sync(),c=s.end(),l=class extends n{constructor(d){super(),d=d||{},this.stream=d.stream||new r.Socket,this._keepAlive=d.keepAlive,this._keepAliveInitialDelayMillis=d.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=d.ssl||!1,this._ending=!1,this._emitMessage=!1;var g=this;this.on("newListener",function(m){m==="message"&&(g._emitMessage=!0)})}connect(d,g){var m=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(d,g),this.stream.once("connect",function(){m._keepAlive&&m.stream.setKeepAlive(!0,m._keepAliveInitialDelayMillis),m.emit("connect")});let f=w(function(v){m._ending&&(v.code==="ECONNRESET"||v.code==="EPIPE")||m.emit("error",v)},"reportStreamError");if(this.stream.on("error",f),this.stream.on("close",function(){m.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(v){var x=v.toString("utf8");switch(x){case"S":break;case"N":return m.stream.end(),m.emit("error",new Error("The server does not support SSL connections"));default:return m.stream.end(),m.emit("error",new Error("There was an error establishing an SSL connection"))}var _=(mU(),St(pA));let S={socket:m.stream};m.ssl!==!0&&(Object.assign(S,m.ssl),"key"in m.ssl&&(S.key=m.ssl.key)),r.isIP(g)===0&&(S.servername=g);try{m.stream=_.connect(S)}catch(T){return m.emit("error",T)}m.attachListeners(m.stream),m.stream.on("error",f),m.emit("sslconnect")})}attachListeners(d){d.on("end",()=>{this.emit("end")}),i(d,g=>{var m=g.name==="error"?"errorMessage":g.name;this._emitMessage&&this.emit("message",g),this.emit(m,g)})}requestSsl(){this.stream.write(s.requestSsl())}startup(d){this.stream.write(s.startup(d))}cancel(d,g){this._send(s.cancel(d,g))}password(d){this._send(s.password(d))}sendSASLInitialResponseMessage(d,g){this._send(s.sendSASLInitialResponseMessage(d,g))}sendSCRAMClientFinalMessage(d){this._send(s.sendSCRAMClientFinalMessage(d))}_send(d){return this.stream.writable?this.stream.write(d):!1}query(d){this._send(s.query(d))}parse(d){this._send(s.parse(d))}bind(d){this._send(s.bind(d))}execute(d){this._send(s.execute(d))}flush(){this.stream.writable&&this.stream.write(a)}sync(){this._ending=!0,this._send(a),this._send(o)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(c,()=>{this.stream.end()})}close(d){this._send(s.close(d))}describe(d){this._send(s.describe(d))}sendCopyFromChunk(d){this._send(s.copyData(d))}endCopyFrom(){this._send(s.copyDone())}sendCopyFail(d){this._send(s.copyFail(d))}};w(l,"Connection");var u=l;e.exports=u}),gU=xe((t,e)=>{"use strict";ae();var r=is().EventEmitter,n=(Ef(),St(Il)),i=kf(),s=rU(),a=aU(),o=vy(),c=by(),l=uU(),u=Af(),p=dA(),d=class extends r{constructor(f){super(),this.connectionParameters=new c(f),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var v=f||{};this._Promise=v.Promise||Sf.Promise,this._types=new o(v.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=v.connection||new p({stream:v.stream,ssl:this.connectionParameters.ssl,keepAlive:v.keepAlive||!1,keepAliveInitialDelayMillis:v.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=v.binary||u.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=v.connectionTimeoutMillis||0}_errorAllQueries(f){let v=w(x=>{be.nextTick(()=>{x.handleError(f,this.connection)})},"enqueueError");this.activeQuery&&(v(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(v),this.queryQueue.length=0}_connect(f){var v=this,x=this.connection;if(this._connectionCallback=f,this._connecting||this._connected){let _=new Error("Client has already been connected. You cannot reuse a client.");be.nextTick(()=>{f(_)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{x._ending=!0,x.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?x.connect(this.host+"/.s.PGSQL."+this.port):x.connect(this.port,this.host),x.on("connect",function(){v.ssl?x.requestSsl():x.startup(v.getStartupConf())}),x.on("sslconnect",function(){x.startup(v.getStartupConf())}),this._attachListeners(x),x.once("end",()=>{let _=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(_),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(_):this._handleErrorEvent(_):this._connectionError||this._handleErrorEvent(_)),be.nextTick(()=>{this.emit("end")})})}connect(f){if(f){this._connect(f);return}return new this._Promise((v,x)=>{this._connect(_=>{_?x(_):v()})})}_attachListeners(f){f.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),f.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),f.on("authenticationSASL",this._handleAuthSASL.bind(this)),f.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),f.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),f.on("backendKeyData",this._handleBackendKeyData.bind(this)),f.on("error",this._handleErrorEvent.bind(this)),f.on("errorMessage",this._handleErrorMessage.bind(this)),f.on("readyForQuery",this._handleReadyForQuery.bind(this)),f.on("notice",this._handleNotice.bind(this)),f.on("rowDescription",this._handleRowDescription.bind(this)),f.on("dataRow",this._handleDataRow.bind(this)),f.on("portalSuspended",this._handlePortalSuspended.bind(this)),f.on("emptyQuery",this._handleEmptyQuery.bind(this)),f.on("commandComplete",this._handleCommandComplete.bind(this)),f.on("parseComplete",this._handleParseComplete.bind(this)),f.on("copyInResponse",this._handleCopyInResponse.bind(this)),f.on("copyData",this._handleCopyData.bind(this)),f.on("notification",this._handleNotification.bind(this))}_checkPgPass(f){let v=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(x=>{if(x!==void 0){if(typeof x!="string"){v.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=x}else this.connectionParameters.password=this.password=null;f()}).catch(x=>{v.emit("error",x)}):this.password!==null?f():a(this.connectionParameters,x=>{x!==void 0&&(this.connectionParameters.password=this.password=x),f()})}_handleAuthCleartextPassword(f){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(f){this._checkPgPass(()=>{let v=i.postgresMd5PasswordHash(this.user,this.password,f.salt);this.connection.password(v)})}_handleAuthSASL(f){this._checkPgPass(()=>{this.saslSession=s.startSession(f.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(f){s.continueSession(this.saslSession,this.password,f.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(f){s.finalizeSession(this.saslSession,f.data),this.saslSession=null}_handleBackendKeyData(f){this.processID=f.processID,this.secretKey=f.secretKey}_handleReadyForQuery(f){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:v}=this;this.activeQuery=null,this.readyForQuery=!0,v&&v.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(f){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(f);this.emit("error",f)}}_handleErrorEvent(f){if(this._connecting)return this._handleErrorWhileConnecting(f);this._queryable=!1,this._errorAllQueries(f),this.emit("error",f)}_handleErrorMessage(f){if(this._connecting)return this._handleErrorWhileConnecting(f);let v=this.activeQuery;if(!v){this._handleErrorEvent(f);return}this.activeQuery=null,v.handleError(f,this.connection)}_handleRowDescription(f){this.activeQuery.handleRowDescription(f)}_handleDataRow(f){this.activeQuery.handleDataRow(f)}_handlePortalSuspended(f){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(f){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(f){this.activeQuery.handleCommandComplete(f,this.connection)}_handleParseComplete(f){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(f){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(f){this.activeQuery.handleCopyData(f,this.connection)}_handleNotification(f){this.emit("notification",f)}_handleNotice(f){this.emit("notice",f)}getStartupConf(){var f=this.connectionParameters,v={user:f.user,database:f.database},x=f.application_name||f.fallback_application_name;return x&&(v.application_name=x),f.replication&&(v.replication=""+f.replication),f.statement_timeout&&(v.statement_timeout=String(parseInt(f.statement_timeout,10))),f.lock_timeout&&(v.lock_timeout=String(parseInt(f.lock_timeout,10))),f.idle_in_transaction_session_timeout&&(v.idle_in_transaction_session_timeout=String(parseInt(f.idle_in_transaction_session_timeout,10))),f.options&&(v.options=f.options),v}cancel(f,v){if(f.activeQuery===v){var x=this.connection;this.host&&this.host.indexOf("/")===0?x.connect(this.host+"/.s.PGSQL."+this.port):x.connect(this.port,this.host),x.on("connect",function(){x.cancel(f.processID,f.secretKey)})}else f.queryQueue.indexOf(v)!==-1&&f.queryQueue.splice(f.queryQueue.indexOf(v),1)}setTypeParser(f,v,x){return this._types.setTypeParser(f,v,x)}getTypeParser(f,v){return this._types.getTypeParser(f,v)}escapeIdentifier(f){return'"'+f.replace(/"/g,'""')+'"'}escapeLiteral(f){for(var v=!1,x="'",_=0;_<f.length;_++){var S=f[_];S==="'"?x+=S+S:S==="\\"?(x+=S+S,v=!0):x+=S}return x+="'",v===!0&&(x=" E"+x),x}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let f=this.activeQuery.submit(this.connection);f&&be.nextTick(()=>{this.activeQuery.handleError(f,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(f,v,x){var _,S,T,O,E;if(f==null)throw new TypeError("Client was passed a null or undefined query");return typeof f.submit=="function"?(T=f.query_timeout||this.connectionParameters.query_timeout,S=_=f,typeof v=="function"&&(_.callback=_.callback||v)):(T=this.connectionParameters.query_timeout,_=new l(f,v,x),_.callback||(S=new this._Promise((A,k)=>{_.callback=(C,j)=>C?k(C):A(j)}))),T&&(E=_.callback,O=setTimeout(()=>{var A=new Error("Query read timeout");be.nextTick(()=>{_.handleError(A,this.connection)}),E(A),_.callback=()=>{};var k=this.queryQueue.indexOf(_);k>-1&&this.queryQueue.splice(k,1),this._pulseQueryQueue()},T),_.callback=(A,k)=>{clearTimeout(O),E(A,k)}),this.binary&&!_.binary&&(_.binary=!0),_._result&&!_._result._types&&(_._result._types=this._types),this._queryable?this._ending?(be.nextTick(()=>{_.handleError(new Error("Client was closed and is not queryable"),this.connection)}),S):(this.queryQueue.push(_),this._pulseQueryQueue(),S):(be.nextTick(()=>{_.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),S)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(f){if(this._ending=!0,!this.connection._connecting)if(f)f();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),f)this.connection.once("end",f);else return new this._Promise(v=>{this.connection.once("end",v)})}};w(d,"Client");var g=d;g.Query=l,e.exports=g}),vU=xe((t,e)=>{"use strict";ae();var r=is().EventEmitter,n=w(function(){},"NOOP"),i=w((m,f)=>{let v=m.findIndex(f);return v===-1?void 0:m.splice(v,1)[0]},"removeWhere"),s=class{constructor(f,v,x){this.client=f,this.idleListener=v,this.timeoutId=x}};w(s,"IdleItem");var a=s,o=class{constructor(f){this.callback=f}};w(o,"PendingItem");var c=o;function l(){throw new Error("Release called on client which has already been released to the pool.")}w(l,"throwOnDoubleRelease");function u(m,f){if(f)return{callback:f,result:void 0};let v,x,_=w(function(T,O){T?v(T):x(O)},"cb"),S=new m(function(T,O){x=T,v=O}).catch(T=>{throw Error.captureStackTrace(T),T});return{callback:_,result:S}}w(u,"promisify");function p(m,f){return w(function v(x){x.client=f,f.removeListener("error",v),f.on("error",()=>{m.log("additional client error after disconnection due to error",x)}),m._remove(f),m.emit("error",x,f)},"idleListener")}w(p,"makeIdleListener");var d=class extends r{constructor(f,v){super(),this.options=Object.assign({},f),f!=null&&"password"in f&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:f.password}),f!=null&&f.ssl&&f.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||v||wy().Client,this.Promise=this.options.Promise||Sf.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(v=>{this._remove(v.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let f=this._pendingQueue.shift();if(this._idle.length){let v=this._idle.pop();clearTimeout(v.timeoutId);let x=v.client;x.ref&&x.ref();let _=v.idleListener;return this._acquireClient(x,f,_,!1)}if(!this._isFull())return this.newClient(f);throw new Error("unexpected condition")}_remove(f){let v=i(this._idle,x=>x.client===f);v!==void 0&&clearTimeout(v.timeoutId),this._clients=this._clients.filter(x=>x!==f),f.end(),this.emit("remove",f)}connect(f){if(this.ending){let _=new Error("Cannot use a pool after calling end on the pool");return f?f(_):this.Promise.reject(_)}let v=u(this.Promise,f),x=v.result;if(this._isFull()||this._idle.length){if(this._idle.length&&be.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new c(v.callback)),x;let _=w((O,E,A)=>{clearTimeout(T),v.callback(O,E,A)},"queueCallback"),S=new c(_),T=setTimeout(()=>{i(this._pendingQueue,O=>O.callback===_),S.timedOut=!0,v.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(S),x}return this.newClient(new c(v.callback)),x}newClient(f){let v=new this.Client(this.options);this._clients.push(v);let x=p(this,v);this.log("checking client timeout");let _,S=!1;this.options.connectionTimeoutMillis&&(_=setTimeout(()=>{this.log("ending client due to timeout"),S=!0,v.connection?v.connection.stream.destroy():v.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),v.connect(T=>{if(_&&clearTimeout(_),v.on("error",x),T)this.log("client failed to connect",T),this._clients=this._clients.filter(O=>O!==v),S&&(T.message="Connection terminated due to connection timeout"),this._pulseQueue(),f.timedOut||f.callback(T,void 0,n);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let O=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(v),this._idle.findIndex(E=>E.client===v)!==-1&&this._acquireClient(v,new c((E,A,k)=>k()),x,!1)},this.options.maxLifetimeSeconds*1e3);O.unref(),v.once("end",()=>clearTimeout(O))}return this._acquireClient(v,f,x,!0)}})}_acquireClient(f,v,x,_){_&&this.emit("connect",f),this.emit("acquire",f),f.release=this._releaseOnce(f,x),f.removeListener("error",x),v.timedOut?_&&this.options.verify?this.options.verify(f,f.release):f.release():_&&this.options.verify?this.options.verify(f,S=>{if(S)return f.release(S),v.callback(S,void 0,n);v.callback(void 0,f,f.release)}):v.callback(void 0,f,f.release)}_releaseOnce(f,v){let x=!1;return _=>{x&&l(),x=!0,this._release(f,v,_)}}_release(f,v,x){if(f.on("error",v),f._poolUseCount=(f._poolUseCount||0)+1,this.emit("release",x,f),x||this.ending||!f._queryable||f._ending||f._poolUseCount>=this.options.maxUses){f._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(f),this._pulseQueue();return}if(this._expired.has(f)){this.log("remove expired client"),this._expired.delete(f),this._remove(f),this._pulseQueue();return}let _;this.options.idleTimeoutMillis&&(_=setTimeout(()=>{this.log("remove idle client"),this._remove(f)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&_.unref()),this.options.allowExitOnIdle&&f.unref(),this._idle.push(new a(f,v,_)),this._pulseQueue()}query(f,v,x){if(typeof f=="function"){let S=u(this.Promise,f);return fy(function(){return S.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),S.result}typeof v=="function"&&(x=v,v=void 0);let _=u(this.Promise,x);return x=_.callback,this.connect((S,T)=>{if(S)return x(S);let O=!1,E=w(A=>{O||(O=!0,T.release(A),x(A))},"onError");T.once("error",E),this.log("dispatching query");try{T.query(f,v,(A,k)=>{if(this.log("query dispatched"),T.removeListener("error",E),!O)return O=!0,T.release(A),A?x(A):x(void 0,k)})}catch(A){return T.release(A),x(A)}}),_.result}end(f){if(this.log("ending"),this.ending){let x=new Error("Called end on pool more than once");return f?f(x):this.Promise.reject(x)}this.ending=!0;let v=u(this.Promise,f);return this._endCallback=v.callback,this._pulseQueue(),v.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((f,v)=>f+(this._expired.has(v)?1:0),0)}get totalCount(){return this._clients.length}};w(d,"Pool");var g=d;e.exports=g}),hA={};Pr(hA,{default:()=>mA});var mA,yU=Jt(()=>{"use strict";ae(),mA={}}),bU=xe((t,e)=>{e.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),xU=xe((t,e)=>{"use strict";ae();var r=is().EventEmitter,n=(Ef(),St(Il)),i=kf(),s=e.exports=function(o,c,l){r.call(this),o=i.normalizeQueryConfig(o,c,l),this.text=o.text,this.values=o.values,this.name=o.name,this.callback=o.callback,this.state="new",this._arrayMode=o.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(u){u==="row"&&(this._emitRowEvents=!0)}.bind(this))};n.inherits(s,r);var a={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};s.prototype.handleError=function(o){var c=this.native.pq.resultErrorFields();if(c)for(var l in c){var u=a[l]||l;o[u]=c[l]}this.callback?this.callback(o):this.emit("error",o),this.state="error"},s.prototype.then=function(o,c){return this._getPromise().then(o,c)},s.prototype.catch=function(o){return this._getPromise().catch(o)},s.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(o,c){this._once("end",o),this._once("error",c)}.bind(this)),this._promise)},s.prototype.submit=function(o){this.state="running";var c=this;this.native=o.native,o.native.arrayMode=this._arrayMode;var l=w(function(d,g,m){if(o.native.arrayMode=!1,fy(function(){c.emit("_done")}),d)return c.handleError(d);c._emitRowEvents&&(m.length>1?g.forEach((f,v)=>{f.forEach(x=>{c.emit("row",x,m[v])})}):g.forEach(function(f){c.emit("row",f,m)})),c.state="end",c.emit("end",m),c.callback&&c.callback(null,m)},"after");if(be.domain&&(l=be.domain.bind(l)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var u=(this.values||[]).map(i.prepareValue);if(o.namedQueries[this.name]){if(this.text&&o.namedQueries[this.name]!==this.text){let d=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return l(d)}return o.native.execute(this.name,u,l)}return o.native.prepare(this.name,this.text,u.length,function(d){return d?l(d):(o.namedQueries[c.name]=c.text,c.native.execute(c.name,u,l))})}else if(this.values){if(!Array.isArray(this.values)){let d=new Error("Query values must be an array");return l(d)}var p=this.values.map(i.prepareValue);o.native.query(this.text,p,l)}else o.native.query(this.text,l)}}),wU=xe((t,e)=>{"use strict";ae();var r=(yU(),St(hA)),n=vy(),i=bU(),s=is().EventEmitter,a=(Ef(),St(Il)),o=by(),c=xU(),l=e.exports=function(u){s.call(this),u=u||{},this._Promise=u.Promise||Sf.Promise,this._types=new n(u.types),this.native=new r({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var p=this.connectionParameters=new o(u);this.user=p.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:p.password}),this.database=p.database,this.host=p.host,this.port=p.port,this.namedQueries={}};l.Query=c,a.inherits(l,s),l.prototype._errorAllQueries=function(u){let p=w(d=>{be.nextTick(()=>{d.native=this.native,d.handleError(u)})},"enqueueError");this._hasActiveQuery()&&(p(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(p),this._queryQueue.length=0},l.prototype._connect=function(u){var p=this;if(this._connecting){be.nextTick(()=>u(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(d,g){if(d)return u(d);p.native.connect(g,function(m){if(m)return p.native.end(),u(m);p._connected=!0,p.native.on("error",function(f){p._queryable=!1,p._errorAllQueries(f),p.emit("error",f)}),p.native.on("notification",function(f){p.emit("notification",{channel:f.relname,payload:f.extra})}),p.emit("connect"),p._pulseQueryQueue(!0),u()})})},l.prototype.connect=function(u){if(u){this._connect(u);return}return new this._Promise((p,d)=>{this._connect(g=>{g?d(g):p()})})},l.prototype.query=function(u,p,d){var g,m,f,v,x;if(u==null)throw new TypeError("Client was passed a null or undefined query");if(typeof u.submit=="function")f=u.query_timeout||this.connectionParameters.query_timeout,m=g=u,typeof p=="function"&&(u.callback=p);else if(f=this.connectionParameters.query_timeout,g=new c(u,p,d),!g.callback){let _,S;m=new this._Promise((T,O)=>{_=T,S=O}),g.callback=(T,O)=>T?S(T):_(O)}return f&&(x=g.callback,v=setTimeout(()=>{var _=new Error("Query read timeout");be.nextTick(()=>{g.handleError(_,this.connection)}),x(_),g.callback=()=>{};var S=this._queryQueue.indexOf(g);S>-1&&this._queryQueue.splice(S,1),this._pulseQueryQueue()},f),g.callback=(_,S)=>{clearTimeout(v),x(_,S)}),this._queryable?this._ending?(g.native=this.native,be.nextTick(()=>{g.handleError(new Error("Client was closed and is not queryable"))}),m):(this._queryQueue.push(g),this._pulseQueryQueue(),m):(g.native=this.native,be.nextTick(()=>{g.handleError(new Error("Client has encountered a connection error and is not queryable"))}),m)},l.prototype.end=function(u){var p=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,u));var d;return u||(d=new this._Promise(function(g,m){u=w(f=>f?m(f):g(),"cb")})),this.native.end(function(){p._errorAllQueries(new Error("Connection terminated")),be.nextTick(()=>{p.emit("end"),u&&u()})}),d},l.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},l.prototype._pulseQueryQueue=function(u){if(this._connected&&!this._hasActiveQuery()){var p=this._queryQueue.shift();if(!p){u||this.emit("drain");return}this._activeQuery=p,p.submit(this);var d=this;p.once("_done",function(){d._pulseQueryQueue()})}},l.prototype.cancel=function(u){this._activeQuery===u?this.native.cancel(function(){}):this._queryQueue.indexOf(u)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(u),1)},l.prototype.ref=function(){},l.prototype.unref=function(){},l.prototype.setTypeParser=function(u,p,d){return this._types.setTypeParser(u,p,d)},l.prototype.getTypeParser=function(u,p){return this._types.getTypeParser(u,p)}}),B4=xe((t,e)=>{"use strict";ae(),e.exports=wU()}),wy=xe((t,e)=>{"use strict";ae();var r=gU(),n=Af(),i=dA(),s=vU(),{DatabaseError:a}=uA(),o=w(l=>{var u;return u=class extends s{constructor(p){super(p,l)}},w(u,"BoundPool"),u},"poolFactory"),c=w(function(l){this.defaults=n,this.Client=l,this.Query=this.Client.Query,this.Pool=o(this.Client),this._pools=[],this.Connection=i,this.types=Cf(),this.DatabaseError=a},"PG");typeof be.env.NODE_PG_FORCE_NATIVE<"u"?e.exports=new c(B4()):(e.exports=new c(r),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var l=null;try{l=new c(B4())}catch(u){if(u.code!=="MODULE_NOT_FOUND")throw u}return Object.defineProperty(e.exports,"native",{value:l}),l}}))});ae();var gA=Ha(wy());xy();ae();xy();aA();var _U=Ha(kf()),SU=Ha(vy());function vA(t){return t instanceof he?"\\x"+t.toString("hex"):t}w(vA,"encodeBuffersAsBytea");var yA=class bA extends Error{constructor(e){super(e),me(this,"name","NeonDbError"),me(this,"severity"),me(this,"code"),me(this,"detail"),me(this,"hint"),me(this,"position"),me(this,"internalPosition"),me(this,"internalQuery"),me(this,"where"),me(this,"schema"),me(this,"table"),me(this,"column"),me(this,"dataType"),me(this,"constraint"),me(this,"file"),me(this,"line"),me(this,"routine"),me(this,"sourceError"),"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,bA)}};w(yA,"NeonDbError");var Ua=yA,F4="transaction() expects an array of queries, or a function returning an array of queries",EU=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function xA(t,{arrayMode:e,fullResults:r,fetchOptions:n,isolationLevel:i,readOnly:s,deferrable:a,queryCallback:o,resultCallback:c,authToken:l}={}){if(!t)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let u;try{u=yy(t)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(t))}let{protocol:p,username:d,hostname:g,port:m,pathname:f}=u;if(p!=="postgres:"&&p!=="postgresql:"||!d||!g||!f)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function v(_,...S){let T,O;if(typeof _=="string")T=_,O=S[1],S=S[0]??[];else{T="";for(let A=0;A<_.length;A++)T+=_[A],A<S.length&&(T+="$"+(A+1))}S=S.map(A=>vA((0,_U.prepareValue)(A)));let E={query:T,params:S};return o&&o(E),wA(x,E,O)}w(v,"resolve"),v.transaction=async(_,S)=>{if(typeof _=="function"&&(_=_(v)),!Array.isArray(_))throw new Error(F4);_.forEach(E=>{if(E[Symbol.toStringTag]!=="NeonQueryPromise")throw new Error(F4)});let T=_.map(E=>E.parameterizedQuery),O=_.map(E=>E.opts??{});return x(T,O,S)};async function x(_,S,T){let{fetchEndpoint:O,fetchFunction:E}=Wa,A=Array.isArray(_)?{queries:_}:_,k=n??{},C=e??!1,j=r??!1,L=i,V=s,H=a;T!==void 0&&(T.fetchOptions!==void 0&&(k={...k,...T.fetchOptions}),T.arrayMode!==void 0&&(C=T.arrayMode),T.fullResults!==void 0&&(j=T.fullResults),T.isolationLevel!==void 0&&(L=T.isolationLevel),T.readOnly!==void 0&&(V=T.readOnly),T.deferrable!==void 0&&(H=T.deferrable)),S!==void 0&&!Array.isArray(S)&&S.fetchOptions!==void 0&&(k={...k,...S.fetchOptions});let B=l;!Array.isArray(S)&&S?.authToken!==void 0&&(B=S.authToken);let z=typeof O=="function"?O(g,m,{jwtAuth:B!==void 0}):O,X={"Neon-Connection-String":t,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},K=await _A(B);K&&(X.Authorization=`Bearer ${K}`),Array.isArray(_)&&(L!==void 0&&(X["Neon-Batch-Isolation-Level"]=L),V!==void 0&&(X["Neon-Batch-Read-Only"]=String(V)),H!==void 0&&(X["Neon-Batch-Deferrable"]=String(H)));let oe;try{oe=await(E??fetch)(z,{method:"POST",body:JSON.stringify(A),headers:X,...k})}catch(we){let pe=new Ua(`Error connecting to database: ${we.message}`);throw pe.sourceError=we,pe}if(oe.ok){let we=await oe.json();if(Array.isArray(_)){let pe=we.results;if(!Array.isArray(pe))throw new Ua("Neon internal error: unexpected result format");return pe.map((Ae,Qe)=>{let vi=S[Qe]??{},Jo=vi.arrayMode??C,ec=vi.fullResults??j;return py(Ae,{arrayMode:Jo,fullResults:ec,parameterizedQuery:_[Qe],resultCallback:c,types:vi.types})})}else{let pe=S??{},Ae=pe.arrayMode??C,Qe=pe.fullResults??j;return py(we,{arrayMode:Ae,fullResults:Qe,parameterizedQuery:_,resultCallback:c,types:pe.types})}}else{let{status:we}=oe;if(we===400){let pe=await oe.json(),Ae=new Ua(pe.message);for(let Qe of EU)Ae[Qe]=pe[Qe]??void 0;throw Ae}else{let pe=await oe.text();throw new Ua(`Server error (HTTP status ${we}): ${pe}`)}}}return w(x,"execute"),v}w(xA,"neon");function wA(t,e,r){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:e,opts:r,then:w((n,i)=>t(e,r).then(n,i),"then"),catch:w(n=>t(e,r).catch(n),"catch"),finally:w(n=>t(e,r).finally(n),"finally")}}w(wA,"createNeonQueryPromise");function py(t,{arrayMode:e,fullResults:r,parameterizedQuery:n,resultCallback:i,types:s}){let a=new SU.default(s),o=t.fields.map(u=>u.name),c=t.fields.map(u=>a.getTypeParser(u.dataTypeID)),l=e===!0?t.rows.map(u=>u.map((p,d)=>p===null?null:c[d](p))):t.rows.map(u=>Object.fromEntries(u.map((p,d)=>[o[d],p===null?null:c[d](p)])));return i&&i(n,t,l,{arrayMode:e,fullResults:r}),r?(t.viaNeonFetch=!0,t.rowAsArray=e,t.rows=l,t._parsers=c,t._types=a,t):l}w(py,"processQueryResult");async function _A(t){if(typeof t=="string")return t;if(typeof t=="function")try{return await Promise.resolve(t())}catch(e){let r=new Ua("Error getting auth token.");throw e instanceof Error&&(r=new Ua(`Error getting auth token: ${e.message}`)),r}}w(_A,"getAuthToken");var CU=Ha(by()),Qa=Ha(wy()),SA=class extends gA.Client{constructor(e){super(e),this.config=e}get neonConfig(){return this.connection.stream}connect(e){let{neonConfig:r}=this;r.forceDisablePgSSL&&(this.ssl=this.connec
`);c.write(s.format.apply(s,E))}}w(x,"warn"),Object.defineProperty(e.exports,"isWin",{get:w(function(){return o},"get"),set:w(function(O){o=O},"set")}),e.exports.warnTo=function(O){var E=c;return c=O,E},e.exports.getFileName=function(O){var E=O||be.env,A=E.PGPASSFILE||(o?r.join(E.APPDATA||"./","postgresql","pgpass.conf"):r.join(E.HOME||"./",".pgpass"));return A},e.exports.usePgPass=function(O,E){return Object.prototype.hasOwnProperty.call(be.env,"PGPASSWORD")?!1:o?!0:(E=E||"<unkn>",g(O.mode)?O.mode&(l|u)?(x('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',E),!1):!0:(x('WARNING: password file "%s" is not a plain file',E),!1))};var _=e.exports.match=function(O,E){return m.slice(0,-1).reduce(function(A,k,C){return C==1&&Number(O[k]||a)===Number(E[k])?A&&!0:A&&(E[k]==="*"||E[k]===O[k])},!0)};e.exports.getPassword=function(O,E,A){var k,C=E.pipe(i());function j(H){var B=S(H);B&&T(B)&&_(O,B)&&(k=B[v],C.end())}w(j,"onLine");var L=w(function(){E.destroy(),A(k)},"onEnd"),V=w(function(H){E.destroy(),x("WARNING: error on reading file: %s",H),A(void 0)},"onErr");E.on("error",V),C.on("data",j).on("end",L).on("error",V)};var S=e.exports.parseLine=function(O){if(O.length<11||O.match(/^\s+#/))return null;for(var E="",A="",k=0,C=0,j=0,L={},V=!1,H=w(function(z,X,K){var oe=O.substring(X,K);Object.hasOwnProperty.call(be.env,"PGPASS_NO_DEESCAPE")||(oe=oe.replace(/\\([:\\])/g,"$1")),L[m[z]]=oe},"addToObj"),B=0;B<O.length-1;B+=1){if(E=O.charAt(B+1),A=O.charAt(B),V=k==f-1,V){H(k,C);break}B>=0&&E==":"&&A!=="\\"&&(H(k,C,B+1),C=B+2,k+=1)}return L=Object.keys(L).length===f?L:null,L},T=e.exports.isValidEntry=function(O){for(var E={0:function(L){return L.length>0},1:function(L){return L==="*"?!0:(L=Number(L),isFinite(L)&&L>0&&L<9007199254740992&&Math.floor(L)===L)},2:function(L){return L.length>0},3:function(L){return L.length>0},4:function(L){return L.length>0}},A=0;A<m.length;A+=1){var k=E[A],C=O[m[A]]||"",j=k(C);if(!j)return!1}return!0}}),aU=xe((t,e)=>{"use strict";ae();var r=(X4(),St(hy)),n=(Y4(),St(my)),i=sU();e.exports=function(s,a){var o=i.getFileName();n.stat(o,function(c,l){if(c||!i.usePgPass(l,o))return a(void 0);var u=n.createReadStream(o);i.getPassword(s,u,a)})},e.exports.warnTo=i.warnTo}),vy=xe((t,e)=>{"use strict";ae();var r=Cf();function n(i){this._types=i||r,this.text={},this.binary={}}w(n,"TypeOverrides"),n.prototype.getOverrides=function(i){switch(i){case"text":return this.text;case"binary":return this.binary;default:return{}}},n.prototype.setTypeParser=function(i,s,a){typeof s=="function"&&(a=s,s="text"),this.getOverrides(s)[i]=a},n.prototype.getTypeParser=function(i,s){return s=s||"text",this.getOverrides(s)[i]||this._types.getTypeParser(i,s)},e.exports=n}),nA={};Pr(nA,{default:()=>iA});var iA,oU=Jt(()=>{"use strict";ae(),iA={}}),sA={};Pr(sA,{parse:()=>yy});function yy(t,e=!1){let{protocol:r}=new URL(t),n="http:"+t.substring(r.length),{username:i,password:s,host:a,hostname:o,port:c,pathname:l,search:u,searchParams:p,hash:d}=new URL(n);s=decodeURIComponent(s),i=decodeURIComponent(i),l=decodeURIComponent(l);let g=i+":"+s,m=e?Object.fromEntries(p.entries()):u;return{href:t,protocol:r,auth:g,username:i,password:s,host:a,hostname:o,port:c,pathname:l,search:u,query:m,hash:d}}var aA=Jt(()=>{"use strict";ae(),w(yy,"parse")}),cU=xe((t,e)=>{"use strict";ae();var r=(aA(),St(sA)),n=(Y4(),St(my));function i(s){if(s.charAt(0)==="/"){var o=s.split(" ");return{host:o[0],database:o[1]}}var a=r.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(s)?encodeURI(s).replace(/\%25(\d\d)/g,"%$1"):s,!0),o=a.query;for(var c in o)Array.isArray(o[c])&&(o[c]=o[c][o[c].length-1]);var l=(a.auth||":").split(":");if(o.user=l[0],o.password=l.splice(1).join(":"),o.port=a.port,a.protocol=="socket:")return o.host=decodeURI(a.pathname),o.database=a.query.db,o.client_encoding=a.query.encoding,o;o.host||(o.host=a.hostname);var u=a.pathname;if(!o.host&&u&&/^%2f/i.test(u)){var p=u.split("/");o.host=decodeURIComponent(p[0]),u=p.splice(1).join("/")}switch(u&&u.charAt(0)==="/"&&(u=u.slice(1)||null),o.database=u&&decodeURI(u),(o.ssl==="true"||o.ssl==="1")&&(o.ssl=!0),o.ssl==="0"&&(o.ssl=!1),(o.sslcert||o.sslkey||o.sslrootcert||o.sslmode)&&(o.ssl={}),o.sslcert&&(o.ssl.cert=n.readFileSync(o.sslcert).toString()),o.sslkey&&(o.ssl.key=n.readFileSync(o.sslkey).toString()),o.sslrootcert&&(o.ssl.ca=n.readFileSync(o.sslrootcert).toString()),o.sslmode){case"disable":{o.ssl=!1;break}case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":{o.ssl.rejectUnauthorized=!1;break}}return o}w(i,"parse"),e.exports=i,i.parse=i}),by=xe((t,e)=>{"use strict";ae();var r=(oU(),St(nA)),n=Af(),i=cU().parse,s=w(function(p,d,g){return g===void 0?g=be.env["PG"+p.toUpperCase()]:g===!1||(g=be.env[g]),d[p]||g||n[p]},"val"),a=w(function(){switch(be.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return n.ssl},"readSSLConfigFromEnvironment"),o=w(function(p){return"'"+(""+p).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),c=w(function(p,d,g){var m=d[g];m!=null&&p.push(g+"="+o(m))},"add"),l=class{constructor(d){d=typeof d=="string"?i(d):d||{},d.connectionString&&(d=Object.assign({},d,i(d.connectionString))),this.user=s("user",d),this.database=s("database",d),this.database===void 0&&(this.database=this.user),this.port=parseInt(s("port",d),10),this.host=s("host",d),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:s("password",d)}),this.binary=s("binary",d),this.options=s("options",d),this.ssl=typeof d.ssl>"u"?a():d.ssl,typeof this.ssl=="string"&&this.ssl==="true"&&(this.ssl=!0),this.ssl==="no-verify"&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=s("client_encoding",d),this.replication=s("replication",d),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=s("application_name",d,"PGAPPNAME"),this.fallback_application_name=s("fallback_application_name",d,!1),this.statement_timeout=s("statement_timeout",d,!1),this.lock_timeout=s("lock_timeout",d,!1),this.idle_in_transaction_session_timeout=s("idle_in_transaction_session_timeout",d,!1),this.query_timeout=s("query_timeout",d,!1),d.connectionTimeoutMillis===void 0?this.connect_timeout=be.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(d.connectionTimeoutMillis/1e3),d.keepAlive===!1?this.keepalives=0:d.keepAlive===!0&&(this.keepalives=1),typeof d.keepAliveInitialDelayMillis=="number"&&(this.keepalives_idle=Math.floor(d.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(d){var g=[];c(g,this,"user"),c(g,this,"password"),c(g,this,"port"),c(g,this,"application_name"),c(g,this,"fallback_application_name"),c(g,this,"connect_timeout"),c(g,this,"options");var m=typeof this.ssl=="object"?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(c(g,m,"sslmode"),c(g,m,"sslca"),c(g,m,"sslkey"),c(g,m,"sslcert"),c(g,m,"sslrootcert"),this.database&&g.push("dbname="+o(this.database)),this.replication&&g.push("replication="+o(this.replication)),this.host&&g.push("host="+o(this.host)),this.isDomainSocket)return d(null,g.join(" "));this.client_encoding&&g.push("client_encoding="+o(this.client_encoding)),r.lookup(this.host,function(f,v){return f?d(f,null):(g.push("hostaddr="+o(v)),d(null,g.join(" ")))})}};w(l,"ConnectionParameters");var u=l;e.exports=u}),lU=xe((t,e)=>{"use strict";ae();var r=Cf(),n=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,i=class{constructor(o,c){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=c,this.RowCtor=null,this.rowAsArray=o==="array",this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(o){var c;o.text?c=n.exec(o.text):c=n.exec(o.command),c&&(this.command=c[1],c[3]?(this.oid=parseInt(c[2],10),this.rowCount=parseInt(c[3],10)):c[2]&&(this.rowCount=parseInt(c[2],10)))}_parseRowAsArray(o){for(var c=new Array(o.length),l=0,u=o.length;l<u;l++){var p=o[l];p!==null?c[l]=this._parsers[l](p):c[l]=null}return c}parseRow(o){for(var c={},l=0,u=o.length;l<u;l++){var p=o[l],d=this.fields[l].name;p!==null?c[d]=this._parsers[l](p):c[d]=null}return c}addRow(o){this.rows.push(o)}addFields(o){this.fields=o,this.fields.length&&(this._parsers=new Array(o.length));for(var c=0;c<o.length;c++){var l=o[c];this._types?this._parsers[c]=this._types.getTypeParser(l.dataTypeID,l.format||"text"):this._parsers[c]=r.getTypeParser(l.dataTypeID,l.format||"text")}}};w(i,"Result");var s=i;e.exports=s}),uU=xe((t,e)=>{"use strict";ae();var{EventEmitter:r}=is(),n=lU(),i=kf(),s=class extends r{constructor(c,l,u){super(),c=i.normalizeQueryConfig(c,l,u),this.text=c.text,this.values=c.values,this.rows=c.rows,this.types=c.types,this.name=c.name,this.binary=c.binary,this.portal=c.portal||"",this.callback=c.callback,this._rowMode=c.rowMode,be.domain&&c.callback&&(this.callback=be.domain.bind(c.callback)),this._result=new n(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return this.name||this.rows?!0:!this.text||!this.values?!1:this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new n(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(c){this._checkForMultirow(),this._result.addFields(c.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(c){let l;if(!this._canceledDueToError){try{l=this._result.parseRow(c.fields)}catch(u){this._canceledDueToError=u;return}this.emit("row",l,this._result),this._accumulateRows&&this._result.addRow(l)}}handleCommandComplete(c,l){this._checkForMultirow(),this._result.addCommandComplete(c),this.rows&&l.sync()}handleEmptyQuery(c){this.rows&&c.sync()}handleError(c,l){if(this._canceledDueToError&&(c=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(c);this.emit("error",c)}handleReadyForQuery(c){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,c);if(this.callback)try{this.callback(null,this._results)}catch(l){be.nextTick(()=>{throw l})}this.emit("end",this._results)}submit(c){if(typeof this.text!="string"&&typeof this.name!="string")return new Error("A query must have either text or a name. Supplying neither is unsupported.");let l=c.parsedStatements[this.name];return this.text&&l&&this.text!==l?new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`):this.values&&!Array.isArray(this.values)?new Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(c):c.query(this.text),null)}hasBeenParsed(c){return this.name&&c.parsedStatements[this.name]}handlePortalSuspended(c){this._getRows(c,this.rows)}_getRows(c,l){c.execute({portal:this.portal,rows:l}),l?c.flush():c.sync()}prepare(c){this.isPreparedStatement=!0,this.hasBeenParsed(c)||c.parse({text:this.text,name:this.name,types:this.types});try{c.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:i.prepareValue})}catch(l){this.handleError(l,c);return}c.describe({type:"P",name:this.portal||""}),this._getRows(c,this.rows)}handleCopyInResponse(c){c.sendCopyFail("No source stream defined")}handleCopyData(c,l){}};w(s,"Query");var a=s;e.exports=a}),oA={};Pr(oA,{Socket:()=>Wa,isIP:()=>cA});function cA(t){return 0}var q4,ly,Tl,Wa,xy=Jt(()=>{"use strict";ae(),q4=Ha(is(),1),w(cA,"isIP"),ly=/^[^.]+\./,Tl=class le extends q4.EventEmitter{constructor(){super(...arguments),me(this,"opts",{}),me(this,"connecting",!1),me(this,"pending",!0),me(this,"writable",!0),me(this,"encrypted",!1),me(this,"authorized",!1),me(this,"destroyed",!1),me(this,"ws",null),me(this,"writeBuffer"),me(this,"tlsState",0),me(this,"tlsRead"),me(this,"tlsWrite")}static get poolQueryViaFetch(){return le.opts.poolQueryViaFetch??le.defaults.poolQueryViaFetch}static set poolQueryViaFetch(e){le.opts.poolQueryViaFetch=e}static get fetchEndpoint(){return le.opts.fetchEndpoint??le.defaults.fetchEndpoint}static set fetchEndpoint(e){le.opts.fetchEndpoint=e}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(e){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return le.opts.fetchFunction??le.defaults.fetchFunction}static set fetchFunction(e){le.opts.fetchFunction=e}static get webSocketConstructor(){return le.opts.webSocketConstructor??le.defaults.webSocketConstructor}static set webSocketConstructor(e){le.opts.webSocketConstructor=e}get webSocketConstructor(){return this.opts.webSocketConstructor??le.webSocketConstructor}set webSocketConstructor(e){this.opts.webSocketConstructor=e}static get wsProxy(){return le.opts.wsProxy??le.defaults.wsProxy}static set wsProxy(e){le.opts.wsProxy=e}get wsProxy(){return this.opts.wsProxy??le.wsProxy}set wsProxy(e){this.opts.wsProxy=e}static get coalesceWrites(){return le.opts.coalesceWrites??le.defaults.coalesceWrites}static set coalesceWrites(e){le.opts.coalesceWrites=e}get coalesceWrites(){return this.opts.coalesceWrites??le.coalesceWrites}set coalesceWrites(e){this.opts.coalesceWrites=e}static get useSecureWebSocket(){return le.opts.useSecureWebSocket??le.defaults.useSecureWebSocket}static set useSecureWebSocket(e){le.opts.useSecureWebSocket=e}get useSecureWebSocket(){return this.opts.useSecureWebSocket??le.useSecureWebSocket}set useSecureWebSocket(e){this.opts.useSecureWebSocket=e}static get forceDisablePgSSL(){return le.opts.forceDisablePgSSL??le.defaults.forceDisablePgSSL}static set forceDisablePgSSL(e){le.opts.forceDisablePgSSL=e}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??le.forceDisablePgSSL}set forceDisablePgSSL(e){this.opts.forceDisablePgSSL=e}static get disableSNI(){return le.opts.disableSNI??le.defaults.disableSNI}static set disableSNI(e){le.opts.disableSNI=e}get disableSNI(){return this.opts.disableSNI??le.disableSNI}set disableSNI(e){this.opts.disableSNI=e}static get pipelineConnect(){return le.opts.pipelineConnect??le.defaults.pipelineConnect}static set pipelineConnect(e){le.opts.pipelineConnect=e}get pipelineConnect(){return this.opts.pipelineConnect??le.pipelineConnect}set pipelineConnect(e){this.opts.pipelineConnect=e}static get subtls(){return le.opts.subtls??le.defaults.subtls}static set subtls(e){le.opts.subtls=e}get subtls(){return this.opts.subtls??le.subtls}set subtls(e){this.opts.subtls=e}static get pipelineTLS(){return le.opts.pipelineTLS??le.defaults.pipelineTLS}static set pipelineTLS(e){le.opts.pipelineTLS=e}get pipelineTLS(){return this.opts.pipelineTLS??le.pipelineTLS}set pipelineTLS(e){this.opts.pipelineTLS=e}static get rootCerts(){return le.opts.rootCerts??le.defaults.rootCerts}static set rootCerts(e){le.opts.rootCerts=e}get rootCerts(){return this.opts.rootCerts??le.rootCerts}set rootCerts(e){this.opts.rootCerts=e}wsProxyAddrForHost(e,r){let n=this.wsProxy;if(n===void 0)throw new Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return typeof n=="function"?n(e,r):`${n}?address=${e}:${r}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(e,r,n){this.connecting=!0,n&&this.once("connect",n);let i=w(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),s=w((o,c=!1)=>{o.binaryType="arraybuffer",o.addEventListener("error",l=>{this.emit("error",l),this.emit("close")}),o.addEventListener("message",l=>{if(this.tlsState===0){let u=he.from(l.data);this.emit("data",u)}}),o.addEventListener("close",()=>{this.emit("close")}),c?i():o.addEventListener("open",i)},"configureWebSocket"),a;try{a=this.wsProxyAddrForHost(r,typeof e=="string"?parseInt(e,10):e)}catch(o){this.emit("error",o),this.emit("close");return}try{let o=(this.useSecureWebSocket?"wss:":"ws:")+"//"+a;if(this.webSocketConstructor!==void 0)this.ws=new this.webSocketConstructor(o),s(this.ws);else try{this.ws=new WebSocket(o),s(this.ws)}catch{this.ws=new __unstable_WebSocket(o),s(this.ws)}}catch(o){let c=(this.useSecureWebSocket?"https:":"http:")+"//"+a;fetch(c,{headers:{Upgrade:"websocket"}}).then(l=>{if(this.ws=l.webSocket,this.ws==null)throw o;this.ws.accept(),s(this.ws,!0)}).catch(l=>{this.emit("error",new Error(`All attempts to open a WebSocket to connect to the database failed. Please refer to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websocket--undefined. Details: ${l.message}`)),this.emit("close")})}}async startTls(e){if(this.subtls===void 0)throw new Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let r=this.subtls.TrustedCert.fromPEM(this.rootCerts),n=new this.subtls.WebSocketReadQueue(this.ws),i=n.read.bind(n),s=this.rawWrite.bind(this),[a,o]=await this.subtls.startTls(e,r,i,s,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=a,this.tlsWrite=o,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let e=await this.tlsRead();if(e===void 0)break;{let r=he.from(e);this.emit("data",r)}}}rawWrite(e){if(!this.coalesceWrites){this.ws.send(e);return}if(this.writeBuffer===void 0)this.writeBuffer=e,setTimeout(()=>{this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let r=new Uint8Array(this.writeBuffer.length+e.length);r.set(this.writeBuffer),r.set(e,this.writeBuffer.length),this.writeBuffer=r}}write(e,r="utf8",n=i=>{}){return e.length===0?(n(),!0):(typeof e=="string"&&(e=he.from(e,r)),this.tlsState===0?(this.rawWrite(e),n()):this.tlsState===1?this.once("secureConnection",()=>{this.write(e,r,n)}):(this.tlsWrite(e),n()),!0)}end(e=he.alloc(0),r="utf8",n=()=>{}){return this.write(e,r,()=>{this.ws.close(),n()}),this}destroy(){return this.destroyed=!0,this.end()}},w(Tl,"Socket"),me(Tl,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:w((t,e,r)=>{let n;return r?.jwtAuth?n=t.replace(ly,"apiauth."):n=t.replace(ly,"api."),"https://"+n+"/sql"},"fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:w(t=>t+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1}),me(Tl,"opts",{}),Wa=Tl}),lA=xe(t=>{"use strict";ae(),Object.defineProperty(t,"__esModule",{value:!0}),t.NoticeMessage=t.DataRowMessage=t.CommandCompleteMessage=t.ReadyForQueryMessage=t.NotificationResponseMessage=t.BackendKeyDataMessage=t.AuthenticationMD5Password=t.ParameterStatusMessage=t.ParameterDescriptionMessage=t.RowDescriptionMessage=t.Field=t.CopyResponse=t.CopyDataMessage=t.DatabaseError=t.copyDone=t.emptyQuery=t.replicationStart=t.portalSuspended=t.noData=t.closeComplete=t.bindComplete=t.parseComplete=void 0,t.parseComplete={name:"parseComplete",length:5},t.bindComplete={name:"bindComplete",length:5},t.closeComplete={name:"closeComplete",length:5},t.noData={name:"noData",length:5},t.portalSuspended={name:"portalSuspended",length:5},t.replicationStart={name:"replicationStart",length:4},t.emptyQuery={name:"emptyQuery",length:4},t.copyDone={name:"copyDone",length:4};var e=class extends Error{constructor(B,z,X){super(B),this.length=z,this.name=X}};w(e,"DatabaseError");var r=e;t.DatabaseError=r;var n=class{constructor(B,z){this.length=B,this.chunk=z,this.name="copyData"}};w(n,"CopyDataMessage");var i=n;t.CopyDataMessage=i;var s=class{constructor(B,z,X,K){this.length=B,this.name=z,this.binary=X,this.columnTypes=new Array(K)}};w(s,"CopyResponse");var a=s;t.CopyResponse=a;var o=class{constructor(B,z,X,K,oe,we,pe){this.name=B,this.tableID=z,this.columnID=X,this.dataTypeID=K,this.dataTypeSize=oe,this.dataTypeModifier=we,this.format=pe}};w(o,"Field");var c=o;t.Field=c;var l=class{constructor(B,z){this.length=B,this.fieldCount=z,this.name="rowDescription",this.fields=new Array(this.fieldCount)}};w(l,"RowDescriptionMessage");var u=l;t.RowDescriptionMessage=u;var p=class{constructor(B,z){this.length=B,this.parameterCount=z,this.name="parameterDescription",this.dataTypeIDs=new Array(this.parameterCount)}};w(p,"ParameterDescriptionMessage");var d=p;t.ParameterDescriptionMessage=d;var g=class{constructor(B,z,X){this.length=B,this.parameterName=z,this.parameterValue=X,this.name="parameterStatus"}};w(g,"ParameterStatusMessage");var m=g;t.ParameterStatusMessage=m;var f=class{constructor(B,z){this.length=B,this.salt=z,this.name="authenticationMD5Password"}};w(f,"AuthenticationMD5Password");var v=f;t.AuthenticationMD5Password=v;var x=class{constructor(B,z,X){this.length=B,this.processID=z,this.secretKey=X,this.name="backendKeyData"}};w(x,"BackendKeyDataMessage");var _=x;t.BackendKeyDataMessage=_;var S=class{constructor(B,z,X,K){this.length=B,this.processId=z,this.channel=X,this.payload=K,this.name="notification"}};w(S,"NotificationResponseMessage");var T=S;t.NotificationResponseMessage=T;var O=class{constructor(B,z){this.length=B,this.status=z,this.name="readyForQuery"}};w(O,"ReadyForQueryMessage");var E=O;t.ReadyForQueryMessage=E;var A=class{constructor(B,z){this.length=B,this.text=z,this.name="commandComplete"}};w(A,"CommandCompleteMessage");var k=A;t.CommandCompleteMessage=k;var C=class{constructor(B,z){this.length=B,this.fields=z,this.name="dataRow",this.fieldCount=z.length}};w(C,"DataRowMessage");var j=C;t.DataRowMessage=j;var L=class{constructor(B,z){this.length=B,this.message=z,this.name="notice"}};w(L,"NoticeMessage");var V=L;t.NoticeMessage=V}),pU=xe(t=>{"use strict";ae(),Object.defineProperty(t,"__esModule",{value:!0}),t.Writer=void 0;var e=class{constructor(i=256){this.size=i,this.offset=5,this.headerPosition=0,this.buffer=he.allocUnsafe(i)}ensure(i){var s=this.buffer.length-this.offset;if(s<i){var a=this.buffer,o=a.length+(a.length>>1)+i;this.buffer=he.allocUnsafe(o),a.copy(this.buffer)}}addInt32(i){return this.ensure(4),this.buffer[this.offset++]=i>>>24&255,this.buffer[this.offset++]=i>>>16&255,this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addInt16(i){return this.ensure(2),this.buffer[this.offset++]=i>>>8&255,this.buffer[this.offset++]=i>>>0&255,this}addCString(i){if(!i)this.ensure(1);else{var s=he.byteLength(i);this.ensure(s+1),this.buffer.write(i,this.offset,"utf-8"),this.offset+=s}return this.buffer[this.offset++]=0,this}addString(i=""){var s=he.byteLength(i);return this.ensure(s),this.buffer.write(i,this.offset),this.offset+=s,this}add(i){return this.ensure(i.length),i.copy(this.buffer,this.offset),this.offset+=i.length,this}join(i){if(i){this.buffer[this.headerPosition]=i;let s=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(s,this.headerPosition+1)}return this.buffer.slice(i?0:5,this.offset)}flush(i){var s=this.join(i);return this.offset=5,this.headerPosition=0,this.buffer=he.allocUnsafe(this.size),s}};w(e,"Writer");var r=e;t.Writer=r}),fU=xe(t=>{"use strict";ae(),Object.defineProperty(t,"__esModule",{value:!0}),t.serialize=void 0;var e=pU(),r=new e.Writer,n=w(B=>{r.addInt16(3).addInt16(0);for(let K of Object.keys(B))r.addCString(K).addCString(B[K]);r.addCString("client_encoding").addCString("UTF8");var z=r.addCString("").flush(),X=z.length+4;return new e.Writer().addInt32(X).add(z).flush()},"startup"),i=w(()=>{let B=he.allocUnsafe(8);return B.writeInt32BE(8,0),B.writeInt32BE(80877103,4),B},"requestSsl"),s=w(B=>r.addCString(B).flush(112),"password"),a=w(function(B,z){return r.addCString(B).addInt32(he.byteLength(z)).addString(z),r.flush(112)},"sendSASLInitialResponseMessage"),o=w(function(B){return r.addString(B).flush(112)},"sendSCRAMClientFinalMessage"),c=w(B=>r.addCString(B).flush(81),"query"),l=[],u=w(B=>{let z=B.name||"";z.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",z,z.length),console.error("This can cause conflicts and silent errors executing queries"));let X=B.types||l;for(var K=X.length,oe=r.addCString(z).addCString(B.text).addInt16(K),we=0;we<K;we++)oe.addInt32(X[we]);return r.flush(80)},"parse"),p=new e.Writer,d=w(function(B,z){for(let X=0;X<B.length;X++){let K=z?z(B[X],X):B[X];K==null?(r.addInt16(0),p.addInt32(-1)):K instanceof he?(r.addInt16(1),p.addInt32(K.length),p.add(K)):(r.addInt16(0),p.addInt32(he.byteLength(K)),p.addString(K))}},"writeValues"),g=w((B={})=>{let z=B.portal||"",X=B.statement||"",K=B.binary||!1,oe=B.values||l,we=oe.length;return r.addCString(z).addCString(X),r.addInt16(we),d(oe,B.valueMapper),r.addInt16(we),r.add(p.flush()),r.addInt16(K?1:0),r.flush(66)},"bind"),m=he.from([69,0,0,0,9,0,0,0,0,0]),f=w(B=>{if(!B||!B.portal&&!B.rows)return m;let z=B.portal||"",X=B.rows||0,K=he.byteLength(z),oe=4+K+1+4,we=he.allocUnsafe(1+oe);return we[0]=69,we.writeInt32BE(oe,1),we.write(z,5,"utf-8"),we[K+5]=0,we.writeUInt32BE(X,we.length-4),we},"execute"),v=w((B,z)=>{let X=he.allocUnsafe(16);return X.writeInt32BE(16,0),X.writeInt16BE(1234,4),X.writeInt16BE(5678,6),X.writeInt32BE(B,8),X.writeInt32BE(z,12),X},"cancel"),x=w((B,z)=>{let X=4+he.byteLength(z)+1,K=he.allocUnsafe(1+X);return K[0]=B,K.writeInt32BE(X,1),K.write(z,5,"utf-8"),K[X]=0,K},"cstringMessage"),_=r.addCString("P").flush(68),S=r.addCString("S").flush(68),T=w(B=>B.name?x(68,`${B.type}${B.name||""}`):B.type==="P"?_:S,"describe"),O=w(B=>{let z=`${B.type}${B.name||""}`;return x(67,z)},"close"),E=w(B=>r.add(B).flush(100),"copyData"),A=w(B=>x(102,B),"copyFail"),k=w(B=>he.from([B,0,0,0,4]),"codeOnlyBuffer"),C=k(72),j=k(83),L=k(88),V=k(99),H={startup:n,password:s,requestSsl:i,sendSASLInitialResponseMessage:a,sendSCRAMClientFinalMessage:o,query:c,parse:u,bind:g,execute:f,describe:T,close:O,flush:w(()=>C,"flush"),sync:w(()=>j,"sync"),end:w(()=>L,"end"),copyData:E,copyDone:w(()=>V,"copyDone"),copyFail:A,cancel:v};t.serialize=H}),dU=xe(t=>{"use strict";ae(),Object.defineProperty(t,"__esModule",{value:!0}),t.BufferReader=void 0;var e=he.allocUnsafe(0),r=class{constructor(s=0){this.offset=s,this.buffer=e,this.encoding="utf-8"}setBuffer(s,a){this.offset=s,this.buffer=a}int16(){let s=this.buffer.readInt16BE(this.offset);return this.offset+=2,s}byte(){let s=this.buffer[this.offset];return this.offset++,s}int32(){let s=this.buffer.readInt32BE(this.offset);return this.offset+=4,s}string(s){let a=this.buffer.toString(this.encoding,this.offset,this.offset+s);return this.offset+=s,a}cstring(){let s=this.offset,a=s;for(;this.buffer[a++]!==0;);return this.offset=a,this.buffer.toString(this.encoding,s,a-1)}bytes(s){let a=this.buffer.slice(this.offset,this.offset+s);return this.offset+=s,a}};w(r,"BufferReader");var n=r;t.BufferReader=n}),hU=xe(t=>{"use strict";ae(),Object.defineProperty(t,"__esModule",{value:!0}),t.Parser=void 0;var e=lA(),r=dU(),n=1,i=4,s=n+i,a=he.allocUnsafe(0),o=class{constructor(u){if(this.buffer=a,this.bufferLength=0,this.bufferOffset=0,this.reader=new r.BufferReader,u?.mode==="binary")throw new Error("Binary mode not supported yet");this.mode=u?.mode||"text"}parse(u,p){this.mergeBuffer(u);let d=this.bufferOffset+this.bufferLength,g=this.bufferOffset;for(;g+s<=d;){let m=this.buffer[g],f=this.buffer.readUInt32BE(g+n),v=n+f;if(v+g<=d){let x=this.handlePacket(g+s,m,f,this.buffer);p(x),g+=v}else break}g===d?(this.buffer=a,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=d-g,this.bufferOffset=g)}mergeBuffer(u){if(this.bufferLength>0){let p=this.bufferLength+u.byteLength;if(p+this.bufferOffset>this.buffer.byteLength){let d;if(p<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)d=this.buffer;else{let g=this.buffer.byteLength*2;for(;p>=g;)g*=2;d=he.allocUnsafe(g)}this.buffer.copy(d,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=d,this.bufferOffset=0}u.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=p}else this.buffer=u,this.bufferOffset=0,this.bufferLength=u.byteLength}handlePacket(u,p,d,g){switch(p){case 50:return e.bindComplete;case 49:return e.parseComplete;case 51:return e.closeComplete;case 110:return e.noData;case 115:return e.portalSuspended;case 99:return e.copyDone;case 87:return e.replicationStart;case 73:return e.emptyQuery;case 68:return this.parseDataRowMessage(u,d,g);case 67:return this.parseCommandCompleteMessage(u,d,g);case 90:return this.parseReadyForQueryMessage(u,d,g);case 65:return this.parseNotificationMessage(u,d,g);case 82:return this.parseAuthenticationResponse(u,d,g);case 83:return this.parseParameterStatusMessage(u,d,g);case 75:return this.parseBackendKeyData(u,d,g);case 69:return this.parseErrorMessage(u,d,g,"error");case 78:return this.parseErrorMessage(u,d,g,"notice");case 84:return this.parseRowDescriptionMessage(u,d,g);case 116:return this.parseParameterDescriptionMessage(u,d,g);case 71:return this.parseCopyInMessage(u,d,g);case 72:return this.parseCopyOutMessage(u,d,g);case 100:return this.parseCopyData(u,d,g);default:return new e.DatabaseError("received invalid response: "+p.toString(16),d,"error")}}parseReadyForQueryMessage(u,p,d){this.reader.setBuffer(u,d);let g=this.reader.string(1);return new e.ReadyForQueryMessage(p,g)}parseCommandCompleteMessage(u,p,d){this.reader.setBuffer(u,d);let g=this.reader.cstring();return new e.CommandCompleteMessage(p,g)}parseCopyData(u,p,d){let g=d.slice(u,u+(p-4));return new e.CopyDataMessage(p,g)}parseCopyInMessage(u,p,d){return this.parseCopyMessage(u,p,d,"copyInResponse")}parseCopyOutMessage(u,p,d){return this.parseCopyMessage(u,p,d,"copyOutResponse")}parseCopyMessage(u,p,d,g){this.reader.setBuffer(u,d);let m=this.reader.byte()!==0,f=this.reader.int16(),v=new e.CopyResponse(p,g,m,f);for(let x=0;x<f;x++)v.columnTypes[x]=this.reader.int16();return v}parseNotificationMessage(u,p,d){this.reader.setBuffer(u,d);let g=this.reader.int32(),m=this.reader.cstring(),f=this.reader.cstring();return new e.NotificationResponseMessage(p,g,m,f)}parseRowDescriptionMessage(u,p,d){this.reader.setBuffer(u,d);let g=this.reader.int16(),m=new e.RowDescriptionMessage(p,g);for(let f=0;f<g;f++)m.fields[f]=this.parseField();return m}parseField(){let u=this.reader.cstring(),p=this.reader.int32(),d=this.reader.int16(),g=this.reader.int32(),m=this.reader.int16(),f=this.reader.int32(),v=this.reader.int16()===0?"text":"binary";return new e.Field(u,p,d,g,m,f,v)}parseParameterDescriptionMessage(u,p,d){this.reader.setBuffer(u,d);let g=this.reader.int16(),m=new e.ParameterDescriptionMessage(p,g);for(let f=0;f<g;f++)m.dataTypeIDs[f]=this.reader.int32();return m}parseDataRowMessage(u,p,d){this.reader.setBuffer(u,d);let g=this.reader.int16(),m=new Array(g);for(let f=0;f<g;f++){let v=this.reader.int32();m[f]=v===-1?null:this.reader.string(v)}return new e.DataRowMessage(p,m)}parseParameterStatusMessage(u,p,d){this.reader.setBuffer(u,d);let g=this.reader.cstring(),m=this.reader.cstring();return new e.ParameterStatusMessage(p,g,m)}parseBackendKeyData(u,p,d){this.reader.setBuffer(u,d);let g=this.reader.int32(),m=this.reader.int32();return new e.BackendKeyDataMessage(p,g,m)}parseAuthenticationResponse(u,p,d){this.reader.setBuffer(u,d);let g=this.reader.int32(),m={name:"authenticationOk",length:p};switch(g){case 0:break;case 3:m.length===8&&(m.name="authenticationCleartextPassword");break;case 5:if(m.length===12){m.name="authenticationMD5Password";let v=this.reader.bytes(4);return new e.AuthenticationMD5Password(p,v)}break;case 10:m.name="authenticationSASL",m.mechanisms=[];let f;do f=this.reader.cstring(),f&&m.mechanisms.push(f);while(f);break;case 11:m.name="authenticationSASLContinue",m.data=this.reader.string(p-8);break;case 12:m.name="authenticationSASLFinal",m.data=this.reader.string(p-8);break;default:throw new Error("Unknown authenticationOk message type "+g)}return m}parseErrorMessage(u,p,d,g){this.reader.setBuffer(u,d);let m={},f=this.reader.string(1);for(;f!=="\0";)m[f]=this.reader.cstring(),f=this.reader.string(1);let v=m.M,x=g==="notice"?new e.NoticeMessage(p,v):new e.DatabaseError(v,p,g);return x.severity=m.S,x.code=m.C,x.detail=m.D,x.hint=m.H,x.position=m.P,x.internalPosition=m.p,x.internalQuery=m.q,x.where=m.W,x.schema=m.s,x.table=m.t,x.column=m.c,x.dataType=m.d,x.constraint=m.n,x.file=m.F,x.line=m.L,x.routine=m.R,x}};w(o,"Parser");var c=o;t.Parser=c}),uA=xe(t=>{"use strict";ae(),Object.defineProperty(t,"__esModule",{value:!0}),t.DatabaseError=t.serialize=t.parse=void 0;var e=lA();Object.defineProperty(t,"DatabaseError",{enumerable:!0,get:w(function(){return e.DatabaseError},"get")});var r=fU();Object.defineProperty(t,"serialize",{enumerable:!0,get:w(function(){return r.serialize},"get")});var n=hU();function i(s,a){let o=new n.Parser;return s.on("data",c=>o.parse(c,a)),new Promise(c=>s.on("end",()=>c()))}w(i,"parse"),t.parse=i}),pA={};Pr(pA,{connect:()=>fA});function fA({socket:t,servername:e}){return t.startTls(e),t}var mU=Jt(()=>{"use strict";ae(),w(fA,"connect")}),dA=xe((t,e)=>{"use strict";ae();var r=(xy(),St(oA)),n=is().EventEmitter,{parse:i,serialize:s}=uA(),a=s.flush(),o=s.sync(),c=s.end(),l=class extends n{constructor(d){super(),d=d||{},this.stream=d.stream||new r.Socket,this._keepAlive=d.keepAlive,this._keepAliveInitialDelayMillis=d.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=d.ssl||!1,this._ending=!1,this._emitMessage=!1;var g=this;this.on("newListener",function(m){m==="message"&&(g._emitMessage=!0)})}connect(d,g){var m=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(d,g),this.stream.once("connect",function(){m._keepAlive&&m.stream.setKeepAlive(!0,m._keepAliveInitialDelayMillis),m.emit("connect")});let f=w(function(v){m._ending&&(v.code==="ECONNRESET"||v.code==="EPIPE")||m.emit("error",v)},"reportStreamError");if(this.stream.on("error",f),this.stream.on("close",function(){m.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(v){var x=v.toString("utf8");switch(x){case"S":break;case"N":return m.stream.end(),m.emit("error",new Error("The server does not support SSL connections"));default:return m.stream.end(),m.emit("error",new Error("There was an error establishing an SSL connection"))}var _=(mU(),St(pA));let S={socket:m.stream};m.ssl!==!0&&(Object.assign(S,m.ssl),"key"in m.ssl&&(S.key=m.ssl.key)),r.isIP(g)===0&&(S.servername=g);try{m.stream=_.connect(S)}catch(T){return m.emit("error",T)}m.attachListeners(m.stream),m.stream.on("error",f),m.emit("sslconnect")})}attachListeners(d){d.on("end",()=>{this.emit("end")}),i(d,g=>{var m=g.name==="error"?"errorMessage":g.name;this._emitMessage&&this.emit("message",g),this.emit(m,g)})}requestSsl(){this.stream.write(s.requestSsl())}startup(d){this.stream.write(s.startup(d))}cancel(d,g){this._send(s.cancel(d,g))}password(d){this._send(s.password(d))}sendSASLInitialResponseMessage(d,g){this._send(s.sendSASLInitialResponseMessage(d,g))}sendSCRAMClientFinalMessage(d){this._send(s.sendSCRAMClientFinalMessage(d))}_send(d){return this.stream.writable?this.stream.write(d):!1}query(d){this._send(s.query(d))}parse(d){this._send(s.parse(d))}bind(d){this._send(s.bind(d))}execute(d){this._send(s.execute(d))}flush(){this.stream.writable&&this.stream.write(a)}sync(){this._ending=!0,this._send(a),this._send(o)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){if(this._ending=!0,!this._connecting||!this.stream.writable){this.stream.end();return}return this.stream.write(c,()=>{this.stream.end()})}close(d){this._send(s.close(d))}describe(d){this._send(s.describe(d))}sendCopyFromChunk(d){this._send(s.copyData(d))}endCopyFrom(){this._send(s.copyDone())}sendCopyFail(d){this._send(s.copyFail(d))}};w(l,"Connection");var u=l;e.exports=u}),gU=xe((t,e)=>{"use strict";ae();var r=is().EventEmitter,n=(Ef(),St(Il)),i=kf(),s=rU(),a=aU(),o=vy(),c=by(),l=uU(),u=Af(),p=dA(),d=class extends r{constructor(f){super(),this.connectionParameters=new c(f),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var v=f||{};this._Promise=v.Promise||Sf.Promise,this._types=new o(v.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=v.connection||new p({stream:v.stream,ssl:this.connectionParameters.ssl,keepAlive:v.keepAlive||!1,keepAliveInitialDelayMillis:v.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=v.binary||u.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=v.connectionTimeoutMillis||0}_errorAllQueries(f){let v=w(x=>{be.nextTick(()=>{x.handleError(f,this.connection)})},"enqueueError");this.activeQuery&&(v(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(v),this.queryQueue.length=0}_connect(f){var v=this,x=this.connection;if(this._connectionCallback=f,this._connecting||this._connected){let _=new Error("Client has already been connected. You cannot reuse a client.");be.nextTick(()=>{f(_)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{x._ending=!0,x.stream.destroy(new Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&this.host.indexOf("/")===0?x.connect(this.host+"/.s.PGSQL."+this.port):x.connect(this.port,this.host),x.on("connect",function(){v.ssl?x.requestSsl():x.startup(v.getStartupConf())}),x.on("sslconnect",function(){x.startup(v.getStartupConf())}),this._attachListeners(x),x.once("end",()=>{let _=this._ending?new Error("Connection terminated"):new Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(_),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(_):this._handleErrorEvent(_):this._connectionError||this._handleErrorEvent(_)),be.nextTick(()=>{this.emit("end")})})}connect(f){if(f){this._connect(f);return}return new this._Promise((v,x)=>{this._connect(_=>{_?x(_):v()})})}_attachListeners(f){f.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),f.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),f.on("authenticationSASL",this._handleAuthSASL.bind(this)),f.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),f.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),f.on("backendKeyData",this._handleBackendKeyData.bind(this)),f.on("error",this._handleErrorEvent.bind(this)),f.on("errorMessage",this._handleErrorMessage.bind(this)),f.on("readyForQuery",this._handleReadyForQuery.bind(this)),f.on("notice",this._handleNotice.bind(this)),f.on("rowDescription",this._handleRowDescription.bind(this)),f.on("dataRow",this._handleDataRow.bind(this)),f.on("portalSuspended",this._handlePortalSuspended.bind(this)),f.on("emptyQuery",this._handleEmptyQuery.bind(this)),f.on("commandComplete",this._handleCommandComplete.bind(this)),f.on("parseComplete",this._handleParseComplete.bind(this)),f.on("copyInResponse",this._handleCopyInResponse.bind(this)),f.on("copyData",this._handleCopyData.bind(this)),f.on("notification",this._handleNotification.bind(this))}_checkPgPass(f){let v=this.connection;typeof this.password=="function"?this._Promise.resolve().then(()=>this.password()).then(x=>{if(x!==void 0){if(typeof x!="string"){v.emit("error",new TypeError("Password must be a string"));return}this.connectionParameters.password=this.password=x}else this.connectionParameters.password=this.password=null;f()}).catch(x=>{v.emit("error",x)}):this.password!==null?f():a(this.connectionParameters,x=>{x!==void 0&&(this.connectionParameters.password=this.password=x),f()})}_handleAuthCleartextPassword(f){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(f){this._checkPgPass(()=>{let v=i.postgresMd5PasswordHash(this.user,this.password,f.salt);this.connection.password(v)})}_handleAuthSASL(f){this._checkPgPass(()=>{this.saslSession=s.startSession(f.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(f){s.continueSession(this.saslSession,this.password,f.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(f){s.finalizeSession(this.saslSession,f.data),this.saslSession=null}_handleBackendKeyData(f){this.processID=f.processID,this.secretKey=f.secretKey}_handleReadyForQuery(f){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:v}=this;this.activeQuery=null,this.readyForQuery=!0,v&&v.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(f){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(f);this.emit("error",f)}}_handleErrorEvent(f){if(this._connecting)return this._handleErrorWhileConnecting(f);this._queryable=!1,this._errorAllQueries(f),this.emit("error",f)}_handleErrorMessage(f){if(this._connecting)return this._handleErrorWhileConnecting(f);let v=this.activeQuery;if(!v){this._handleErrorEvent(f);return}this.activeQuery=null,v.handleError(f,this.connection)}_handleRowDescription(f){this.activeQuery.handleRowDescription(f)}_handleDataRow(f){this.activeQuery.handleDataRow(f)}_handlePortalSuspended(f){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(f){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(f){this.activeQuery.handleCommandComplete(f,this.connection)}_handleParseComplete(f){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(f){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(f){this.activeQuery.handleCopyData(f,this.connection)}_handleNotification(f){this.emit("notification",f)}_handleNotice(f){this.emit("notice",f)}getStartupConf(){var f=this.connectionParameters,v={user:f.user,database:f.database},x=f.application_name||f.fallback_application_name;return x&&(v.application_name=x),f.replication&&(v.replication=""+f.replication),f.statement_timeout&&(v.statement_timeout=String(parseInt(f.statement_timeout,10))),f.lock_timeout&&(v.lock_timeout=String(parseInt(f.lock_timeout,10))),f.idle_in_transaction_session_timeout&&(v.idle_in_transaction_session_timeout=String(parseInt(f.idle_in_transaction_session_timeout,10))),f.options&&(v.options=f.options),v}cancel(f,v){if(f.activeQuery===v){var x=this.connection;this.host&&this.host.indexOf("/")===0?x.connect(this.host+"/.s.PGSQL."+this.port):x.connect(this.port,this.host),x.on("connect",function(){x.cancel(f.processID,f.secretKey)})}else f.queryQueue.indexOf(v)!==-1&&f.queryQueue.splice(f.queryQueue.indexOf(v),1)}setTypeParser(f,v,x){return this._types.setTypeParser(f,v,x)}getTypeParser(f,v){return this._types.getTypeParser(f,v)}escapeIdentifier(f){return'"'+f.replace(/"/g,'""')+'"'}escapeLiteral(f){for(var v=!1,x="'",_=0;_<f.length;_++){var S=f[_];S==="'"?x+=S+S:S==="\\"?(x+=S+S,v=!0):x+=S}return x+="'",v===!0&&(x=" E"+x),x}_pulseQueryQueue(){if(this.readyForQuery===!0)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let f=this.activeQuery.submit(this.connection);f&&be.nextTick(()=>{this.activeQuery.handleError(f,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(f,v,x){var _,S,T,O,E;if(f==null)throw new TypeError("Client was passed a null or undefined query");return typeof f.submit=="function"?(T=f.query_timeout||this.connectionParameters.query_timeout,S=_=f,typeof v=="function"&&(_.callback=_.callback||v)):(T=this.connectionParameters.query_timeout,_=new l(f,v,x),_.callback||(S=new this._Promise((A,k)=>{_.callback=(C,j)=>C?k(C):A(j)}))),T&&(E=_.callback,O=setTimeout(()=>{var A=new Error("Query read timeout");be.nextTick(()=>{_.handleError(A,this.connection)}),E(A),_.callback=()=>{};var k=this.queryQueue.indexOf(_);k>-1&&this.queryQueue.splice(k,1),this._pulseQueryQueue()},T),_.callback=(A,k)=>{clearTimeout(O),E(A,k)}),this.binary&&!_.binary&&(_.binary=!0),_._result&&!_._result._types&&(_._result._types=this._types),this._queryable?this._ending?(be.nextTick(()=>{_.handleError(new Error("Client was closed and is not queryable"),this.connection)}),S):(this.queryQueue.push(_),this._pulseQueryQueue(),S):(be.nextTick(()=>{_.handleError(new Error("Client has encountered a connection error and is not queryable"),this.connection)}),S)}ref(){this.connection.ref()}unref(){this.connection.unref()}end(f){if(this._ending=!0,!this.connection._connecting)if(f)f();else return this._Promise.resolve();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),f)this.connection.once("end",f);else return new this._Promise(v=>{this.connection.once("end",v)})}};w(d,"Client");var g=d;g.Query=l,e.exports=g}),vU=xe((t,e)=>{"use strict";ae();var r=is().EventEmitter,n=w(function(){},"NOOP"),i=w((m,f)=>{let v=m.findIndex(f);return v===-1?void 0:m.splice(v,1)[0]},"removeWhere"),s=class{constructor(f,v,x){this.client=f,this.idleListener=v,this.timeoutId=x}};w(s,"IdleItem");var a=s,o=class{constructor(f){this.callback=f}};w(o,"PendingItem");var c=o;function l(){throw new Error("Release called on client which has already been released to the pool.")}w(l,"throwOnDoubleRelease");function u(m,f){if(f)return{callback:f,result:void 0};let v,x,_=w(function(T,O){T?v(T):x(O)},"cb"),S=new m(function(T,O){x=T,v=O}).catch(T=>{throw Error.captureStackTrace(T),T});return{callback:_,result:S}}w(u,"promisify");function p(m,f){return w(function v(x){x.client=f,f.removeListener("error",v),f.on("error",()=>{m.log("additional client error after disconnection due to error",x)}),m._remove(f),m.emit("error",x,f)},"idleListener")}w(p,"makeIdleListener");var d=class extends r{constructor(f,v){super(),this.options=Object.assign({},f),f!=null&&"password"in f&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:f.password}),f!=null&&f.ssl&&f.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||v||wy().Client,this.Promise=this.options.Promise||Sf.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_pulseQueue(){if(this.log("pulse queue"),this.ended){this.log("pulse queue ended");return}if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(v=>{this._remove(v.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length){this.log("no queued requests");return}if(!this._idle.length&&this._isFull())return;let f=this._pendingQueue.shift();if(this._idle.length){let v=this._idle.pop();clearTimeout(v.timeoutId);let x=v.client;x.ref&&x.ref();let _=v.idleListener;return this._acquireClient(x,f,_,!1)}if(!this._isFull())return this.newClient(f);throw new Error("unexpected condition")}_remove(f){let v=i(this._idle,x=>x.client===f);v!==void 0&&clearTimeout(v.timeoutId),this._clients=this._clients.filter(x=>x!==f),f.end(),this.emit("remove",f)}connect(f){if(this.ending){let _=new Error("Cannot use a pool after calling end on the pool");return f?f(_):this.Promise.reject(_)}let v=u(this.Promise,f),x=v.result;if(this._isFull()||this._idle.length){if(this._idle.length&&be.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new c(v.callback)),x;let _=w((O,E,A)=>{clearTimeout(T),v.callback(O,E,A)},"queueCallback"),S=new c(_),T=setTimeout(()=>{i(this._pendingQueue,O=>O.callback===_),S.timedOut=!0,v.callback(new Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return this._pendingQueue.push(S),x}return this.newClient(new c(v.callback)),x}newClient(f){let v=new this.Client(this.options);this._clients.push(v);let x=p(this,v);this.log("checking client timeout");let _,S=!1;this.options.connectionTimeoutMillis&&(_=setTimeout(()=>{this.log("ending client due to timeout"),S=!0,v.connection?v.connection.stream.destroy():v.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),v.connect(T=>{if(_&&clearTimeout(_),v.on("error",x),T)this.log("client failed to connect",T),this._clients=this._clients.filter(O=>O!==v),S&&(T.message="Connection terminated due to connection timeout"),this._pulseQueue(),f.timedOut||f.callback(T,void 0,n);else{if(this.log("new client connected"),this.options.maxLifetimeSeconds!==0){let O=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(v),this._idle.findIndex(E=>E.client===v)!==-1&&this._acquireClient(v,new c((E,A,k)=>k()),x,!1)},this.options.maxLifetimeSeconds*1e3);O.unref(),v.once("end",()=>clearTimeout(O))}return this._acquireClient(v,f,x,!0)}})}_acquireClient(f,v,x,_){_&&this.emit("connect",f),this.emit("acquire",f),f.release=this._releaseOnce(f,x),f.removeListener("error",x),v.timedOut?_&&this.options.verify?this.options.verify(f,f.release):f.release():_&&this.options.verify?this.options.verify(f,S=>{if(S)return f.release(S),v.callback(S,void 0,n);v.callback(void 0,f,f.release)}):v.callback(void 0,f,f.release)}_releaseOnce(f,v){let x=!1;return _=>{x&&l(),x=!0,this._release(f,v,_)}}_release(f,v,x){if(f.on("error",v),f._poolUseCount=(f._poolUseCount||0)+1,this.emit("release",x,f),x||this.ending||!f._queryable||f._ending||f._poolUseCount>=this.options.maxUses){f._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(f),this._pulseQueue();return}if(this._expired.has(f)){this.log("remove expired client"),this._expired.delete(f),this._remove(f),this._pulseQueue();return}let _;this.options.idleTimeoutMillis&&(_=setTimeout(()=>{this.log("remove idle client"),this._remove(f)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&_.unref()),this.options.allowExitOnIdle&&f.unref(),this._idle.push(new a(f,v,_)),this._pulseQueue()}query(f,v,x){if(typeof f=="function"){let S=u(this.Promise,f);return fy(function(){return S.callback(new Error("Passing a function as the first parameter to pool.query is not supported"))}),S.result}typeof v=="function"&&(x=v,v=void 0);let _=u(this.Promise,x);return x=_.callback,this.connect((S,T)=>{if(S)return x(S);let O=!1,E=w(A=>{O||(O=!0,T.release(A),x(A))},"onError");T.once("error",E),this.log("dispatching query");try{T.query(f,v,(A,k)=>{if(this.log("query dispatched"),T.removeListener("error",E),!O)return O=!0,T.release(A),A?x(A):x(void 0,k)})}catch(A){return T.release(A),x(A)}}),_.result}end(f){if(this.log("ending"),this.ending){let x=new Error("Called end on pool more than once");return f?f(x):this.Promise.reject(x)}this.ending=!0;let v=u(this.Promise,f);return this._endCallback=v.callback,this._pulseQueue(),v.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((f,v)=>f+(this._expired.has(v)?1:0),0)}get totalCount(){return this._clients.length}};w(d,"Pool");var g=d;e.exports=g}),hA={};Pr(hA,{default:()=>mA});var mA,yU=Jt(()=>{"use strict";ae(),mA={}}),bU=xe((t,e)=>{e.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),xU=xe((t,e)=>{"use strict";ae();var r=is().EventEmitter,n=(Ef(),St(Il)),i=kf(),s=e.exports=function(o,c,l){r.call(this),o=i.normalizeQueryConfig(o,c,l),this.text=o.text,this.values=o.values,this.name=o.name,this.callback=o.callback,this.state="new",this._arrayMode=o.rowMode==="array",this._emitRowEvents=!1,this.on("newListener",function(u){u==="row"&&(this._emitRowEvents=!0)}.bind(this))};n.inherits(s,r);var a={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};s.prototype.handleError=function(o){var c=this.native.pq.resultErrorFields();if(c)for(var l in c){var u=a[l]||l;o[u]=c[l]}this.callback?this.callback(o):this.emit("error",o),this.state="error"},s.prototype.then=function(o,c){return this._getPromise().then(o,c)},s.prototype.catch=function(o){return this._getPromise().catch(o)},s.prototype._getPromise=function(){return this._promise?this._promise:(this._promise=new Promise(function(o,c){this._once("end",o),this._once("error",c)}.bind(this)),this._promise)},s.prototype.submit=function(o){this.state="running";var c=this;this.native=o.native,o.native.arrayMode=this._arrayMode;var l=w(function(d,g,m){if(o.native.arrayMode=!1,fy(function(){c.emit("_done")}),d)return c.handleError(d);c._emitRowEvents&&(m.length>1?g.forEach((f,v)=>{f.forEach(x=>{c.emit("row",x,m[v])})}):g.forEach(function(f){c.emit("row",f,m)})),c.state="end",c.emit("end",m),c.callback&&c.callback(null,m)},"after");if(be.domain&&(l=be.domain.bind(l)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var u=(this.values||[]).map(i.prepareValue);if(o.namedQueries[this.name]){if(this.text&&o.namedQueries[this.name]!==this.text){let d=new Error(`Prepared statements must be unique - '${this.name}' was used for a different statement`);return l(d)}return o.native.execute(this.name,u,l)}return o.native.prepare(this.name,this.text,u.length,function(d){return d?l(d):(o.namedQueries[c.name]=c.text,c.native.execute(c.name,u,l))})}else if(this.values){if(!Array.isArray(this.values)){let d=new Error("Query values must be an array");return l(d)}var p=this.values.map(i.prepareValue);o.native.query(this.text,p,l)}else o.native.query(this.text,l)}}),wU=xe((t,e)=>{"use strict";ae();var r=(yU(),St(hA)),n=vy(),i=bU(),s=is().EventEmitter,a=(Ef(),St(Il)),o=by(),c=xU(),l=e.exports=function(u){s.call(this),u=u||{},this._Promise=u.Promise||Sf.Promise,this._types=new n(u.types),this.native=new r({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var p=this.connectionParameters=new o(u);this.user=p.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:p.password}),this.database=p.database,this.host=p.host,this.port=p.port,this.namedQueries={}};l.Query=c,a.inherits(l,s),l.prototype._errorAllQueries=function(u){let p=w(d=>{be.nextTick(()=>{d.native=this.native,d.handleError(u)})},"enqueueError");this._hasActiveQuery()&&(p(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(p),this._queryQueue.length=0},l.prototype._connect=function(u){var p=this;if(this._connecting){be.nextTick(()=>u(new Error("Client has already been connected. You cannot reuse a client.")));return}this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(d,g){if(d)return u(d);p.native.connect(g,function(m){if(m)return p.native.end(),u(m);p._connected=!0,p.native.on("error",function(f){p._queryable=!1,p._errorAllQueries(f),p.emit("error",f)}),p.native.on("notification",function(f){p.emit("notification",{channel:f.relname,payload:f.extra})}),p.emit("connect"),p._pulseQueryQueue(!0),u()})})},l.prototype.connect=function(u){if(u){this._connect(u);return}return new this._Promise((p,d)=>{this._connect(g=>{g?d(g):p()})})},l.prototype.query=function(u,p,d){var g,m,f,v,x;if(u==null)throw new TypeError("Client was passed a null or undefined query");if(typeof u.submit=="function")f=u.query_timeout||this.connectionParameters.query_timeout,m=g=u,typeof p=="function"&&(u.callback=p);else if(f=this.connectionParameters.query_timeout,g=new c(u,p,d),!g.callback){let _,S;m=new this._Promise((T,O)=>{_=T,S=O}),g.callback=(T,O)=>T?S(T):_(O)}return f&&(x=g.callback,v=setTimeout(()=>{var _=new Error("Query read timeout");be.nextTick(()=>{g.handleError(_,this.connection)}),x(_),g.callback=()=>{};var S=this._queryQueue.indexOf(g);S>-1&&this._queryQueue.splice(S,1),this._pulseQueryQueue()},f),g.callback=(_,S)=>{clearTimeout(v),x(_,S)}),this._queryable?this._ending?(g.native=this.native,be.nextTick(()=>{g.handleError(new Error("Client was closed and is not queryable"))}),m):(this._queryQueue.push(g),this._pulseQueryQueue(),m):(g.native=this.native,be.nextTick(()=>{g.handleError(new Error("Client has encountered a connection error and is not queryable"))}),m)},l.prototype.end=function(u){var p=this;this._ending=!0,this._connected||this.once("connect",this.end.bind(this,u));var d;return u||(d=new this._Promise(function(g,m){u=w(f=>f?m(f):g(),"cb")})),this.native.end(function(){p._errorAllQueries(new Error("Connection terminated")),be.nextTick(()=>{p.emit("end"),u&&u()})}),d},l.prototype._hasActiveQuery=function(){return this._activeQuery&&this._activeQuery.state!=="error"&&this._activeQuery.state!=="end"},l.prototype._pulseQueryQueue=function(u){if(this._connected&&!this._hasActiveQuery()){var p=this._queryQueue.shift();if(!p){u||this.emit("drain");return}this._activeQuery=p,p.submit(this);var d=this;p.once("_done",function(){d._pulseQueryQueue()})}},l.prototype.cancel=function(u){this._activeQuery===u?this.native.cancel(function(){}):this._queryQueue.indexOf(u)!==-1&&this._queryQueue.splice(this._queryQueue.indexOf(u),1)},l.prototype.ref=function(){},l.prototype.unref=function(){},l.prototype.setTypeParser=function(u,p,d){return this._types.setTypeParser(u,p,d)},l.prototype.getTypeParser=function(u,p){return this._types.getTypeParser(u,p)}}),B4=xe((t,e)=>{"use strict";ae(),e.exports=wU()}),wy=xe((t,e)=>{"use strict";ae();var r=gU(),n=Af(),i=dA(),s=vU(),{DatabaseError:a}=uA(),o=w(l=>{var u;return u=class extends s{constructor(p){super(p,l)}},w(u,"BoundPool"),u},"poolFactory"),c=w(function(l){this.defaults=n,this.Client=l,this.Query=this.Client.Query,this.Pool=o(this.Client),this._pools=[],this.Connection=i,this.types=Cf(),this.DatabaseError=a},"PG");typeof be.env.NODE_PG_FORCE_NATIVE<"u"?e.exports=new c(B4()):(e.exports=new c(r),Object.defineProperty(e.exports,"native",{configurable:!0,enumerable:!1,get(){var l=null;try{l=new c(B4())}catch(u){if(u.code!=="MODULE_NOT_FOUND")throw u}return Object.defineProperty(e.exports,"native",{value:l}),l}}))});ae();var gA=Ha(wy());xy();ae();xy();aA();var _U=Ha(kf()),SU=Ha(vy());function vA(t){return t instanceof he?"\\x"+t.toString("hex"):t}w(vA,"encodeBuffersAsBytea");var yA=class bA extends Error{constructor(e){super(e),me(this,"name","NeonDbError"),me(this,"severity"),me(this,"code"),me(this,"detail"),me(this,"hint"),me(this,"position"),me(this,"internalPosition"),me(this,"internalQuery"),me(this,"where"),me(this,"schema"),me(this,"table"),me(this,"column"),me(this,"dataType"),me(this,"constraint"),me(this,"file"),me(this,"line"),me(this,"routine"),me(this,"sourceError"),"captureStackTrace"in Error&&typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,bA)}};w(yA,"NeonDbError");var Ua=yA,F4="transaction() expects an array of queries, or a function returning an array of queries",EU=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function xA(t,{arrayMode:e,fullResults:r,fetchOptions:n,isolationLevel:i,readOnly:s,deferrable:a,queryCallback:o,resultCallback:c,authToken:l}={}){if(!t)throw new Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");let u;try{u=yy(t)}catch{throw new Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(t))}let{protocol:p,username:d,hostname:g,port:m,pathname:f}=u;if(p!=="postgres:"&&p!=="postgresql:"||!d||!g||!f)throw new Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function v(_,...S){let T,O;if(typeof _=="string")T=_,O=S[1],S=S[0]??[];else{T="";for(let A=0;A<_.length;A++)T+=_[A],A<S.length&&(T+="$"+(A+1))}S=S.map(A=>vA((0,_U.prepareValue)(A)));let E={query:T,params:S};return o&&o(E),wA(x,E,O)}w(v,"resolve"),v.transaction=async(_,S)=>{if(typeof _=="function"&&(_=_(v)),!Array.isArray(_))throw new Error(F4);_.forEach(E=>{if(E[Symbol.toStringTag]!=="NeonQueryPromise")throw new Error(F4)});let T=_.map(E=>E.parameterizedQuery),O=_.map(E=>E.opts??{});return x(T,O,S)};async function x(_,S,T){let{fetchEndpoint:O,fetchFunction:E}=Wa,A=Array.isArray(_)?{queries:_}:_,k=n??{},C=e??!1,j=r??!1,L=i,V=s,H=a;T!==void 0&&(T.fetchOptions!==void 0&&(k={...k,...T.fetchOptions}),T.arrayMode!==void 0&&(C=T.arrayMode),T.fullResults!==void 0&&(j=T.fullResults),T.isolationLevel!==void 0&&(L=T.isolationLevel),T.readOnly!==void 0&&(V=T.readOnly),T.deferrable!==void 0&&(H=T.deferrable)),S!==void 0&&!Array.isArray(S)&&S.fetchOptions!==void 0&&(k={...k,...S.fetchOptions});let B=l;!Array.isArray(S)&&S?.authToken!==void 0&&(B=S.authToken);let z=typeof O=="function"?O(g,m,{jwtAuth:B!==void 0}):O,X={"Neon-Connection-String":t,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},K=await _A(B);K&&(X.Authorization=`Bearer ${K}`),Array.isArray(_)&&(L!==void 0&&(X["Neon-Batch-Isolation-Level"]=L),V!==void 0&&(X["Neon-Batch-Read-Only"]=String(V)),H!==void 0&&(X["Neon-Batch-Deferrable"]=String(H)));let oe;try{oe=await(E??fetch)(z,{method:"POST",body:JSON.stringify(A),headers:X,...k})}catch(we){let pe=new Ua(`Error connecting to database: ${we.message}`);throw pe.sourceError=we,pe}if(oe.ok){let we=await oe.json();if(Array.isArray(_)){let pe=we.results;if(!Array.isArray(pe))throw new Ua("Neon internal error: unexpected result format");return pe.map((Ae,Qe)=>{let vi=S[Qe]??{},Jo=vi.arrayMode??C,ec=vi.fullResults??j;return py(Ae,{arrayMode:Jo,fullResults:ec,parameterizedQuery:_[Qe],resultCallback:c,types:vi.types})})}else{let pe=S??{},Ae=pe.arrayMode??C,Qe=pe.fullResults??j;return py(we,{arrayMode:Ae,fullResults:Qe,parameterizedQuery:_,resultCallback:c,types:pe.types})}}else{let{status:we}=oe;if(we===400){let pe=await oe.json(),Ae=new Ua(pe.message);for(let Qe of EU)Ae[Qe]=pe[Qe]??void 0;throw Ae}else{let pe=await oe.text();throw new Ua(`Server error (HTTP status ${we}): ${pe}`)}}}return w(x,"execute"),v}w(xA,"neon");function wA(t,e,r){return{[Symbol.toStringTag]:"NeonQueryPromise",parameterizedQuery:e,opts:r,then:w((n,i)=>t(e,r).then(n,i),"then"),catch:w(n=>t(e,r).catch(n),"catch"),finally:w(n=>t(e,r).finally(n),"finally")}}w(wA,"createNeonQueryPromise");function py(t,{arrayMode:e,fullResults:r,parameterizedQuery:n,resultCallback:i,types:s}){let a=new SU.default(s),o=t.fields.map(u=>u.name),c=t.fields.map(u=>a.getTypeParser(u.dataTypeID)),l=e===!0?t.rows.map(u=>u.map((p,d)=>p===null?null:c[d](p))):t.rows.map(u=>Object.fromEntries(u.map((p,d)=>[o[d],p===null?null:c[d](p)])));return i&&i(n,t,l,{arrayMode:e,fullResults:r}),r?(t.viaNeonFetch=!0,t.rowAsArray=e,t.rows=l,t._parsers=c,t._types=a,t):l}w(py,"processQueryResult");async function _A(t){if(typeof t=="string")return t;if(typeof t=="function")try{return await Promise.resolve(t())}catch(e){let r=new Ua("Error getting auth token.");throw e instanceof Error&&(r=new Ua(`Error getting auth token: ${e.message}`)),r}}w(_A,"getAuthToken");var CU=Ha(by()),Qa=Ha(wy()),SA=class extends gA.Client{constructor(e){super(e),this.config=e}get neonConfig(){return this.connection.stream}connect(e){let{neonConfig:r}=this;r.forceDisablePgSSL&&(this.ssl=this.connec